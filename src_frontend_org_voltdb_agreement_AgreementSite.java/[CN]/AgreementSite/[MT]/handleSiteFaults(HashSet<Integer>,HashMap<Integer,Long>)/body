{
  m_recoveryLog.info("Agreement, handling site faults for newly failed sites " + newFailedSiteIds + " initiatorSafeInitPoints "+ initiatorSafeInitPoint);
  for (  Integer siteId : newFailedSiteIds) {
    m_txnQueue.gotFaultForInitiator(siteId);
    m_server.closeSessions(siteId);
  }
  Iterator<Long> it=m_transactionsById.keySet().iterator();
  while (it.hasNext()) {
    final long tid=it.next();
    AgreementTransactionState ts=m_transactionsById.get(tid);
    if (!initiatorSafeInitPoint.containsKey(ts.initiatorSiteId)) {
      continue;
    }
    if (ts.txnId > initiatorSafeInitPoint.get(ts.initiatorSiteId) && newFailedSiteIds.contains(ts.initiatorSiteId)) {
      m_recoveryLog.info("Faulting non-globally initiated transaction " + ts.txnId);
      m_txnQueue.faultTransaction(ts);
    }
  }
}
