{
  if (m_siteIds.first().equals(m_siteId)) {
    m_recoveryLog.info("Shipping ZK snapshot from " + m_siteId + " to "+ faultedInitiator);
    shipZKDatabaseSnapshot(faultedInitiator);
  }
  TreeMap<Long,AgreementTransactionState> transactions=new TreeMap<Long,AgreementTransactionState>(m_transactionsById);
  for (  AgreementTransactionState entry : transactions.values()) {
    AgreementTaskMessage task=new AgreementTaskMessage(entry.m_request,entry.txnId,entry.initiatorSiteId,0);
    try {
      m_mailbox.send(faultedInitiator,VoltDB.AGREEMENT_MAILBOX_ID,task);
    }
 catch (    MessagingException e) {
      throw new IOException(e);
    }
  }
  ByteBuffer idBuffer=ByteBuffer.allocate(16);
  idBuffer.putInt(m_siteId);
  try {
    m_mailbox.send(faultedInitiator,VoltDB.AGREEMENT_MAILBOX_ID,new BinaryPayloadMessage(idBuffer.array(),null));
  }
 catch (  MessagingException e) {
    throw new IOException(e);
  }
}
