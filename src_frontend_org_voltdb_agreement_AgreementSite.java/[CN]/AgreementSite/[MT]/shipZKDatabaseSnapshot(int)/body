{
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  GZIPOutputStream gos=new GZIPOutputStream(baos);
  DataOutputStream dos=new DataOutputStream(gos);
  BinaryOutputArchive boa=new BinaryOutputArchive(dos);
  m_server.getZKDatabase().serializeSnapshot(boa);
  dos.flush();
  gos.finish();
  byte databaseBytes[]=baos.toByteArray();
  ByteBuffer metadata=ByteBuffer.allocate(16);
  metadata.putLong(m_server.getZKDatabase().getDataTreeLastProcessedZxid());
  BinaryPayloadMessage bpm=new BinaryPayloadMessage(metadata.array(),databaseBytes);
  try {
    m_mailbox.send(faultedInitiator,VoltDB.AGREEMENT_MAILBOX_ID,bpm);
  }
 catch (  MessagingException e) {
    throw new IOException(e);
  }
}
