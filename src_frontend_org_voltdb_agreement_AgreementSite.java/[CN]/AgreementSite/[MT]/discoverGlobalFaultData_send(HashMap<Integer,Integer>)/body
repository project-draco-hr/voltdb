{
  HashSet<Integer> survivorSet=new HashSet<Integer>(m_siteIds);
  survivorSet.removeAll(m_knownFailedSites);
  int survivors[]=MiscUtils.toArray(survivorSet);
  m_recoveryLog.info("Agreement, Sending fault data " + m_knownFailedSites.toString() + " to "+ survivorSet.toString()+ " survivors");
  for (  Integer survivor : survivors) {
    messagesPerSite.put(survivor,m_knownFailedSites.size());
  }
  try {
    for (    Integer site : m_knownFailedSites) {
      Long txnId=m_txnQueue.getNewestSafeTransactionForInitiator(site);
      if (txnId == null) {
        txnId=m_newestSafeTransactionForInitiatorLedger.get(site);
      }
 else {
        m_newestSafeTransactionForInitiatorLedger.put(site,txnId);
      }
      FailureSiteUpdateMessage srcmsg=new FailureSiteUpdateMessage(m_siteId,m_knownFailedSites,site,txnId != null ? txnId : Long.MIN_VALUE,site);
      m_mailbox.send(survivors,VoltDB.AGREEMENT_MAILBOX_ID,srcmsg);
    }
  }
 catch (  MessagingException e) {
    e.printStackTrace();
    VoltDB.crashVoltDB();
  }
  m_recoveryLog.info("Agreement, Sent fault data. Expecting " + (survivors.length * m_knownFailedSites.size()) + " responses.");
  return (survivors.length * m_knownFailedSites.size());
}
