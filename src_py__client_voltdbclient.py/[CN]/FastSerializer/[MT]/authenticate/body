def authenticate(self, username, password):
    self.writeByte(0)
    self.writeString('database')
    if username:
        self.writeString(username)
    else:
        self.writeString('')
    m = sha()
    m.update(password)
    pwHash = m.digest()
    self.wbuf.extend(pwHash)
    self.prependLength()
    self.flush()
    self.bufferForRead()
    version = self.readByte()
    status = self.readByte()
    if (status != 0):
        raise SystemExit('Authentication failed.')
    self.readInt32()
    self.readInt64()
    self.readInt64()
    self.readInt32()
    for x in range(self.readInt32()):
        self.readByte()
