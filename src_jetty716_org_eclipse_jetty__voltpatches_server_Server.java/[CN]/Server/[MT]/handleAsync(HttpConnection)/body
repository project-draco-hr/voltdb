{
  final AsyncContinuation async=connection.getRequest().getAsyncContinuation();
  final AsyncContinuation.AsyncEventState state=async.getAsyncEventState();
  final Request baseRequest=connection.getRequest();
  final String path=state.getPath();
  if (path != null) {
    baseRequest.setAttribute(AsyncContext.ASYNC_REQUEST_URI,baseRequest.getRequestURI());
    baseRequest.setAttribute(AsyncContext.ASYNC_QUERY_STRING,baseRequest.getQueryString());
    baseRequest.setAttribute(AsyncContext.ASYNC_CONTEXT_PATH,state.getSuspendedContext().getContextPath());
    final String contextPath=state.getServletContext().getContextPath();
    HttpURI uri=new HttpURI(URIUtil.addPaths(contextPath,path));
    baseRequest.setUri(uri);
    baseRequest.setRequestURI(null);
    baseRequest.setPathInfo(baseRequest.getRequestURI());
    baseRequest.setQueryString(uri.getQuery());
  }
  final String target=baseRequest.getPathInfo();
  final HttpServletRequest request=(HttpServletRequest)async.getRequest();
  final HttpServletResponse response=(HttpServletResponse)async.getResponse();
  if (Log.isDebugEnabled()) {
    Log.debug("REQUEST " + target + " on "+ connection);
    handle(target,baseRequest,request,response);
    Log.debug("RESPONSE " + target + "  "+ connection.getResponse().getStatus());
  }
 else   handle(target,baseRequest,request,response);
}
