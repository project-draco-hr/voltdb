{
  if (capacity < 64) {
    return capacity + 1;
  }
  if (forIndex) {
    return 8;
  }
  int content=4 + 8 + dataSize;
  double power=Math.ceil(Math.log(content) / LOG2);
  int bufferSize=(int)Math.pow(2,power);
  return bufferSize + 8 + 24;
}
