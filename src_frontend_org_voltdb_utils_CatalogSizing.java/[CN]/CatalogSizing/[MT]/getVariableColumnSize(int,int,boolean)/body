{
  assert(capacity >= 0);
  assert(dataSize >= 0);
  if (capacity < 64) {
    return capacity + 1;
  }
  if (forIndex) {
    return 8;
  }
  int content=4 + 8 + dataSize;
  int bufferSize=64;
  while (bufferSize < content) {
    int increment=bufferSize / 2;
    bufferSize+=increment;
    if (bufferSize >= content) {
      break;
    }
    bufferSize+=increment;
  }
  return bufferSize + 8 + 24;
}
