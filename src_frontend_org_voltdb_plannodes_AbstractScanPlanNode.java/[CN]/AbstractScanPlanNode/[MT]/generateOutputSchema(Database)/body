{
  if (m_tableSchema == null) {
    generateTableSchema(db);
  }
  ProjectionPlanNode proj=(ProjectionPlanNode)getInlinePlanNode(PlanNodeType.PROJECTION);
  if (proj != null) {
    m_outputSchema=proj.getOutputSchema().copyAndReplaceWithTVE();
    m_hasSignificantOutputSchema=false;
  }
 else {
    if (m_tableScanSchema.size() != 0) {
      List<TupleValueExpression> scan_tves=new ArrayList<TupleValueExpression>();
      for (      SchemaColumn col : m_tableScanSchema.getColumns()) {
        assert(col.getExpression() instanceof TupleValueExpression);
        scan_tves.addAll(ExpressionUtil.getTupleValueExpressions(col.getExpression()));
      }
      for (      TupleValueExpression tve : scan_tves) {
        int index=tve.resolveColumnIndexesUsingSchema(m_tableSchema);
        tve.setColumnIndex(index);
      }
      m_tableScanSchema.sortByTveIndex();
      ProjectionPlanNode map=new ProjectionPlanNode();
      map.setOutputSchema(m_tableScanSchema);
      addInlinePlanNode(map);
      m_outputSchema=map.getOutputSchema().copyAndReplaceWithTVE();
      m_hasSignificantOutputSchema=false;
    }
 else {
      m_outputSchema=m_tableSchema.clone();
      m_hasSignificantOutputSchema=true;
    }
  }
  if (m_isSubQuery) {
    Map<String,SchemaColumn> colMap=new HashMap<String,SchemaColumn>();
    for (    SchemaColumn col : this.m_tableSchema.getColumns()) {
      colMap.put(col.getColumnName(),col);
    }
    if (m_tableScanSchema != null) {
      for (      SchemaColumn scanCol : m_tableScanSchema.getColumns()) {
        assert(colMap.containsKey(scanCol.getColumnName()) == true);
        SchemaColumn tableCol=colMap.get(scanCol.getColumnName());
        scanCol.getExpression().setValueType(tableCol.getExpression().getValueType());
        scanCol.getExpression().setValueSize(tableCol.getExpression().getValueSize());
      }
    }
    if (m_outputSchema != null) {
      for (      SchemaColumn outputCol : m_outputSchema.getColumns()) {
        assert(colMap.containsKey(outputCol.getColumnName()) == true);
        SchemaColumn tableCol=colMap.get(outputCol.getColumnName());
        outputCol.getExpression().setValueType(tableCol.getExpression().getValueType());
        outputCol.getExpression().setValueSize(tableCol.getExpression().getValueSize());
      }
    }
  }
}
