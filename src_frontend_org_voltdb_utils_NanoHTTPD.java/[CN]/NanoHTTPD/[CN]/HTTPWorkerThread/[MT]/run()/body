{
  while (true) {
    Work work=null;
    try {
      work=workQueue.take();
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
    if (work == null)     continue;
    if (work.shouldDie) {
      assert(work.socket == null);
      assert(work.response == null);
      return;
    }
    if (work.response == null) {
      assert(work.socket != null);
      handleNewSocket(work.socket);
    }
 else {
      sendResponse(work.socket,work.response.status,work.response.mimeType,work.response.header,work.response.data);
    }
  }
}
