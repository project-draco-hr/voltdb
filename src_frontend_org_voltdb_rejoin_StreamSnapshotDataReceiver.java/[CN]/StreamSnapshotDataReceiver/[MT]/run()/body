{
  try {
    final ByteBuffer compressionBuffer=ByteBuffer.allocateDirect(CompressionService.maxCompressedLength(1024 * 1024 * 2 + (1024 * 256)));
    while (true) {
      BBContainer container=null;
      compressionBuffer.clear();
      boolean success=false;
      try {
        VoltMessage msg=m_mb.recvBlocking();
        if (msg == null) {
          break;
        }
        assert(msg instanceof RejoinDataMessage);
        RejoinDataMessage dataMsg=(RejoinDataMessage)msg;
        byte[] data=dataMsg.getData();
        container=m_buffers.take();
        ByteBuffer messageBuffer=container.b;
        messageBuffer.clear();
        compressionBuffer.limit(data.length);
        compressionBuffer.put(data);
        compressionBuffer.flip();
        int uncompressedSize=CompressionService.decompressBuffer(compressionBuffer,messageBuffer);
        messageBuffer.limit(uncompressedSize);
        m_queue.offer(Pair.of(dataMsg.m_sourceHSId,container));
        success=true;
      }
  finally {
        if (!success && container != null) {
          container.discard();
        }
      }
    }
  }
 catch (  IOException e) {
    try {
      while (!m_queue.isEmpty()) {
        Thread.sleep(50);
      }
      Thread.sleep(300);
    }
 catch (    InterruptedException e2) {
    }
    if (m_closed) {
      return;
    }
    rejoinLog.error("Error reading a message from a recovery stream.",e);
  }
catch (  InterruptedException e) {
    return;
  }
}
