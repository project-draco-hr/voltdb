{
  LinkedBlockingQueue<BBContainer> bufferQueue=m_bufferPool.getQueue(SnapshotSiteProcessor.m_snapshotBufferLength);
  LinkedBlockingQueue<BBContainer> compressionBufferQueue=m_bufferPool.getQueue(SnapshotSiteProcessor.m_snapshotBufferCompressedLen);
  try {
    while (true) {
      BBContainer container=null;
      BBContainer compressionBuffer=null;
      boolean success=false;
      try {
        VoltMessage msg=m_mb.recvBlocking();
        if (msg == null) {
          break;
        }
        assert(msg instanceof RejoinDataMessage);
        RejoinDataMessage dataMsg=(RejoinDataMessage)msg;
        byte[] data=dataMsg.getData();
        container=bufferQueue.take();
        ByteBuffer messageBuffer=container.b;
        messageBuffer.clear();
        compressionBuffer=compressionBufferQueue.take();
        compressionBuffer.b.clear();
        compressionBuffer.b.limit(data.length);
        compressionBuffer.b.put(data);
        compressionBuffer.b.flip();
        int uncompressedSize=CompressionService.decompressBuffer(compressionBuffer.b,messageBuffer);
        messageBuffer.limit(uncompressedSize);
        m_queue.offer(Pair.of(dataMsg.m_sourceHSId,Pair.of(dataMsg.getTargetId(),container)));
        success=true;
      }
  finally {
        if (!success && container != null) {
          container.discard();
        }
        if (compressionBuffer != null) {
          compressionBuffer.discard();
        }
      }
    }
  }
 catch (  IOException e) {
    try {
      while (!m_queue.isEmpty()) {
        Thread.sleep(50);
      }
      Thread.sleep(300);
    }
 catch (    InterruptedException e2) {
    }
    if (m_closed) {
      return;
    }
    rejoinLog.error("Error reading a message from a recovery stream.",e);
  }
catch (  InterruptedException e) {
    return;
  }
}
