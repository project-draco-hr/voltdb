{
  if (instId == null) {
    throw new IOException("Null instance ID.");
  }
  if (m_serData == null) {
    throw new IOException("Uninitialized hashinator snapshot data.");
  }
  ByteArrayOutputStream bos=new ByteArrayOutputStream(m_serData.length);
  DeflaterOutputStream dos=new DeflaterOutputStream(bos);
  dos.write(m_serData);
  dos.close();
  byte[] compressedData=bos.toByteArray();
  ByteBuffer buf=ByteBuffer.allocate(compressedData.length + OFFSET_DATA);
  buf.putLong(OFFSET_CRC,0);
  buf.putInt(OFFSET_INSTID_COORD,instId.getCoord());
  buf.putLong(OFFSET_INSTID_TIMESTAMP,instId.getTimestamp());
  buf.putLong(OFFSET_VERSION,m_version);
  buf.position(OFFSET_DATA);
  buf.put(compressedData);
  final PureJavaCrc32 crc=new PureJavaCrc32();
  crc.update(buf.array());
  buf.putLong(OFFSET_CRC,crc.getValue());
  buf.rewind();
  return buf;
}
