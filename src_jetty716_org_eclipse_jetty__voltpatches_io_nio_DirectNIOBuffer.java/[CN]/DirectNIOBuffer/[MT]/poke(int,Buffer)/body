{
  if (isReadOnly())   throw new IllegalStateException(__READONLY);
  byte[] array=src.array();
  if (array != null) {
    return poke(index,array,src.getIndex(),src.length());
  }
 else {
    Buffer src_buf=src.buffer();
    if (src_buf instanceof DirectNIOBuffer) {
      ByteBuffer src_bytebuf=((DirectNIOBuffer)src_buf)._buf;
      if (src_bytebuf == _buf)       src_bytebuf=_buf.duplicate();
      try {
        _buf.position(index);
        int space=_buf.remaining();
        int length=src.length();
        if (length > space)         length=space;
        src_bytebuf.position(src.getIndex());
        src_bytebuf.limit(src.getIndex() + length);
        _buf.put(src_bytebuf);
        return length;
      }
  finally {
        _buf.position(0);
        src_bytebuf.limit(src_bytebuf.capacity());
        src_bytebuf.position(0);
      }
    }
 else     return super.poke(index,src);
  }
}
