{
  assert(debugIsLocalStateLocked());
  assert(m_currentParticipants == 0);
  m_holdingDistributedLock=true;
  if (m_membershipChangePending) {
    getLatestMembership();
  }
  if (m_requestedInitialState != null) {
    assert(m_pendingProposal == null);
    m_pendingProposal=m_requestedInitialState;
    initializeFromActiveCommunity();
    assert(!debugIsLocalStateLocked());
  }
 else {
    m_log.debug(m_stateMachineId + ": Granted lockRequest for " + m_ourDistributedLockName);
    m_lockWaitingOn=null;
    unlockLocalState();
    lockRequestCompleted();
  }
}
