{
  m_siteIdToZKPort=new TreeMap<Integer,Integer>();
  m_clients=new ArrayList<ZooKeeper>();
  m_mailboxes=new ArrayList<MockMailbox>();
  m_faultDistributor=new FaultDistributor();
  m_agreementSites=new ArrayList<AgreementSite>();
  Set<Integer> agreementSiteIds=new HashSet<Integer>();
  for (int ii=0; ii < sites; ii++)   agreementSiteIds.add(ii);
  for (int ii=0; ii < sites; ii++) {
    m_mailboxes.add(new MockMailbox());
    int port=m_ports.next();
    m_agreementSites.add(new AgreementSite(ii,agreementSiteIds,ii,new HashSet<Integer>(),m_mailboxes.get(ii),new InetSocketAddress(port),m_faultDistributor,false));
    m_siteIdToZKPort.put(ii,port);
  }
  for (  AgreementSite site : m_agreementSites) {
    site.start();
  }
}
