{
  ClusterRunner runner=new ClusterRunner();
  runner.start();
  SpammingClient[] spammers=new SpammingClient[HOST_COUNT * 10];
  for (int i=0; i < spammers.length; i++) {
    spammers[i]=new SpammingClient((short)i,i % HOST_COUNT);
  }
  for (int i=0; i < spammers.length; i++) {
    spammers[i].start();
  }
  int sleepTime=1 * 60 * 1000;
  while (sleepTime > 0) {
    if (!globalContinue.get()) {
      fail();
    }
    Thread.sleep(100);
    sleepTime-=100;
  }
  for (int i=0; i < spammers.length; i++) {
    spammers[i].shutdown();
  }
  for (int i=0; i < spammers.length; i++) {
    spammers[i].join();
    assertTrue(spammers[i].getConfirmedInserts() > 0);
  }
  globalContinue.set(false);
  runner.shutdown();
  runner.join();
}
