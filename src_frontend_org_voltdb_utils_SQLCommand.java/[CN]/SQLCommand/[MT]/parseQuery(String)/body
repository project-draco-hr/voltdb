{
  if (query == null) {
    return null;
  }
  query=ParserStringKeywords.matcher(query).replaceAll(" $1 #SQL_PARSER_STRING_KEYWORD#$2 ");
  query=SingleLineComments.matcher(query).replaceAll("");
  query=EscapedSingleQuote.matcher(query).replaceAll("#(SQL_PARSER_ESCAPE_SINGLE_QUOTE)");
  Matcher stringFragmentMatcher=Extract.matcher(query);
  ArrayList<String> stringFragments=new ArrayList<String>();
  int i=0;
  while (stringFragmentMatcher.find()) {
    stringFragments.add(stringFragmentMatcher.group());
    query=stringFragmentMatcher.replaceFirst("#(SQL_PARSER_STRING_FRAGMENT#" + i + ")");
    stringFragmentMatcher=Extract.matcher(query);
    i++;
  }
  int commentBegin=0;
  while ((commentBegin=query.indexOf("--")) > 0) {
    String queriesBeforeInlineComment=query.substring(0,commentBegin);
    String queriesAfterInlineComment="\n";
    int commentEnd=query.indexOf("\n",commentBegin);
    if (commentEnd > commentBegin) {
      queriesAfterInlineComment=query.substring(commentEnd);
    }
    query=queriesBeforeInlineComment + queriesAfterInlineComment;
  }
  String[] sqlFragments=query.split("\\s*;+\\s*");
  ArrayList<String> queries=new ArrayList<String>();
  for (  String fragment : sqlFragments) {
    fragment=SingleLineComments.matcher(fragment).replaceAll("");
    fragment=fragment.trim();
    if (fragment.isEmpty()) {
      continue;
    }
    if (fragment.indexOf("#(SQL_PARSER_STRING_FRAGMENT#") > -1) {
      int k=0;
      for (      String strFrag : stringFragments) {
        fragment=fragment.replace("#(SQL_PARSER_STRING_FRAGMENT#" + k + ")",strFrag);
        k++;
      }
    }
    fragment=fragment.replace("#(SQL_PARSER_ESCAPE_SINGLE_QUOTE)","''");
    fragment=fragment.replace("#SQL_PARSER_STRING_KEYWORD#","");
    queries.add(fragment);
  }
  return queries;
}
