{
  m_returningToPromptAfterError=false;
  List<String> multiLineStatementBuffer=new ArrayList<>();
  List<String> parsedQueries=new ArrayList<>();
  StringBuilder query=new StringBuilder();
  boolean isRecall=false;
  boolean executeImmediate=false;
  while (!executeImmediate) {
    String prompt=isRecall ? "" : ((RecallableSessionLines.size() + 1) + "> ");
    isRecall=false;
    String line=lineInputReader.readLine(prompt);
    assert(line != null);
    executeImmediate=SemicolonToken.matcher(line).matches();
    if (multiLineStatementBuffer.isEmpty()) {
      if (ExitToken.matcher(line).matches()) {
        return null;
      }
      Matcher recallMatcher=RecallToken.matcher(line);
      if (recallMatcher.matches()) {
        int recall=-1;
        try {
          recall=Integer.parseInt(recallMatcher.group(1)) - 1;
        }
 catch (        Exception x) {
        }
        if (recall > -1 && recall < RecallableSessionLines.size()) {
          line=RecallableSessionLines.get(recall);
          lineInputReader.putString(line);
          lineInputReader.flush();
          isRecall=true;
        }
 else {
          System.out.printf("%s> Invalid RECALL reference: '" + recallMatcher.group(1) + "'.\n",RecallableSessionLines.size());
        }
        executeImmediate=false;
        continue;
      }
      RecallableSessionLines.add(line);
      if (executesAsSimpleDirective(line)) {
        executeImmediate=false;
        continue;
      }
      if (GoToken.matcher(line).matches()) {
        executeImmediate=true;
        line=";";
      }
      Matcher fileMatcher=FileToken.matcher(line);
      if (fileMatcher.matches()) {
        line=readScriptFile(fileMatcher.group(1));
        if (m_returningToPromptAfterError) {
          query=new StringBuilder();
          m_returningToPromptAfterError=false;
          executeImmediate=false;
          continue;
        }
      }
    }
 else {
      RecallableSessionLines.add(line);
    }
    query.append(line);
    query.append("\n");
  }
  parsedQueries=parseQuery(query.toString());
  return parsedQueries;
}
