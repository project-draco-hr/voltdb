{
  HttpFields httpFields=request.getConnection().getRequestFields();
  String forwardedHost=getLeftMostValue(httpFields.getStringField(getForwardedHostHeader()));
  String forwardedServer=getLeftMostValue(httpFields.getStringField(getForwardedServerHeader()));
  String forwardedFor=getLeftMostValue(httpFields.getStringField(getForwardedForHeader()));
  if (_hostHeader != null) {
    httpFields.put(HttpHeaders.HOST_BUFFER,_hostHeader);
    request.setServerName(null);
    request.setServerPort(-1);
    request.getServerName();
  }
 else   if (forwardedHost != null) {
    httpFields.put(HttpHeaders.HOST_BUFFER,forwardedHost);
    request.setServerName(null);
    request.setServerPort(-1);
    request.getServerName();
  }
 else   if (forwardedServer != null) {
    request.setServerName(forwardedServer);
  }
  if (forwardedFor != null) {
    request.setRemoteAddr(forwardedFor);
    InetAddress inetAddress=null;
    if (_useDNS) {
      try {
        inetAddress=InetAddress.getByName(forwardedFor);
      }
 catch (      UnknownHostException e) {
        Log.ignore(e);
      }
    }
    request.setRemoteHost(inetAddress == null ? forwardedFor : inetAddress.getHostName());
  }
}
