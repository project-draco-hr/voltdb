{
  if (isStopping() || isStopped())   return;
  Thread thread=Thread.currentThread();
  ClassLoader old_loader=thread.getContextClassLoader();
  try {
    if (_loader != null)     thread.setContextClassLoader(_loader);
    long now=System.currentTimeMillis();
    try {
      if (!_sessionsLoaded && _lazyLoad)       restoreSessions();
    }
 catch (    Exception e) {
      Log.debug(e);
    }
    Object stale=null;
synchronized (HashSessionManager.this) {
      for (Iterator i=_sessions.values().iterator(); i.hasNext(); ) {
        Session session=(Session)i.next();
        long idleTime=session._maxIdleMs;
        if (idleTime > 0 && session._accessed + idleTime < now) {
          stale=LazyList.add(stale,session);
        }
      }
    }
    for (int i=LazyList.size(stale); i-- > 0; ) {
      Session session=(Session)LazyList.get(stale,i);
      long idleTime=session._maxIdleMs;
      if (idleTime > 0 && session._accessed + idleTime < System.currentTimeMillis()) {
        session.timeout();
      }
    }
  }
 catch (  Throwable t) {
    if (t instanceof ThreadDeath)     throw ((ThreadDeath)t);
 else     Log.warn("Problem scavenging sessions",t);
  }
 finally {
    thread.setContextClassLoader(old_loader);
  }
}
