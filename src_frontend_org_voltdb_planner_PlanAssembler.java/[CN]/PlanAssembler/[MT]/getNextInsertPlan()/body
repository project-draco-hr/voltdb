{
  if (m_bestAndOnlyPlanWasGenerated)   return null;
  m_bestAndOnlyPlanWasGenerated=true;
  assert(m_parsedInsert.m_tableList.size() == 1);
  Table targetTable=m_parsedInsert.m_tableList.get(0);
  InsertPlanNode insertNode=new InsertPlanNode();
  insertNode.setTargetTableName(targetTable.getTypeName());
  List<Column> columns=CatalogUtil.getSortedCatalogItems(targetTable.getColumns(),"index");
  ParsedSelectStmt subselect=m_parsedInsert.getSubselect();
  if (subselect != null) {
    CompiledPlan selectPlan=getBestCostPlan(subselect);
    int ii=0;
    for (    Column column : columns) {
      assert(VoltType.get((byte)column.getType()) == subselect.displayColumns().get(ii++).expression.getValueType());
    }
    insertNode.addAndLinkChild(selectPlan.rootPlanGraph);
    if (m_partitioning.wasSpecifiedAsSingle() || m_partitioning.isInferredSingle()) {
      insertNode.setMultiPartition(false);
      return insertNode;
    }
    insertNode.setMultiPartition(true);
    AbstractPlanNode recvNode=SubPlanAssembler.addSendReceivePair(insertNode);
    return addSumOrLimitAndSendToDMLNode(recvNode,targetTable.getIsreplicated());
  }
  MaterializePlanNode materializeNode=new MaterializePlanNode();
  NodeSchema mat_schema=new NodeSchema();
  for (  Column column : columns) {
    AbstractExpression expr=m_parsedInsert.getValuesExpression(column);
    if (expr == null) {
      if (column.getNullable() == false && column.getDefaulttype() == 0) {
        throw new PlanningErrorException("Column " + column.getName() + " has no default and is not nullable.");
      }
      boolean isConstantValue=true;
      if (column.getDefaulttype() == VoltType.TIMESTAMP.getValue()) {
        boolean isFunctionFormat=true;
        String timeValue=column.getDefaultvalue();
        try {
          Long.parseLong(timeValue);
          isFunctionFormat=false;
        }
 catch (        NumberFormatException e) {
        }
        if (isFunctionFormat) {
          try {
            java.sql.Timestamp.valueOf(timeValue);
            isFunctionFormat=false;
          }
 catch (          IllegalArgumentException e) {
          }
        }
        if (isFunctionFormat) {
          String name=timeValue.split(":")[0];
          int id=Integer.parseInt(timeValue.split(":")[1]);
          FunctionExpression funcExpr=new FunctionExpression();
          funcExpr.setAttributes(name,name,id);
          funcExpr.setValueType(VoltType.TIMESTAMP);
          funcExpr.setValueSize(VoltType.TIMESTAMP.getMaxLengthInBytes());
          expr=funcExpr;
          isConstantValue=false;
        }
      }
      if (isConstantValue) {
        ConstantValueExpression const_expr=new ConstantValueExpression();
        expr=const_expr;
        if (column.getDefaulttype() != 0) {
          const_expr.setValue(column.getDefaultvalue());
          const_expr.refineValueType(VoltType.get((byte)column.getDefaulttype()),column.getSize());
        }
 else {
          const_expr.setValue(null);
          const_expr.refineValueType(VoltType.get((byte)column.getType()),column.getSize());
        }
      }
      assert(expr != null);
    }
    if (column.equals(m_partitioning.getColumn())) {
      String fullColumnName=targetTable.getTypeName() + "." + column.getTypeName();
      m_partitioning.addPartitioningExpression(fullColumnName,expr,expr.getValueType());
    }
    mat_schema.addColumn(new SchemaColumn("VOLT_TEMP_TABLE","VOLT_TEMP_TABLE",column.getTypeName(),column.getTypeName(),expr));
  }
  materializeNode.setOutputSchema(mat_schema);
  insertNode.addAndLinkChild(materializeNode);
  if (m_partitioning.wasSpecifiedAsSingle() || m_partitioning.isInferredSingle()) {
    insertNode.setMultiPartition(false);
    return insertNode;
  }
  insertNode.setMultiPartition(true);
  AbstractPlanNode recvNode=SubPlanAssembler.addSendReceivePair(insertNode);
  return addSumOrLimitAndSendToDMLNode(recvNode,targetTable.getIsreplicated());
}
