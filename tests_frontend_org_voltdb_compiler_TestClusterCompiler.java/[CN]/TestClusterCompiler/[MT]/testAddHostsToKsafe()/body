{
  ClusterConfig config=new ClusterConfig(2,6,1);
  JSONObject topo=config.getTopology(Arrays.asList(0,1));
  assertEquals(2,topo.getInt("hostcount"));
  assertEquals(6,topo.getInt("sites_per_host"));
  assertEquals(1,topo.getInt("kfactor"));
  assertEquals(6,topo.getJSONArray("partitions").length());
  ClusterConfig.addHosts(Arrays.asList(2,3),topo);
  assertEquals(4,topo.getInt("hostcount"));
  assertEquals(1,topo.getInt("kfactor"));
  assertEquals(12,topo.getJSONArray("partitions").length());
  JSONArray parts=topo.getJSONArray("partitions");
  int newPartCount=0;
  for (int i=6; i < parts.length(); i++) {
    JSONObject part=parts.getJSONObject(i);
    assertEquals(i,part.getInt("partition_id"));
    int master=part.getInt("master");
    assertTrue(master == 2 || master == 3);
    JSONArray replicas=part.getJSONArray("replicas");
    HashSet<Integer> replicaHosts=new HashSet<Integer>();
    replicaHosts.add(replicas.getInt(0));
    replicaHosts.add(replicas.getInt(1));
    assertTrue(replicaHosts.contains(2));
    assertTrue(replicaHosts.contains(3));
    newPartCount++;
  }
  assertEquals(6,newPartCount);
}
