{
  List bulkChanges=new ArrayList();
  Set oldScanKeys=new HashSet(oldScan.keySet());
  Iterator itor=currentScan.entrySet().iterator();
  while (itor.hasNext()) {
    Map.Entry entry=(Map.Entry)itor.next();
    if (!oldScanKeys.contains(entry.getKey())) {
      Log.debug("File added: " + entry.getKey());
      reportAddition((String)entry.getKey());
      bulkChanges.add(entry.getKey());
    }
 else     if (!oldScan.get(entry.getKey()).equals(entry.getValue())) {
      Log.debug("File changed: " + entry.getKey());
      reportChange((String)entry.getKey());
      oldScanKeys.remove(entry.getKey());
      bulkChanges.add(entry.getKey());
    }
 else     oldScanKeys.remove(entry.getKey());
  }
  if (!oldScanKeys.isEmpty()) {
    Iterator keyItor=oldScanKeys.iterator();
    while (keyItor.hasNext()) {
      String filename=(String)keyItor.next();
      Log.debug("File removed: " + filename);
      reportRemoval(filename);
      bulkChanges.add(filename);
    }
  }
  if (!bulkChanges.isEmpty())   reportBulkChanges(bulkChanges);
}
