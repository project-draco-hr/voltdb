{
  entries=createEntryArray(size);
  int tableSize=Hashing.closedTableSize(size,MAX_LOAD_FACTOR);
  table=createEntryArray(tableSize);
  mask=tableSize - 1;
  for (int entryIndex=0; entryIndex < size; entryIndex++) {
    @SuppressWarnings("unchecked") TerminalEntry<K,V> entry=(TerminalEntry<K,V>)theEntries[entryIndex];
    K key=entry.getKey();
    int tableIndex=Hashing.smear(key.hashCode()) & mask;
    @Nullable ImmutableMapEntry<K,V> existing=table[tableIndex];
    ImmutableMapEntry<K,V> newEntry=(existing == null) ? entry : new NonTerminalMapEntry<K,V>(entry,existing);
    table[tableIndex]=newEntry;
    entries[entryIndex]=newEntry;
    checkNoConflictInBucket(key,newEntry,existing);
  }
}
