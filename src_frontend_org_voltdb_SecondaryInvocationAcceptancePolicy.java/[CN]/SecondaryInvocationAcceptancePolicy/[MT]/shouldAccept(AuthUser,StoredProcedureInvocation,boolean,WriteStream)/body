{
  if (invocation.getType() == ProcedureInvocationType.ORIGINAL) {
    if (!isOn) {
      return true;
    }
    if (invocation.procName.equals("@AdHoc")) {
      String sql=(String)invocation.getParams().toArray()[0];
      isReadOnly=sql.trim().toLowerCase().startsWith("select");
    }
    if (isReadOnly) {
      return true;
    }
 else {
      final ClientResponseImpl errorResponse=new ClientResponseImpl(ClientResponseImpl.UNEXPECTED_FAILURE,new VoltTable[0],"Write procedure " + invocation.procName + " is not allowed in secondary cluster",invocation.clientHandle);
      s.enqueue(errorResponse);
      return false;
    }
  }
 else {
    if (!isOn) {
      final ClientResponseImpl errorResponse=new ClientResponseImpl(ClientResponseImpl.UNEXPECTED_FAILURE,new VoltTable[0],"Replicated procedure " + invocation.procName + " is dropped from cluster",invocation.clientHandle);
      s.enqueue(errorResponse);
      return false;
    }
    if (isReadOnly) {
      final ClientResponseImpl errorResponse=new ClientResponseImpl(ClientResponseImpl.UNEXPECTED_FAILURE,new VoltTable[0],"Read replicated procedure " + invocation.procName + " is dropped from secondary cluster",invocation.clientHandle);
      s.enqueue(errorResponse);
      return false;
    }
 else {
      return true;
    }
  }
}
