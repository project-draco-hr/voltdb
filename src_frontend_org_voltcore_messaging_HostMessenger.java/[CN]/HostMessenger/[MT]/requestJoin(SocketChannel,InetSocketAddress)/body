{
  Integer hostId=selectNewHostId(socket.socket().getInetAddress().getHostAddress(),false);
  prepSocketChannel(socket);
  ForeignHost fhost=null;
  try {
    writeRequestJoinResponse(hostId,socket);
    ByteBuffer finishedJoining=ByteBuffer.allocate(1);
    socket.configureBlocking(false);
    long start=System.currentTimeMillis();
    while (finishedJoining.hasRemaining() && System.currentTimeMillis() - start < 120000) {
      int read=socket.read(finishedJoining);
      if (read == -1) {
        hostLog.info("New connection was unable to establish mesh");
        return;
      }
 else       if (read < 1) {
        Thread.sleep(5);
      }
    }
    fhost=new ForeignHost(this,hostId,socket,m_config.deadHostTimeout,listeningAddress);
    putForeignHost(hostId,fhost);
    fhost.register(this);
    if (!m_agreementSite.requestJoin((AGREEMENT_SITE_ID << 32) + hostId).await(60,TimeUnit.SECONDS)) {
      reportForeignHostFailed(hostId);
    }
  }
 catch (  Throwable e) {
    VoltDB.crashLocalVoltDB("",true,e);
  }
}
