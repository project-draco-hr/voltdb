{
  while (true) {
    HashMap<Long,Mailbox> original=m_siteMailboxes.get();
    if (!original.containsKey(mailbox.getHSId())) {
      throw new RuntimeException("Can only register a mailbox with an hsid alreadly generated");
    }
    HashMap<Long,Mailbox> update=new HashMap<Long,Mailbox>(original);
    update.put(mailbox.getHSId(),mailbox);
    if (m_siteMailboxes.compareAndSet(original,update)) {
      break;
    }
  }
}
