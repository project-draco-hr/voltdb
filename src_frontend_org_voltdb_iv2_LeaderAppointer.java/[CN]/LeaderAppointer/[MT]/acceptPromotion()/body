{
  m_iv2appointees.start(true);
  m_iv2masters.start(true);
  if (m_iv2appointees.pointInTimeCache().size() == 0) {
    tmLog.info("LeaderAppointer in startup");
    m_state.set(AppointerState.CLUSTER_START);
  }
 else   if ((m_iv2appointees.pointInTimeCache().size() != m_partitionCount) || (m_iv2masters.pointInTimeCache().size() != m_partitionCount)) {
    VoltDB.crashGlobalVoltDB("Detected failure during startup, unable to start",false,null);
  }
 else {
    tmLog.info("LeaderAppointer in repair");
    m_state.set(AppointerState.DONE);
  }
  if (m_state.get() == AppointerState.CLUSTER_START) {
    for (int i=0; i < m_partitionCount; i++) {
      String dir=LeaderElector.electionDirForPartition(i);
      try {
        m_zk.create(dir,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      }
 catch (      KeeperException.NodeExistsException e) {
      }
      m_callbacks[i]=new PartitionCallback(i);
      Pair<BabySitter,List<String>> sitterstuff=BabySitter.blockingFactory(m_zk,dir,m_callbacks[i]);
      m_partitionWatchers[i]=sitterstuff.getFirst();
    }
  }
 else {
    Map<Integer,Long> masters=m_iv2masters.pointInTimeCache();
    for (    Entry<Integer,Long> master : masters.entrySet()) {
      int partId=master.getKey();
      String dir=LeaderElector.electionDirForPartition(partId);
      m_callbacks[partId]=new PartitionCallback(partId,master.getValue());
      Pair<BabySitter,List<String>> sitterstuff=BabySitter.blockingFactory(m_zk,dir,m_callbacks[partId]);
      m_partitionWatchers[partId]=sitterstuff.getFirst();
    }
    m_MPI.acceptPromotion();
  }
}
