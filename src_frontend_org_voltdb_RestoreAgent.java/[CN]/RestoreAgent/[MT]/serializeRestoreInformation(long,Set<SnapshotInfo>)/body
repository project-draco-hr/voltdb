{
  int len=0;
  if (m_recover != null) {
    len=m_recover.length();
  }
  int size=8 + 4 + len+ 4;
  for (  SnapshotInfo i : snapshots) {
    size+=i.size();
  }
  ByteBuffer buf=ByteBuffer.allocate(size);
  buf.putLong(min);
  buf.putInt(len);
  if (m_recover != null) {
    buf.put(m_recover.getBytes());
  }
  buf.putInt(snapshots.size());
  for (  SnapshotInfo snapshot : snapshots) {
    buf.putLong(snapshot.txnId);
    buf.putInt(snapshot.nonce.length());
    buf.put(snapshot.nonce.getBytes());
    buf.putInt(snapshot.path.length());
    buf.put(snapshot.path.getBytes());
    buf.putInt(snapshot.partitionCount);
    buf.putInt(snapshot.partitions.size());
    for (    Entry<String,Set<Integer>> p : snapshot.partitions.entrySet()) {
      buf.putInt(p.getKey().length());
      buf.put(p.getKey().getBytes());
      buf.putInt(p.getValue().size());
      for (      int id : p.getValue()) {
        buf.putInt(id);
      }
    }
  }
  return buf;
}
