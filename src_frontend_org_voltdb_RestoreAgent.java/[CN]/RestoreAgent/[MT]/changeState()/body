{
  if (m_state == State.RESTORE) {
    waitForSnapshotTxnId();
    exitRestore();
    m_state=State.REPLAY;
    try {
      m_restoreHeartbeatThread.join();
    }
 catch (    InterruptedException e) {
    }
    m_snapshotMonitor.addInterest(this);
    m_replayAgent.replay();
  }
 else   if (m_state == State.REPLAY) {
    m_state=State.TRUNCATE;
  }
 else   if (m_state == State.TRUNCATE) {
    m_snapshotMonitor.removeInterest(this);
    if (m_callback != null) {
      m_callback.onRestoreCompletion(m_truncationSnapshot);
    }
  }
}
