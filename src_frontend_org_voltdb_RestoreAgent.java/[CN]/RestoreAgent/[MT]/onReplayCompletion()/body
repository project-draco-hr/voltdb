{
  if (m_replayAgent.hasReplayed()) {
    CommandLog commandLogElement=m_context.cluster.getLogconfig().get("log");
    if (isLowestHost() && commandLogElement != null) {
      String path=commandLogElement.getInternalsnapshotpath();
      Date now=new Date(System.currentTimeMillis());
      String nonce=CL_NONCE_PREFIX + m_dateFormat.format(now);
      initSnapshotWork(null,Pair.of("@SnapshotSave",new Object[]{path,nonce,1}));
    }
 else {
      m_state=State.TRUNCATE;
    }
  }
 else   if (!m_hasRestored && m_action == START_ACTION.RECOVER) {
    LOG.fatal("Nothing to recover from");
    VoltDB.crashVoltDB();
  }
 else {
    m_state=State.TRUNCATE;
  }
  changeState();
}
