{
  if (m_replayAgent.hasReplayed()) {
    CommandLog commandLogElement=m_context.cluster.getLogconfig().get("log");
    if (isLowestHost() && commandLogElement != null) {
      byte[] pathBytes=commandLogElement.getInternalsnapshotpath().getBytes();
      ByteBuffer buf=ByteBuffer.allocate(pathBytes.length + 8);
      buf.position(8);
      buf.put(pathBytes);
      m_snapshotMonitor.addInterest(this);
      try {
        m_zk.create("/request_truncation_snapshot",buf.array(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      }
 catch (      Exception e) {
        LOG.fatal("Requesting a truncation snapshot via ZK should always succeed",e);
        VoltDB.crashVoltDB();
      }
    }
 else {
      m_state=State.TRUNCATE;
    }
  }
 else   if (!m_hasRestored && m_action == START_ACTION.RECOVER) {
    LOG.fatal("Nothing to recover from");
    VoltDB.crashVoltDB();
  }
 else {
    m_state=State.TRUNCATE;
  }
  changeState();
}
