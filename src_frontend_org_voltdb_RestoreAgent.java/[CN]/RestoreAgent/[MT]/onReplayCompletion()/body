{
  if (!m_hasRestored && !m_replayAgent.hasReplayed() && m_action == START_ACTION.RECOVER) {
    LOG.fatal("Nothing to recover from");
    VoltDB.crashVoltDB();
  }
 else   if (m_replayAgent.areLogsEmpty()) {
    m_state=State.TRUNCATE;
  }
  changeState();
  if (!m_replayAgent.areLogsEmpty()) {
    CommandLog commandLogElement=m_context.cluster.getLogconfig().get("log");
    if (isLowestHost() && commandLogElement != null) {
      try {
        try {
          m_zk.create("/truncation_snapshot_path",commandLogElement.getInternalsnapshotpath().getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
        }
 catch (        KeeperException.NodeExistsException e) {
        }
        m_zk.create("/request_truncation_snapshot",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      }
 catch (      Exception e) {
        LOG.fatal("Requesting a truncation snapshot via ZK should always succeed",e);
        VoltDB.crashVoltDB();
      }
    }
  }
}
