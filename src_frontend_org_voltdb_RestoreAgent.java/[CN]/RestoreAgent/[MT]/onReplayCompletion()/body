{
  if (!m_hasRestored && !m_replayAgent.hasReplayedSegments() && m_action == START_ACTION.RECOVER) {
    VoltDB.crashGlobalVoltDB("Nothing to recover from",false,null);
  }
 else   if (!m_clEnabled && !m_replayAgent.hasReplayedTxns()) {
    m_state=State.TRUNCATE;
  }
  changeState();
  if (m_clEnabled || m_replayAgent.hasReplayedTxns()) {
    if (m_isLeader) {
      try {
        try {
          m_zk.create(VoltZK.truncation_snapshot_path,m_clSnapshotPath.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
        }
 catch (        KeeperException.NodeExistsException e) {
        }
        m_zk.create(VoltZK.request_truncation_snapshot,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      }
 catch (      Exception e) {
        VoltDB.crashGlobalVoltDB("Requesting a truncation snapshot " + "via ZK should always succeed",false,e);
      }
    }
  }
}
