{
  if (m_replayAgent.hasReplayed()) {
    if (isLowestHost()) {
      String path=m_context.cluster.getLogconfig().get("log").getInternalsnapshotpath();
      Date now=new Date(System.currentTimeMillis());
      String nonce=CL_NONCE_PREFIX + m_dateFormat.format(now);
      initSnapshotWork(null,Pair.of("@SnapshotSave",new Object[]{path,nonce,1}));
    }
 else {
      m_state=State.TRUNCATE;
    }
  }
 else {
    m_state=State.TRUNCATE;
  }
  changeState();
}
