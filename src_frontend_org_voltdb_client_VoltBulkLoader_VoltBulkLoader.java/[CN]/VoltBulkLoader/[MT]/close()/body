{
  if (m_flush != null) {
    m_flush.cancel(false);
  }
  m_ses.shutdown();
synchronized (m_vblGlobals) {
    List<VoltBulkLoader> loaderList=m_vblGlobals.m_TableNameToLoader.get(m_tableName);
    if (loaderList.size() == 1) {
      m_vblGlobals.m_TableNameToLoader.remove(m_tableName);
    }
 else     loaderList.remove(this);
    drain();
    for (    PerPartitionTable ppt : m_partitionTable) {
      if (ppt != null) {
        try {
          ppt.shutdown();
        }
 catch (        Exception e) {
          loaderLog.error("Failed to close processor for partition " + ppt.m_partitionId,e);
        }
      }
    }
    assert(m_loaderBatchedRowCnt.get() == 0 && m_loaderQueuedRowCnt.get() == 0);
  }
}
