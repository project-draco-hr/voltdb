{
  StreamSnapshotDataTarget dut1=makeDataTarget(1000);
  StreamSnapshotDataTarget dut2=makeDataTarget(1001);
  writeAndVerify(dut1,0,true);
  writeAndVerify(dut2,1,true);
  assertEquals(2,dut1.m_outstandingWorkCount.get());
  assertEquals(2,dut2.m_outstandingWorkCount.get());
  ack(false,dut1.m_targetId,dut1.m_blockIndex - 2);
  ack(false,dut1.m_targetId,dut1.m_blockIndex - 1);
  while (dut1.m_outstandingWorkCount.get() != 0) {
    Thread.yield();
  }
  ack(false,dut2.m_targetId,dut2.m_blockIndex - 2);
  ack(false,dut2.m_targetId,dut2.m_blockIndex - 1);
  while (dut2.m_outstandingWorkCount.get() != 0) {
    Thread.yield();
  }
  closeStream(dut1);
  closeStream(dut2);
}
