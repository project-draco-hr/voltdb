{
  Set<Class<?>> dispatchTypes=flattenHierarchy(event.getClass());
  boolean dispatched=false;
  for (  Class<?> eventType : dispatchTypes) {
    subscribersByTypeLock.readLock().lock();
    try {
      Set<EventSubscriber> wrappers=subscribersByType.get(eventType);
      if (!wrappers.isEmpty()) {
        dispatched=true;
        for (        EventSubscriber wrapper : wrappers) {
          enqueueEvent(event,wrapper);
        }
      }
    }
  finally {
      subscribersByTypeLock.readLock().unlock();
    }
  }
  if (!dispatched && !(event instanceof DeadEvent)) {
    post(new DeadEvent(this,event));
  }
  dispatchQueuedEvents();
}
