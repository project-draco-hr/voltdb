{
  if (!m_isLeader && msg instanceof Iv2InitiateTaskMessage) {
    final Iv2InitiateTaskMessage m=(Iv2InitiateTaskMessage)msg;
    if (!m.isReadOnly()) {
      m_lastSpHandle=m.getSpHandle();
      truncate(m.getTruncationHandle(),IS_SP);
      m_logSP.add(new Item(IS_SP,m,m.getSpHandle(),m.getTxnId()));
      if ("@ApplyBinaryLogSP".equals(m.getStoredProcedureName())) {
        StoredProcedureInvocation spi=m.getStoredProcedureInvocation();
        Object[] params=spi.getParams().toArray();
        m_maxSeenSpBinaryLogDRId=Math.max(m_maxSeenSpBinaryLogDRId,((Number)params[2]).longValue());
        m_maxSeenSpBinaryLogSpUniqueId=Math.max(m_maxSeenSpBinaryLogSpUniqueId,((Number)params[3]).longValue());
        m_maxSeenSpBinaryLogMpUniqueId=Math.max(m_maxSeenSpBinaryLogMpUniqueId,((Number)params[4]).longValue());
        m_maxSeenLocalSpUniqueId=Math.max(m_maxSeenLocalSpUniqueId,m.getUniqueId());
      }
    }
  }
 else   if (msg instanceof FragmentTaskMessage) {
    final FragmentTaskMessage m=(FragmentTaskMessage)msg;
    if (!m.isReadOnly()) {
      truncate(m.getTruncationHandle(),IS_MP);
      if (m.getTxnId() > m_lastMpHandle || m_lastMpHandle == Long.MAX_VALUE) {
        m_logMP.add(new Item(IS_MP,m,m.getSpHandle(),m.getTxnId()));
        m_lastMpHandle=m.getTxnId();
        m_lastSpHandle=m.getSpHandle();
      }
      final Iv2InitiateTaskMessage initiateTask=m.getInitiateTask();
      if (initiateTask != null && "@ApplyBinaryLogMP".equals(initiateTask.getStoredProcedureName())) {
        StoredProcedureInvocation spi=initiateTask.getStoredProcedureInvocation();
        Object[] params=spi.getParams().toArray();
        m_maxSeenMpBinaryLogDRId=Math.max(m_maxSeenMpBinaryLogDRId,((Number)params[2]).longValue());
        m_maxSeenMpBinaryLogMpUniqueId=Math.max(m_maxSeenMpBinaryLogMpUniqueId,((Number)params[4]).longValue());
        m_maxSeenLocalMpUniqueId=Math.max(m_maxSeenLocalMpUniqueId,m.getUniqueId());
      }
    }
  }
 else   if (msg instanceof CompleteTransactionMessage) {
    CompleteTransactionMessage ctm=(CompleteTransactionMessage)msg;
    if (!ctm.isReadOnly() && !ctm.isRestart()) {
      truncate(ctm.getTruncationHandle(),IS_MP);
      m_logMP.add(new Item(IS_MP,ctm,ctm.getSpHandle(),ctm.getTxnId()));
      m_lastMpHandle=Math.max(m_lastMpHandle,ctm.getTxnId());
      m_lastSpHandle=ctm.getSpHandle();
    }
  }
 else   if (msg instanceof DumpMessage) {
    String who=CoreUtils.hsIdToString(m_HSId);
    tmLog.warn("Repair log dump for site: " + who + ", isLeader: "+ m_isLeader);
    tmLog.warn("" + who + ": lastSpHandle: "+ m_lastSpHandle+ ", lastMpHandle: "+ m_lastMpHandle);
    for (    Iv2RepairLogResponseMessage il : contents(0l,false)) {
      tmLog.warn("" + who + ": msg: "+ il);
    }
  }
}
