{
  VoltCompilerReader ddlReader=null;
  try {
    InMemoryJarfile jarfile=CatalogUtil.loadInMemoryJarFile(oldCatalogBytes);
    String oldDDL=new String(jarfile.get(VoltCompiler.AUTOGEN_DDL_FILE_NAME),Constants.UTF8ENCODING);
    StringBuilder sb=new StringBuilder();
    compilerLog.trace("OLD DDL: " + oldDDL);
    sb.append(oldDDL);
    sb.append("\n");
    compilerLog.info("Applying the following DDL to cluster:");
    for (    String stmt : adhocDDLStmts) {
      compilerLog.info("\t" + stmt);
      sb.append(stmt);
      sb.append(";\n");
    }
    compilerLog.trace("Adhoc-modified DDL:\n" + sb.toString());
    ddlReader=new VoltCompilerStringReader(VoltCompiler.AUTOGEN_DDL_FILE_NAME,sb.toString());
    ddlReader.putInJar(jarfile,VoltCompiler.AUTOGEN_DDL_FILE_NAME);
    VoltCompiler compiler=new VoltCompiler();
    compiler.compileInMemoryJarfile(jarfile);
    return jarfile.getFullJarBytes();
  }
  finally {
    if (ddlReader != null) {
      try {
        ddlReader.close();
      }
 catch (      IOException ioe) {
      }
    }
  }
}
