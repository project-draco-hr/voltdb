{
  flattenToSubMessageBuffer(buf);
  assert(buf.capacity() == buf.position());
  buf.limit(buf.position());
}
