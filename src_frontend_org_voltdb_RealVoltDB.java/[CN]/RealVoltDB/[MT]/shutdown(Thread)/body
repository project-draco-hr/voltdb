{
synchronized (m_startAndStopLock) {
    fivems.interrupt();
    fivems.join();
    m_faultManager.shutDown();
    if (m_hasStartedSampler.get()) {
      m_sampler.setShouldStop();
      m_sampler.join();
    }
    if (m_adminListener != null)     m_adminListener.stop();
    for (    ClientInterface ci : m_clientInterfaces) {
      ci.shutdown();
    }
    ExportManager.instance().shutdown();
    if (m_localSites != null) {
      for (      ExecutionSite site : m_localSites.values())       site.startShutdown();
    }
    if (m_siteThreads != null) {
      for (      Thread siteThread : m_siteThreads.values()) {
        if (Thread.currentThread().equals(siteThread) == false) {
          siteThread.join();
        }
      }
    }
    if (mainSiteThread != null) {
      if (Thread.currentThread().equals(mainSiteThread) == false) {
        mainSiteThread.join();
      }
    }
    m_localSites=null;
    m_currentThreadSite=null;
    m_siteThreads=null;
    m_runners=null;
    if (m_messenger != null) {
      m_messenger.shutdown();
    }
    if (m_network != null) {
      m_network.shutdown();
    }
    m_messenger=null;
    m_network=null;
    m_statsAgent=new StatsAgent();
    m_clientInterfaces.clear();
    ExportManager.instance().shutdown();
    System.gc();
    m_isRunning=false;
  }
}
