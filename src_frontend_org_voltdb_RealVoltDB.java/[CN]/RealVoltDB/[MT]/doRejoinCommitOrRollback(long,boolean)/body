{
  if (currentTxnId == lastNodeRejoinFinish_txnId) {
    return null;
  }
 else   if (currentTxnId < lastNodeRejoinFinish_txnId) {
    throw new RuntimeException("Trying to rejoin (commit/rollback) with an old transaction.");
  }
  HostMessenger messenger=getHostMessenger();
  if (commit) {
    HostMessenger.JoiningNodeInfo joinNodeInfo=messenger.rejoinForeignHostCommit();
    ArrayList<Integer> rejoiningSiteIds=new ArrayList<Integer>();
    ArrayList<Integer> rejoiningExecSiteIds=new ArrayList<Integer>();
    Cluster cluster=m_catalogContext.catalog.getClusters().get("cluster");
    for (    Site site : cluster.getSites()) {
      int siteId=Integer.parseInt(site.getTypeName());
      int hostId=Integer.parseInt(site.getHost().getTypeName());
      if (hostId == joinNodeInfo.hostId) {
        assert(site.getIsup() == false);
        rejoiningSiteIds.add(siteId);
        if (site.getIsexec() == true) {
          rejoiningExecSiteIds.add(siteId);
        }
      }
    }
    assert(rejoiningSiteIds.size() > 0);
    StringBuilder newIds=new StringBuilder();
    for (    int siteId : rejoiningSiteIds) {
      newIds.append(siteId).append(",");
    }
    newIds.setLength(newIds.length() - 1);
    hostLog.error("Host joined, hostname: " + joinNodeInfo.hostName);
    hostLog.error("  Host ID: " + joinNodeInfo.hostId);
    hostLog.error("  Adding sites to cluster: " + newIds);
    StringBuilder sb=new StringBuilder();
    for (    int siteId : rejoiningSiteIds) {
      sb.append("set ");
      String site_path=VoltDB.instance().getCatalogContext().catalog.getClusters().get("cluster").getSites().get(Integer.toString(siteId)).getPath();
      sb.append(site_path).append(" ").append("isUp true");
      sb.append("\n");
    }
    String catalogDiffCommands=sb.toString();
    clusterUpdate(catalogDiffCommands);
    for (    ClientInterface ci : m_clientInterfaces) {
      TransactionInitiator initiator=ci.getInitiator();
      initiator.notifyExecutonSiteRejoin(rejoiningExecSiteIds);
    }
  }
 else {
    messenger.rejoinForeginHostRollback();
  }
  lastNodeRejoinFinish_txnId=currentTxnId;
  return null;
}
