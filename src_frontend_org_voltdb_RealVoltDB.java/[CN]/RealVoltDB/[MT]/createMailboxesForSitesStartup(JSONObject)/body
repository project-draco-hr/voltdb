{
  ArrayDeque<Mailbox> mailboxes=new ArrayDeque<Mailbox>();
  ClusterConfig clusterConfig=new ClusterConfig(topo);
  if (!clusterConfig.validate()) {
    VoltDB.crashLocalVoltDB(clusterConfig.getErrorMsg(),false,null);
  }
  List<Integer> partitions=ClusterConfig.partitionsForHost(topo,m_messenger.getHostId());
  m_configuredNumberOfPartitions=clusterConfig.getPartitionCount();
  assert(partitions.size() == clusterConfig.getSitesPerHost());
  for (  Integer partition : partitions) {
    Mailbox mailbox=m_messenger.createMailbox();
    mailboxes.add(mailbox);
    MailboxNodeContent mnc=new MailboxNodeContent(mailbox.getHSId(),partition);
    m_mailboxPublisher.registerMailbox(MailboxType.ExecutionSite,mnc);
  }
  return Pair.of(mailboxes,clusterConfig);
}
