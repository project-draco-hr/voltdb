{
  SiteTracker oldTracker=m_siteTracker;
  m_siteTracker=new SiteTracker(m_myHostId,mailboxes);
  if (m_validateConfiguredNumberOfPartitionsOnMailboxUpdate) {
    if (m_siteTracker.m_numberOfPartitions != m_configuredNumberOfPartitions) {
      VoltDB.crashGlobalVoltDB("Configured number of partitions " + m_configuredNumberOfPartitions + " is not the same as the number of partitions present "+ m_siteTracker.m_numberOfPartitions,true,null);
    }
    if (m_siteTracker.m_numberOfPartitions != oldTracker.m_numberOfPartitions) {
      VoltDB.crashGlobalVoltDB("Configured number of partitions in new tracker" + m_siteTracker.m_numberOfPartitions + " is not the same as the number of partitions present "+ oldTracker.m_numberOfPartitions,true,null);
    }
  }
  if (oldTracker != null) {
    HashSet<Long> deltaRemoved=new HashSet<Long>(oldTracker.m_allSitesImmutable);
    deltaRemoved.removeAll(m_siteTracker.m_allSitesImmutable);
    if (!deltaRemoved.isEmpty()) {
      m_faultManager.reportFault(new SiteFailureFault(new ArrayList<Long>(deltaRemoved)));
    }
    HashSet<Long> deltaAdded=new HashSet<Long>(m_siteTracker.m_allSitesImmutable);
    deltaAdded.removeAll(oldTracker.m_allSitesImmutable);
    List<Future<?>> updateTasks=new ArrayList<Future<?>>();
    if (!deltaAdded.isEmpty()) {
      for (      ClientInterface ci : getClientInterfaces()) {
        ci.notifySitesAdded(deltaAdded);
      }
      for (      ExecutionSite es : getLocalSites().values()) {
        updateTasks.add(es.notifySitesAdded());
      }
    }
    boolean hadException=false;
    for (    Future<?> task : updateTasks) {
      try {
        task.get();
      }
 catch (      Exception e) {
        hadException=true;
        hostLog.fatal("Error processing topology update at execution site",e);
      }
    }
    if (hadException) {
      VoltDB.crashLocalVoltDB("Error processing topology update",false,null);
    }
  }
}
