{
  SiteTracker oldTracker=m_siteTracker;
  m_siteTracker=new SiteTracker(m_myHostId,mailboxes,oldTracker != null ? oldTracker.m_version + 1 : 0);
  if (!isIV2Enabled()) {
    if (m_validateConfiguredNumberOfPartitionsOnMailboxUpdate) {
      if (m_siteTracker.m_numberOfPartitions != m_configuredNumberOfPartitions) {
        VoltDB.crashGlobalVoltDB("Configured number of partitions " + m_configuredNumberOfPartitions + " is not the same as the number of partitions present "+ m_siteTracker.m_numberOfPartitions,true,null);
      }
      if (m_siteTracker.m_numberOfPartitions != oldTracker.m_numberOfPartitions) {
        VoltDB.crashGlobalVoltDB("Configured number of partitions in new tracker" + m_siteTracker.m_numberOfPartitions + " is not the same as the number of partitions present "+ oldTracker.m_numberOfPartitions,true,null);
      }
    }
    if (oldTracker != null) {
      HashSet<Long> deltaRemoved=new HashSet<Long>(oldTracker.m_allSitesImmutable);
      deltaRemoved.removeAll(m_siteTracker.m_allSitesImmutable);
      if (!deltaRemoved.isEmpty()) {
        m_faultManager.reportFault(new SiteFailureFault(new ArrayList<Long>(deltaRemoved)));
      }
      HashSet<Long> deltaAdded=new HashSet<Long>(m_siteTracker.m_allSitesImmutable);
      deltaAdded.removeAll(oldTracker.m_allSitesImmutable);
      if (!deltaAdded.isEmpty()) {
        for (        SimpleDtxnInitiator dtxn : m_dtxns) {
          Set<Long> copy=new HashSet<Long>(m_siteTracker.m_allExecutionSitesImmutable);
          copy.retainAll(deltaAdded);
          dtxn.notifyExecutionSiteRejoin(new ArrayList<Long>(copy));
        }
        for (        ExecutionSite es : getLocalSites().values()) {
          es.notifySitesAdded(m_siteTracker);
        }
      }
    }
  }
  if (ExportManager.instance() != null) {
    ExportManager.instance().notifyOfClusterTopologyChange();
  }
}
