{
  ArrayDeque<Mailbox> mailboxes=new ArrayDeque<Mailbox>();
  int sitesperhost=m_deployment.getCluster().getSitesperhost();
  int hostcount=m_deployment.getCluster().getHostcount();
  int kfactor=m_deployment.getCluster().getKfactor();
  ClusterConfig clusterConfig=new ClusterConfig(hostcount,sitesperhost,kfactor);
  if (!clusterConfig.validate()) {
    VoltDB.crashLocalVoltDB(clusterConfig.getErrorMsg(),false,null);
  }
  JSONObject topo=registerClusterConfig(clusterConfig);
  List<Integer> partitions=ClusterConfig.partitionsForHost(topo,m_messenger.getHostId());
  m_configuredNumberOfPartitions=partitions.size();
  assert(partitions.size() == sitesperhost);
  for (  Integer partition : partitions) {
    Mailbox mailbox=m_messenger.createMailbox();
    mailboxes.add(mailbox);
    registerExecutionSiteMailbox(mailbox.getHSId(),partition);
  }
  return Pair.of(mailboxes,clusterConfig);
}
