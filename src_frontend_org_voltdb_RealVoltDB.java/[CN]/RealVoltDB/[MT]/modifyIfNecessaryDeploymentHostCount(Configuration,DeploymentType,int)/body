{
  Optional<byte[]> deploymentBytes=Optional.empty();
  if ((depl.getCluster().getKfactor() + 1) > hostCount) {
    VoltDB.crashLocalVoltDB("Number of cluster members " + hostCount + " must be greater than ksafety "+ depl.getCluster().getKfactor(),false,null);
    return Optional.empty();
  }
  if (hostCount != VoltDB.UNDEFINED && depl.getCluster().getHostcount() != hostCount) {
    depl.getCluster().setHostcount(hostCount);
    String remarshalled=null;
    try {
      remarshalled=CatalogUtil.getDeployment(depl,true);
    }
 catch (    IOException|RuntimeException e) {
      VoltDB.crashLocalVoltDB("Unable to save deployment configuration",false,e);
      return Optional.empty();
    }
    deploymentBytes=Optional.of(remarshalled.getBytes(StandardCharsets.UTF_8));
    try (FileWriter fw=new FileWriter(getConfigLogDeployment(config))){
      fw.write(remarshalled);
    }
 catch (    IOException|RuntimeException e) {
      VoltDB.crashLocalVoltDB("Unable to save deployment configuration",false,e);
      return Optional.empty();
    }
  }
  return deploymentBytes;
}
