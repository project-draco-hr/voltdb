{
  String tableName=tableNode.attributes.get("table");
  assert(tableName != null);
  String tableAlias=tableNode.attributes.get("tablealias");
  if (tableAlias == null) {
    tableAlias=tableName;
  }
  AbstractParsedStmt subquery=parseSubQuery(tableNode);
  int aliasIdx=addTableToStmtCache(tableName,tableAlias,subquery);
  AbstractExpression joinExpr=parseJoinCondition(tableNode);
  AbstractExpression whereExpr=parseWhereCondition(tableNode);
  StmtTableScan tableScan=stmtCache.get(aliasIdx);
  if (tableScan instanceof StmtTargetTableScan) {
    Table table=((StmtTargetTableScan)tableScan).getTargetTable();
    tableList.add(table);
  }
  int nodeId=(joinTree == null) ? 0 : joinTree.getId() + 1;
  JoinNode leafNode=(subquery == null) ? new TableLeafNode(nodeId,aliasIdx,joinExpr,whereExpr) : new SubqueryLeafNode(nodeId,aliasIdx,joinExpr,whereExpr,new StmtSubqueryScan(tableAlias,subquery));
  if (joinTree == null) {
    joinTree=leafNode;
  }
 else {
    JoinType joinType=JoinType.get(tableNode.attributes.get("jointype"));
    assert(joinType != JoinType.INVALID);
    if (joinType == JoinType.FULL) {
      throw new PlanningErrorException("VoltDB does not support full outer joins");
    }
    JoinNode joinNode=new BranchNode(nodeId + 1,joinType,joinTree,leafNode);
    joinTree=joinNode;
  }
}
