{
  ServerThread server=null;
  Client client=null;
  try {
    TableHelper.randomFill(t1,1000,1024,new Random(0));
    String catPath1=catalogPathForTable(t1,"t1.jar");
    String catPath2=catalogPathForTable(t2,"t2.jar");
    byte[] catBytes2=CatalogUtil.toBytes(new File(catPath2));
    DeploymentBuilder depBuilder=new DeploymentBuilder();
    depBuilder.setVoltRoot("/tmp/jhugg/foobar");
    String deployment=depBuilder.getXML();
    File deploymentFile=VoltProjectBuilder.writeStringToTempFile(deployment);
    VoltDB.Configuration config=new VoltDB.Configuration();
    config.m_pathToDeployment=deploymentFile.getAbsolutePath();
    config.m_pathToCatalog=catPath1;
    config.m_ipcPorts=new ArrayList<Integer>();
    config.m_ipcPorts.add(10000);
    server=new ServerThread(config);
    server.start();
    server.waitForInitialization();
    System.out.printf("PRE:  %s\n",TableHelper.ddlForTable(t1));
    System.out.printf("POST: %s\n",TableHelper.ddlForTable(t2));
    TableHelper.migrateTable(t1,t2);
    ClientConfig clientConfig=new ClientConfig();
    client=ClientFactory.createClient(clientConfig);
    client.createConnection("localhost");
    client.callProcedure("@LoadMultipartitionTable","FOO",t1);
    ClientResponseImpl response=(ClientResponseImpl)client.callProcedure("@UpdateApplicationCatalog",catBytes2,deployment);
    System.out.println(response.toJSONString());
    VoltTable t3=client.callProcedure("@AdHoc","select * from FOO").getResults()[0];
    StringBuilder sb=new StringBuilder();
    if (!TableHelper.deepEqualsWithErrorMsg(t2,t3,sb)) {
      System.out.println("Table Mismatch");
      System.out.println(sb.toString());
      fail();
    }
  }
  finally {
    if (client != null) {
      client.close();
    }
    if (server != null) {
      server.shutdown();
    }
  }
}
