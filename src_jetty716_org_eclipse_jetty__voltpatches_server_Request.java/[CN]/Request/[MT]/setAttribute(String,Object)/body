{
  Object old_value=_attributes == null ? null : _attributes.getAttribute(name);
  if ("org.eclipse.jetty_voltpatches.server.Request.queryEncoding".equals(name))   setQueryEncoding(value == null ? null : value.toString());
 else   if ("org.eclipse.jetty_voltpatches.server.sendContent".equals(name)) {
    try {
      ((HttpConnection.Output)getServletResponse().getOutputStream()).sendContent(value);
    }
 catch (    IOException e) {
      throw new RuntimeException(e);
    }
  }
 else   if ("org.eclipse.jetty_voltpatches.server.ResponseBuffer".equals(name)) {
    try {
      final ByteBuffer byteBuffer=(ByteBuffer)value;
synchronized (byteBuffer) {
        NIOBuffer buffer=byteBuffer.isDirect() ? new DirectNIOBuffer(byteBuffer,true) : new IndirectNIOBuffer(byteBuffer,true);
        ((HttpConnection.Output)getServletResponse().getOutputStream()).sendResponse(buffer);
      }
    }
 catch (    IOException e) {
      throw new RuntimeException(e);
    }
  }
  if (_attributes == null)   _attributes=new AttributesMap();
  _attributes.setAttribute(name,value);
  if (_requestAttributeListeners != null) {
    final ServletRequestAttributeEvent event=new ServletRequestAttributeEvent(_context,this,name,old_value == null ? value : old_value);
    final int size=LazyList.size(_requestAttributeListeners);
    for (int i=0; i < size; i++) {
      final EventListener listener=(ServletRequestAttributeListener)LazyList.get(_requestAttributeListeners,i);
      if (listener instanceof ServletRequestAttributeListener) {
        final ServletRequestAttributeListener l=(ServletRequestAttributeListener)listener;
        if (old_value == null)         l.attributeAdded(event);
 else         if (value == null)         l.attributeRemoved(event);
 else         l.attributeReplaced(event);
      }
    }
  }
}
