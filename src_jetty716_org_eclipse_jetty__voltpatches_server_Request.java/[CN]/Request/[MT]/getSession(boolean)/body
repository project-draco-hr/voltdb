{
  if (_sessionManager == null && create)   throw new IllegalStateException("No SessionManager");
  if (_session != null && _sessionManager != null && _sessionManager.isValid(_session))   return _session;
  _session=null;
  String id=getRequestedSessionId();
  if (id != null && _sessionManager != null) {
    _session=_sessionManager.getHttpSession(id);
    if (_session == null && !create)     return null;
  }
  if (_session == null && _sessionManager != null && create) {
    _session=_sessionManager.newHttpSession(this);
    HttpCookie cookie=_sessionManager.getSessionCookie(_session,getContextPath(),isSecure());
    if (cookie != null)     _connection.getResponse().addCookie(cookie);
  }
  return _session;
}
