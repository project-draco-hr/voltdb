{
  super();
  m_site=site;
  m_sc=sc;
  m_mailbox=mailbox;
  m_engine=engine;
  m_siteId=siteId;
  m_destinationSiteId=destinationSiteId;
  m_destinationStoppedBeforeTxnId=destinationTxnId;
  m_messageHandler=messageHandler;
  for (  Map.Entry<Pair<String,Integer>,HashSet<Long>> entry : tableToSites.entrySet()) {
    if (entry.getValue().isEmpty()) {
      continue;
    }
    m_tablesToStream.add(new RecoveryTable(entry.getKey().getFirst(),entry.getKey().getSecond(),entry.getValue()));
  }
  m_onCompletion=onCompletion;
  RecoveryTable table=m_tablesToStream.peek();
  if (!m_engine.activateTableStream(table.m_tableId,TableStreamType.RECOVERY)) {
    VoltDB.crashLocalVoltDB("Attempted to activate recovery stream for table " + table.m_name + " and failed",false,null);
  }
  m_outThread.start();
  m_inThread.start();
}
