{
  m_mailbox=mailbox;
  m_engine=engine;
  m_siteId=siteId;
  for (  Map.Entry<Pair<String,Integer>,HashSet<Integer>> entry : tableToSites.entrySet()) {
    if (entry.getValue().isEmpty()) {
      continue;
    }
    m_tablesToStream.add(new RecoveryTable(entry.getKey().getFirst(),entry.getKey().getSecond(),entry.getValue()));
  }
  m_onCompletion=onCompletion;
  if (m_tablesToStream.isEmpty()) {
    onCompletion.run();
    return;
  }
  RecoveryTable table=m_tablesToStream.peek();
  if (!m_engine.activateTableStream(table.m_tableId,TableStreamType.RECOVERY)) {
    hostLog.error("Attempted to activate recovery stream for table " + table.m_name + " and failed");
    VoltDB.crashVoltDB();
  }
  initializeBufferPool();
}
