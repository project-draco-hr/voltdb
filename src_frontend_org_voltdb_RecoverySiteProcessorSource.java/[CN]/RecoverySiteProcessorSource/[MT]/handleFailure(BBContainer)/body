{
  container.b.clear();
  while (!m_tablesToStream.isEmpty()) {
    ByteBuffer buffer=container.b;
    RecoveryMessage rm=new RecoveryMessage(container,m_siteId,m_blockIndex++);
    buffer.clear();
    buffer.position(RecoveryMessage.getHeaderLength());
    RecoveryTable table=m_tablesToStream.peek();
    int serialized=m_engine.tableStreamSerializeMore(container,table.m_tableId,TableStreamType.RECOVERY);
    if (serialized <= 0) {
      VoltDB.crashVoltDB();
    }
 else {
      buffer.limit(buffer.position() + serialized);
    }
    assert(rm != null);
    if (rm.type() == RecoveryMessageType.Complete) {
      m_tablesToStream.clear();
    }
  }
}
