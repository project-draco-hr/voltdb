{
  if (response.isMispartitioned()) {
    assert(invocation != null);
    int partitionParamIndex;
    int partitionParamType;
    boolean isReadonly;
    boolean allowMismatchedResults;
    if (sysProc != null) {
      partitionParamIndex=0;
      partitionParamType=((Byte)invocation.getParameterAtIndex(1)).intValue();
      isReadonly=sysProc.getReadonly();
      allowMismatchedResults=false;
    }
 else {
      assert(catProc != null);
      partitionParamIndex=catProc.getPartitionparameter();
      partitionParamType=catProc.getPartitioncolumn().getType();
      isReadonly=catProc.getReadonly();
      allowMismatchedResults=catProc.getReadonly() && isProcedureNonDeterministic(catProc);
    }
    try {
      int partition=getPartitionForProcedure(partitionParamIndex,partitionParamType,invocation);
      createTransaction(cihm.connection.connectionId(),null,false,invocation,isReadonly,true,false,new int[]{partition},1,cihm.connection,messageSize,now,allowMismatchedResults);
      return true;
    }
 catch (    Exception e) {
      assert(clientResponse == null);
      clientResponse=new ClientResponseImpl(ClientResponse.UNEXPECTED_FAILURE,new VoltTable[]{},"Fail to get the partition for a restarted transaction" + e.getMessage());
    }
  }
  return false;
}
