{
  ClientInterfaceHandleManager.Iv2InFlight clientData;
  if (clientResponse != null && clientResponse.getStatusString() != null && clientResponse.getStatusString().equals(ClientResponseImpl.IGNORED_TRANSACTION)) {
    clientData=cihm.removeHandle(response.getClientInterfaceHandle());
  }
 else {
    clientData=cihm.findHandle(response.getClientInterfaceHandle());
  }
  if (clientData == null) {
    return new ByteBuffer[]{};
  }
  if (restartTransaction(clientData.m_messageSize,clientData.m_creationTimeNanos)) {
    return new ByteBuffer[]{};
  }
  final long now=System.nanoTime();
  final long delta=now - clientData.m_creationTimeNanos;
  cihm.m_acg.logTransactionCompleted(cihm.connection.connectionId(),cihm.connection.getHostnameOrIP(),clientData.m_procName,delta,clientResponse.getStatus());
  clientResponse.setClientHandle(clientData.m_clientHandle);
  clientResponse.setClusterRoundtrip((int)TimeUnit.NANOSECONDS.toMillis(delta));
  clientResponse.setHash(null);
  ByteBuffer results=ByteBuffer.allocate(clientResponse.getSerializedSize() + 4);
  results.putInt(results.capacity() - 4);
  clientResponse.flattenToBuffer(results);
  return new ByteBuffer[]{results};
}
