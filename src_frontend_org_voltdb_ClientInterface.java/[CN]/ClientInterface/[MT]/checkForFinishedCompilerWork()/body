{
  if (m_asyncCompilerWorkThread == null)   return;
  AsyncCompilerResult result=null;
  while ((result=m_asyncCompilerWorkThread.getPlannedStmt()) != null) {
    if (result.errorMsg == null) {
      if (result instanceof AdHocPlannedStmt) {
        final AdHocPlannedStmt plannedStmt=(AdHocPlannedStmt)result;
        if (plannedStmt.catalogVersion != m_catalogContext.get().catalogVersion) {
          m_asyncCompilerWorkThread.planSQL(plannedStmt.sql,plannedStmt.clientHandle,plannedStmt.connectionId,plannedStmt.hostname,plannedStmt.adminConnection,plannedStmt.clientData);
        }
 else {
          StoredProcedureInvocation task=new StoredProcedureInvocation();
          task.procName="@AdHoc";
          task.params=new FutureTask<ParameterSet>(new Callable<ParameterSet>(){
            @Override public ParameterSet call(){
              ParameterSet params=new ParameterSet();
              params.m_params=new Object[]{plannedStmt.aggregatorFragment,plannedStmt.collectorFragment,plannedStmt.sql,plannedStmt.isReplicatedTableDML ? 1 : 0};
              return params;
            }
          }
);
          task.clientHandle=plannedStmt.clientHandle;
          FastSerializer fs=new FastSerializer();
          try {
            fs.writeObject(task);
            ByteBuffer source=fs.getBuffer();
            ByteBuffer copy=ByteBuffer.allocate(source.remaining());
            copy.put(source);
            copy.flip();
            FastDeserializer fds=new FastDeserializer(copy);
            task=new StoredProcedureInvocation();
            task.readExternal(fds);
          }
 catch (          Exception e) {
            hostLog.fatal(e);
            VoltDB.crashVoltDB();
          }
          m_initiator.createTransaction(plannedStmt.connectionId,plannedStmt.hostname,plannedStmt.adminConnection,task,false,false,false,m_allPartitions,m_allPartitions.length,plannedStmt.clientData,0,EstTime.currentTimeMillis());
        }
      }
 else       if (result instanceof CatalogChangeResult) {
        final CatalogChangeResult changeResult=(CatalogChangeResult)result;
        StoredProcedureInvocation task=new StoredProcedureInvocation();
        task.procName="@UpdateApplicationCatalog";
        task.params=new FutureTask<ParameterSet>(new Callable<ParameterSet>(){
          @Override public ParameterSet call(){
            ParameterSet params=new ParameterSet();
            params.m_params=new Object[]{changeResult.encodedDiffCommands,changeResult.catalogBytes,changeResult.expectedCatalogVersion,changeResult.deploymentString,changeResult.deploymentCRC};
            return params;
          }
        }
);
        task.clientHandle=changeResult.clientHandle;
        FastSerializer fs=new FastSerializer();
        try {
          fs.writeObject(task);
          ByteBuffer source=fs.getBuffer();
          ByteBuffer copy=ByteBuffer.allocate(source.remaining());
          copy.put(source);
          copy.flip();
          FastDeserializer fds=new FastDeserializer(copy);
          task=new StoredProcedureInvocation();
          task.readExternal(fds);
        }
 catch (        Exception e) {
          hostLog.fatal(e);
          VoltDB.crashVoltDB();
        }
        m_initiator.createTransaction(changeResult.connectionId,changeResult.hostname,changeResult.adminConnection,task,false,true,true,m_allPartitions,m_allPartitions.length,changeResult.clientData,0,EstTime.currentTimeMillis());
      }
 else {
        throw new RuntimeException("Should not be able to get here (ClientInterface.checkForFinishedCompilerWork())");
      }
    }
 else {
      ClientResponseImpl errorResponse=new ClientResponseImpl(ClientResponseImpl.UNEXPECTED_FAILURE,new VoltTable[0],result.errorMsg,result.clientHandle);
      final Connection c=(Connection)result.clientData;
      c.writeStream().enqueue(errorResponse);
    }
  }
}
