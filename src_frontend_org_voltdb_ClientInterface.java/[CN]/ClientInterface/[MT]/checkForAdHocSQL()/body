{
  if (m_plannerThread == null)   return;
  AdHocPlannedStmt plannedStmt=null;
  while ((plannedStmt=m_plannerThread.getPlannedStmt()) != null) {
    if (plannedStmt.errorMsg == null) {
      StoredProcedureInvocation task=new StoredProcedureInvocation();
      task.procName="@AdHocSQL";
      task.params=new ParameterSet();
      task.params.m_params=new Object[]{plannedStmt.aggregatorFragment,plannedStmt.collectorFragment,plannedStmt.sql,plannedStmt.isReplicatedTableDML ? 1 : 0};
      task.clientHandle=plannedStmt.clientHandle;
      m_initiator.createTransaction(plannedStmt.connectionId,task,false,false,m_allPartitions,m_allPartitions.length,plannedStmt.clientData);
    }
 else {
      ClientResponseImpl errorResponse=new ClientResponseImpl(ClientResponseImpl.UNEXPECTED_FAILURE,new VoltTable[0],plannedStmt.errorMsg,plannedStmt.clientHandle);
      final Connection c=(Connection)plannedStmt.clientData;
      c.writeStream().enqueue(errorResponse);
    }
  }
}
