{
synchronized (this) {
    if (_buffer != null && !_bufferOut) {
      _bufferOut=true;
      return _buffer;
    }
    if (_buffer != null && _header != null && _header.capacity() == _buffer.capacity() && !_headerOut) {
      _headerOut=true;
      return _header;
    }
    if (_buffer != null)     return new ByteArrayBuffer(_buffer.capacity());
    return new ByteArrayBuffer(4096);
  }
}
