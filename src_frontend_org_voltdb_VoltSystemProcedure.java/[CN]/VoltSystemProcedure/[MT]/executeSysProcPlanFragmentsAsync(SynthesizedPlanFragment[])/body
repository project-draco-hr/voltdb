{
  for (  SynthesizedPlanFragment pf : pfs) {
    assert(!(pf.multipartition && pf.nonExecSites));
    assert(pf.parameters != null);
    if (pf.multipartition)     assert((pf.outputDepId & DtxnConstants.MULTIPARTITION_DEPENDENCY) == DtxnConstants.MULTIPARTITION_DEPENDENCY);
    if (pf.nonExecSites)     assert((pf.outputDepId & DtxnConstants.MULTINODE_DEPENDENCY) == DtxnConstants.MULTINODE_DEPENDENCY);
    ByteBuffer parambytes=null;
    if (pf.parameters != null) {
      FastSerializer fs=new FastSerializer();
      try {
        fs.writeObject(pf.parameters);
      }
 catch (      IOException e) {
        e.printStackTrace();
        assert(false);
      }
      parambytes=fs.getBuffer();
    }
    FragmentTask task=new FragmentTask(m_currentTxnState.initiatorSiteId,m_site.getCorrespondingSiteId(),m_currentTxnState.txnId,false,new long[]{pf.fragmentId},new int[]{pf.outputDepId},new ByteBuffer[]{parambytes},false);
    if (pf.inputDepIds != null) {
      for (      int depId : pf.inputDepIds) {
        task.addInputDepId(0,depId);
      }
    }
    task.setFragmentTaskType(FragmentTask.SYS_PROC_PER_SITE);
    if (pf.suppressDuplicates) {
      task.setFragmentTaskType(FragmentTask.SYS_PROC_PER_PARTITION);
    }
    if (pf.multipartition) {
      m_currentTxnState.createAllParticipatingFragmentWork(task);
    }
 else     if (pf.nonExecSites) {
      final HashMap<Host,String> foundHosts=new HashMap<Host,String>();
      final ArrayList<Integer> sites=new ArrayList<Integer>();
      for (      Site site : VoltDB.instance().getCatalogContext().siteTracker.getUpSites()) {
        if (site.getIsexec() && (foundHosts.containsKey(site.getHost()) == false)) {
          foundHosts.put(site.getHost(),site.getTypeName());
          int siteId=Integer.parseInt(site.getTypeName());
          sites.add(siteId);
        }
      }
      int[] destinations=new int[sites.size()];
      for (int i=0; i < sites.size(); i++)       destinations[i]=sites.get(i);
      m_currentTxnState.createFragmentWork(destinations,task);
    }
 else {
      if (pf.siteId == -1)       m_currentTxnState.createLocalFragmentWork(task,false);
 else       m_currentTxnState.createFragmentWork(new int[]{pf.siteId},task);
    }
  }
}
