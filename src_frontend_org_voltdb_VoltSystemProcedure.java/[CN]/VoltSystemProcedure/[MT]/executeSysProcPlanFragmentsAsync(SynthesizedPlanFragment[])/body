{
  for (  SynthesizedPlanFragment pf : pfs) {
    assert(!(pf.multipartition && pf.nonExecSites));
    assert(pf.parameters != null);
    ByteBuffer parambytes=null;
    if (pf.parameters != null) {
      FastSerializer fs=new FastSerializer();
      try {
        fs.writeObject(pf.parameters);
      }
 catch (      IOException e) {
        e.printStackTrace();
        assert(false);
      }
      parambytes=fs.getBuffer();
    }
    FragmentTask task=new FragmentTask(m_currentTxnState.initiatorSiteId,m_site.siteId,m_currentTxnState.txnId,false,new long[]{pf.fragmentId},new int[]{pf.outputDepId},new ByteBuffer[]{parambytes},false);
    if (pf.inputDepIds != null)     for (    int depId : pf.inputDepIds)     task.addInputDepId(0,depId);
    task.setFragmentTaskType(FragmentTask.SYS_PROC_PER_SITE);
    if (pf.suppressDuplicates) {
      task.setFragmentTaskType(FragmentTask.SYS_PROC_PER_PARTITION);
    }
    if (pf.multipartition) {
      m_site.createAllParticipatingWork(task);
    }
 else     if (pf.nonExecSites) {
      final HashMap<Host,String> foundHosts=new HashMap<Host,String>();
      final ArrayList<Integer> sites=new ArrayList<Integer>();
      for (      Site site : m_cluster.getSites()) {
        if (site.getIsexec() && (foundHosts.containsKey(site.getHost()) == false)) {
          foundHosts.put(site.getHost(),site.getTypeName());
          int siteId=Integer.parseInt(site.getTypeName());
          sites.add(siteId);
        }
      }
      int[] destinations=new int[sites.size()];
      for (int i=0; i < sites.size(); i++)       destinations[i]=sites.get(i);
      m_site.createWork(destinations,task);
    }
 else {
      if (pf.siteId == -1)       m_site.createLocalWork(task,false);
 else       m_site.createWork(new int[]{pf.siteId},task);
    }
  }
}
