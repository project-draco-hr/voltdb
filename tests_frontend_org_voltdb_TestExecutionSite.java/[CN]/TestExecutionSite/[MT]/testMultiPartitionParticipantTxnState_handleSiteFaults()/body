{
  StoredProcedureInvocation spi=new StoredProcedureInvocation();
  spi.setClientHandle(25);
  spi.setProcName("johnisgreat");
  spi.setParams("commit",57,"gooniestoo");
  InitiateTaskMessage mn=new InitiateTaskMessage(-1,-1,-1,false,false,spi,Long.MIN_VALUE);
  mn.setNonCoordinatorSites(new int[]{1,2,3,4,5});
  MultiPartitionParticipantTxnState ts=new MultiPartitionParticipantTxnState(m_mboxes[0],m_sites[0],mn);
  ArrayList<Integer> failedSites=new ArrayList<Integer>();
  failedSites.add(1);
  failedSites.add(2);
  failedSites.add(3);
  failedSites.add(5);
  ts.handleSiteFaults(failedSites);
  ExecutorTxnState dumpContents=ts.getDumpContents();
  assertEquals(1,dumpContents.nonCoordinatingSites.length);
  assertEquals(4,dumpContents.nonCoordinatingSites[0]);
  mn.setNonCoordinatorSites(new int[]{1,2,3,4,5});
  ts=new MultiPartitionParticipantTxnState(m_mboxes[0],m_sites[0],mn);
  failedSites.clear();
  failedSites.add(1);
  ts.handleSiteFaults(failedSites);
  dumpContents=ts.getDumpContents();
  assertEquals(4,dumpContents.nonCoordinatingSites.length);
  assertEquals(2,dumpContents.nonCoordinatingSites[0]);
  assertEquals(3,dumpContents.nonCoordinatingSites[1]);
  assertEquals(4,dumpContents.nonCoordinatingSites[2]);
  assertEquals(5,dumpContents.nonCoordinatingSites[3]);
  mn.setNonCoordinatorSites(new int[]{1,2,3,4,5});
  ts=new MultiPartitionParticipantTxnState(m_mboxes[0],m_sites[0],mn);
  failedSites.clear();
  failedSites.add(6);
  failedSites.add(7);
  ts.handleSiteFaults(failedSites);
  dumpContents=ts.getDumpContents();
  assertEquals(5,dumpContents.nonCoordinatingSites.length);
  for (int i=0; i < 5; i++) {
    assertEquals(i + 1,dumpContents.nonCoordinatingSites[i]);
  }
}
