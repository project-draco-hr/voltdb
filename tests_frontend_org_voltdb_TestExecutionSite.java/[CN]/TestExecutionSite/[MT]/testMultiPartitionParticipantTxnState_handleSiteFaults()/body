{
  StoredProcedureInvocation spi=new StoredProcedureInvocation();
  spi.setClientHandle(25);
  spi.setProcName("johnisgreat");
  spi.setParams("commit",57,"gooniestoo");
  InitiateTaskMessage mn=new InitiateTaskMessage(-1,-1,-1,false,false,spi,Long.MIN_VALUE);
  MultiPartitionParticipantTxnState ts=new MultiPartitionParticipantTxnState(m_mboxes[0],m_sites[0],mn,false);
  HashSet<Integer> failedSites=new HashSet<Integer>();
  failedSites.add(1);
  failedSites.add(2);
  failedSites.add(3);
  failedSites.add(5);
  ts.handleSiteFaults(failedSites);
  ExecutorTxnState dumpContents=ts.getDumpContents();
  assertEquals(4,dumpContents.nonCoordinatingSites.length);
  assertEquals(4,dumpContents.nonCoordinatingSites[0]);
  ts=new MultiPartitionParticipantTxnState(m_mboxes[0],m_sites[0],mn,false);
  failedSites.clear();
  failedSites.add(1);
  ts.handleSiteFaults(failedSites);
  dumpContents=ts.getDumpContents();
  assertEquals(7,dumpContents.nonCoordinatingSites.length);
  assertEquals(2,dumpContents.nonCoordinatingSites[0]);
  assertEquals(3,dumpContents.nonCoordinatingSites[1]);
  assertEquals(4,dumpContents.nonCoordinatingSites[2]);
  assertEquals(5,dumpContents.nonCoordinatingSites[3]);
  assertEquals(6,dumpContents.nonCoordinatingSites[4]);
  assertEquals(7,dumpContents.nonCoordinatingSites[5]);
  assertEquals(8,dumpContents.nonCoordinatingSites[6]);
  ts=new MultiPartitionParticipantTxnState(m_mboxes[0],m_sites[0],mn,false);
  failedSites.clear();
  failedSites.add(9);
  failedSites.add(10);
  ts.handleSiteFaults(failedSites);
  dumpContents=ts.getDumpContents();
  assertEquals(8,dumpContents.nonCoordinatingSites.length);
  for (int i=0; i < 8; i++) {
    assertEquals(i + 1,dumpContents.nonCoordinatingSites[i]);
  }
}
