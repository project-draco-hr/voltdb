{
  if (response.isCommitted() || baseRequest.isHandled())   return;
  baseRequest.setHandled(true);
  String method=request.getMethod();
  if (_serveIcon && _favicon != null && method.equals(HttpMethods.GET) && request.getRequestURI().equals("/favicon.ico")) {
    if (request.getDateHeader(HttpHeaders.IF_MODIFIED_SINCE) == _faviconModified)     response.setStatus(HttpServletResponse.SC_NOT_MODIFIED);
 else {
      response.setStatus(HttpServletResponse.SC_OK);
      response.setContentType("image/x-icon");
      response.setContentLength(_favicon.length);
      response.setDateHeader(HttpHeaders.LAST_MODIFIED,_faviconModified);
      response.setHeader(HttpHeaders.CACHE_CONTROL,"max-age=360000,public");
      response.getOutputStream().write(_favicon);
    }
    return;
  }
  if (!method.equals(HttpMethods.GET) || !request.getRequestURI().equals("/")) {
    response.sendError(HttpServletResponse.SC_NOT_FOUND);
    return;
  }
  response.setStatus(HttpServletResponse.SC_NOT_FOUND);
  response.setContentType(MimeTypes.TEXT_HTML);
  ByteArrayISO8859Writer writer=new ByteArrayISO8859Writer(1500);
  String uri=request.getRequestURI();
  uri=StringUtil.replace(uri,"<","&lt;");
  uri=StringUtil.replace(uri,">","&gt;");
  writer.write("<HTML>\n<HEAD>\n<TITLE>Error 404 - Not Found");
  writer.write("</TITLE>\n<BODY>\n<H2>Error 404 - Not Found.</H2>\n");
  writer.write("No context on this server matched or handled this request.<BR>");
  if (_showContexts) {
    writer.write("Contexts known to this server are: <ul>");
    Server server=getServer();
    Handler[] handlers=server == null ? null : server.getChildHandlersByClass(ContextHandler.class);
    for (int i=0; handlers != null && i < handlers.length; i++) {
      ContextHandler context=(ContextHandler)handlers[i];
      if (context.isRunning()) {
        writer.write("<li><a href=\"");
        if (context.getVirtualHosts() != null && context.getVirtualHosts().length > 0)         writer.write("http://" + context.getVirtualHosts()[0] + ":"+ request.getLocalPort());
        writer.write(context.getContextPath());
        if (context.getContextPath().length() > 1 && context.getContextPath().endsWith("/"))         writer.write("/");
        writer.write("\">");
        writer.write(context.getContextPath());
        if (context.getVirtualHosts() != null && context.getVirtualHosts().length > 0)         writer.write("&nbsp;@&nbsp;" + context.getVirtualHosts()[0] + ":"+ request.getLocalPort());
        writer.write("&nbsp;--->&nbsp;");
        writer.write(context.toString());
        writer.write("</a></li>\n");
      }
 else {
        writer.write("<li>");
        writer.write(context.getContextPath());
        if (context.getVirtualHosts() != null && context.getVirtualHosts().length > 0)         writer.write("&nbsp;@&nbsp;" + context.getVirtualHosts()[0] + ":"+ request.getLocalPort());
        writer.write("&nbsp;--->&nbsp;");
        writer.write(context.toString());
        if (context.isFailed())         writer.write(" [failed]");
        if (context.isStopped())         writer.write(" [stopped]");
        writer.write("</li>\n");
      }
    }
  }
  for (int i=0; i < 10; i++)   writer.write("\n<!-- Padding for IE                  -->");
  writer.write("\n</BODY>\n</HTML>\n");
  writer.flush();
  response.setContentLength(writer.size());
  OutputStream out=response.getOutputStream();
  writer.writeTo(out);
  out.close();
}
