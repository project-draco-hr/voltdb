{
  Set<Table> tables_to_restore=getTablesToRestore(savefileState.getSavedTableNames());
  VoltTable[] restore_results=new VoltTable[1];
  restore_results[0]=constructResultsTable();
  ArrayList<SynthesizedPlanFragment[]> restorePlans=new ArrayList<SynthesizedPlanFragment[]>();
  for (  Table t : tables_to_restore) {
    TableSaveFileState table_state=savefileState.getTableState(t.getTypeName());
    SynthesizedPlanFragment[] restore_plan=table_state.generateRestorePlan(t,m_cluster.getSites());
    if (restore_plan == null) {
      HOST_LOG.error("Unable to generate restore plan for " + t.getTypeName() + " table not restored");
      throw new VoltAbortException("Unable to generate restore plan for " + t.getTypeName() + " table not restored");
    }
    restorePlans.add(restore_plan);
  }
  Iterator<Table> tableIterator=tables_to_restore.iterator();
  for (  SynthesizedPlanFragment[] restore_plan : restorePlans) {
    Table table=tableIterator.next();
    TableSaveFileState table_state=savefileState.getTableState(table.getTypeName());
    TRACE_LOG.trace("Performing restore for table: " + table.getTypeName());
    TRACE_LOG.trace("Plan has fragments: " + restore_plan.length);
    VoltTable[] results=executeSysProcPlanFragments(restore_plan,table_state.getRootDependencyId());
    while (results[0].advanceRow()) {
      restore_results[0].add(results[0]);
    }
  }
  return restore_results;
}
