{
  System.out.println("STARTING testFormatCurrency");
  Client client=getClient();
  ClientResponse cr=null;
  VoltTable result;
  String str;
  cr=client.callProcedure("@AdHoc","Delete from R3;");
  long n1=9223372036854775807L;
  BigDecimal bd=new BigDecimal("99999999999999999999999999.999999999999");
  BigDecimal nbd=new BigDecimal("-99999999999999999999999999.999999999999");
  cr=client.callProcedure("R3.insert",1,11,32023,2147483647,n1,2147483647999.123,"2013-07-18 02:00:00.123457","IBM",bd);
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  cr=client.callProcedure("R3.insert",2,-11,-32023,-2147483647,-n1,-2147483647999.123,"2013-07-18 02:00:00.123457","IBM",nbd);
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  bd=new BigDecimal("1.5");
  cr=client.callProcedure("R3.insert",3,11,32023,2147483647,n1,1.5,"2013-07-18 02:00:00.123457","IBM",bd);
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  bd=new BigDecimal("-1.5");
  cr=client.callProcedure("R3.insert",4,11,32023,2147483647,n1,-1.5,"2013-07-18 02:00:00.123457","IBM",bd);
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  bd=new BigDecimal("12340.596");
  cr=client.callProcedure("R3.insert",5,12,16000,1280000011,n1 - 10,1.508,"2013-07-18 02:00:00.123457","IBM",bd);
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  bd=new BigDecimal("-12340.596");
  cr=client.callProcedure("R3.insert",6,12,16000,1280000011,n1 - 10,-1.508,"2013-07-18 02:00:00.123457","IBM",bd);
  bd=new BigDecimal("12399.996");
  cr=client.callProcedure("R3.insert",7,12,16000,1280000011,n1 - 10,1.512,"2013-07-18 02:00:00.123457","IBM",bd);
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  bd=new BigDecimal("-12399.996");
  cr=client.callProcedure("R3.insert",8,12,16000,1280000011,n1 - 10,-1.512,"2013-07-18 02:00:00.123457","IBM",bd);
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  bd=new BigDecimal("12399.995");
  cr=client.callProcedure("R3.insert",9,12,16000,1280000011,n1 - 10,1.515,"2013-07-18 02:00:00.123457","IBM",bd);
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  bd=new BigDecimal("-12399.995");
  cr=client.callProcedure("R3.insert",10,12,16000,1280000011,n1 - 10,-1.515,"2013-07-18 02:00:00.123457","IBM",bd);
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  bd=new BigDecimal("12399.985");
  cr=client.callProcedure("R3.insert",11,12,16000,1280000011,n1 - 10,1.505,"2013-07-18 02:00:00.123457","IBM",bd);
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  bd=new BigDecimal("-12399.985");
  cr=client.callProcedure("R3.insert",12,12,16000,1280000011,n1 - 10,-1.505,"2013-07-18 02:00:00.123457","IBM",bd);
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(120, 2) from R3 where id = 1");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"120.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(123456, 2) from R3 where id = 1");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"123,456.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(1234567890.12345, 2) from R3 where id = 1");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"1,234,567,890.12");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(-120, 2) from R3 where id = 1");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"-120.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(-123456.789, 2) from R3 where id = 1");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"-123,456.79");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(tiny, 2) from R3 where id = 1");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"11.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(tiny, 2) from R3 where id = 2");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"-11.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(small, 2) from R3 where id = 1");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"32,023.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(small, 2) from R3 where id = 2");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"-32,023.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(num, 2) from R3 where id = 1");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"2,147,483,647.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(num, 2) from R3 where id = 2");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"-2,147,483,647.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(big, 2) from R3 where id = 1");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertTrue(str.equals("9,223,372,036,854,775,807.00"));
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(big, 2) from R3 where id = 2");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"-9,223,372,036,854,775,807.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(ratio, 2) from R3 where id = 1");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"2,147,483,647,999.12");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(ratio, 2) from R3 where id = 2");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"-2,147,483,647,999.12");
  try {
    cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(dec, 2) from R3 where id = 1");
    fail("range validity check failed for FORMAT_CURRENCY");
  }
 catch (  ProcCallException pcex) {
    assertTrue(pcex.getMessage().contains("out of range"));
  }
  try {
    cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(dec, 2) from R3 where id = 2");
    fail("range validity check failed for FORMAT_CURRENCY");
  }
 catch (  ProcCallException pcex) {
    assertTrue(pcex.getMessage().contains("out of range"));
  }
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(ratio, 2), FORMAT_CURRENCY(dec, 2) from R3 where id = 3");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"1.50");
  str=result.getString(1);
  assertEquals(str,"1.50");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(ratio, 2), FORMAT_CURRENCY(dec, 2) from R3 where id = 4");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"-1.50");
  str=result.getString(1);
  assertEquals(str,"-1.50");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(ratio, 2), FORMAT_CURRENCY(dec, 2) from R3 where id = 5");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"1.51");
  str=result.getString(1);
  assertEquals(str,"12,340.60");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(ratio, 2), FORMAT_CURRENCY(dec, 2) from R3 where id = 6");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"-1.51");
  str=result.getString(1);
  assertEquals(str,"-12,340.60");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(ratio, 2), FORMAT_CURRENCY(dec, 2) from R3 where id = 7");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"1.51");
  str=result.getString(1);
  assertEquals(str,"12,400.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(ratio, 2), FORMAT_CURRENCY(dec, 2) from R3 where id = 8");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"-1.51");
  str=result.getString(1);
  assertEquals(str,"-12,400.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(ratio, 2),FORMAT_CURRENCY(dec, 2) from R3 where id = 9");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  str=result.getString(1);
  assertEquals(str,"12,400.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(ratio, 2),FORMAT_CURRENCY(dec, 2) from R3 where id = 10");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  str=result.getString(1);
  assertEquals(str,"-12,400.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(ratio, 2),FORMAT_CURRENCY(dec, 2) from R3 where id = 11");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"1.50");
  str=result.getString(1);
  assertEquals(str,"12,399.98");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(ratio, 2),FORMAT_CURRENCY(dec, 2) from R3 where id = 12");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"-1.50");
  str=result.getString(1);
  assertEquals(str,"-12,399.98");
  try {
    cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY('abc', 2) from R3 where id = 4");
    fail("type validity check failed for FORMAT_CURRENCY");
  }
 catch (  ProcCallException pcex) {
    assertTrue(pcex.getMessage().contains("incompatible data type in operation"));
  }
  String[] s={"1,000,000.00","100,000.00","10,000.00","1,000.00","100.00","10.00","1.00","0.10","0.01","0.00"};
  for (int i=0; i < 10; i++) {
    cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(" + Math.pow(10,6 - i) + ", 2) from R3 where id = 1");
    assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
    result=cr.getResults()[0];
    assertEquals(1,result.getRowCount());
    assertTrue(result.advanceRow());
    str=result.getString(0);
    assertEquals(str,s[i]);
  }
  for (int i=0; i < 10; i++) {
    cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(" + -Math.pow(10,6 - i) + ", 2) from R3 where id = 1");
    assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
    result=cr.getResults()[0];
    assertEquals(1,result.getRowCount());
    assertTrue(result.advanceRow());
    str=result.getString(0);
    assertEquals(str,"-" + s[i]);
  }
  String[] s2={"1,111,111.11111","1,111,111.1111","1,111,111.111","1,111,111.11","1,111,111.1","1,111,111","1,111,110","1,111,100","1,111,000","1,110,000","1,100,000","1,000,000","0"};
  for (int i=5; i > -8; i--) {
    cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(1111111.11111, " + i + ") from R3 where id = 1");
    assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
    result=cr.getResults()[0];
    assertEquals(1,result.getRowCount());
    assertTrue(result.advanceRow());
    str=result.getString(0);
    assertEquals(str,s2[5 - i]);
  }
  try {
    cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(2, 15) from R3 where id = 4");
    fail("type validity check failed for FORMAT_CURRENCY");
  }
 catch (  ProcCallException pcex) {
    assertTrue(pcex.getMessage().contains("the second parameter"));
  }
  try {
    cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(2, -26) from R3 where id = 4");
    fail("type validity check failed for FORMAT_CURRENCY");
  }
 catch (  ProcCallException pcex) {
    assertTrue(pcex.getMessage().contains("the second parameter"));
  }
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(0, 2) from R3 where id = 4");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"0.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(0.0, 2) from R3 where id = 4");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"0.00");
  cr=client.callProcedure("@AdHoc","select FORMAT_CURRENCY(-0.0, 2) from R3 where id = 4");
  assertEquals(cr.getStatus(),ClientResponse.SUCCESS);
  result=cr.getResults()[0];
  assertEquals(1,result.getRowCount());
  assertTrue(result.advanceRow());
  str=result.getString(0);
  assertEquals(str,"0.00");
}
