{
  StringBuilder result=new StringBuilder(2048);
  ChannelExec channel;
  try {
    channel=(ChannelExec)m_session.openChannel("exec");
  }
 catch (  JSchException jsex) {
    throw new SFTPException("create an EXEC channel",jsex);
  }
  try {
    channel.setCommand(command);
    InputStream err=channel.getErrStream();
    InputStreamReader errStrRdr=new InputStreamReader(err,"UTF-8");
    Reader errStrBufRdr=new BufferedReader(errStrRdr);
    InputStream out=channel.getInputStream();
    InputStreamReader outStrRdr=new InputStreamReader(out,"UTF-8");
    Reader outStrBufRdr=new BufferedReader(outStrRdr);
    StringBuffer stdout=new StringBuffer();
    StringBuffer stderr=new StringBuffer();
    channel.connect(5000);
    while (true) {
      if (channel.isClosed()) {
        break;
      }
      int ch;
      while (outStrBufRdr.ready() && (ch=outStrBufRdr.read()) > -1) {
        stdout.append((char)ch);
      }
      while (errStrBufRdr.ready() && (ch=errStrBufRdr.read()) > -1) {
        stderr.append((char)ch);
      }
      try {
        Thread.sleep(100);
      }
 catch (      InterruptedException ie) {
      }
    }
    int ch;
    while ((ch=outStrBufRdr.read()) > -1) {
      stdout.append((char)ch);
    }
    while ((ch=errStrBufRdr.read()) > -1) {
      stderr.append((char)ch);
    }
    result.append(stdout.toString());
    result.append(stderr.toString());
    channel.disconnect();
  }
 catch (  Throwable e) {
    e.printStackTrace();
  }
  return result.toString();
}
