{
  if ((sqlIn == null) || (sqlIn.length() == 0)) {
    throw new RuntimeException("Can't plan empty or null SQL.");
  }
  String sql=sqlIn.trim();
  hostLog.debug("received sql stmt: " + sql);
  AbstractPlanNode.resetPlanNodeIds();
  TrivialCostModel costModel=new TrivialCostModel();
  PartitioningForStatement partitioning=new PartitioningForStatement(partitionParam,inferSP,inferSP);
  QueryPlanner planner=new QueryPlanner(m_cluster,m_database,partitioning,m_hsql,new DatabaseEstimates(),true);
  CompiledPlan plan=null;
  try {
    plan=planner.compilePlan(costModel,sql,null,"PlannerTool","PlannerToolProc",AD_HOC_JOINED_TABLE_LIMIT,null);
  }
 catch (  Exception e) {
    throw new RuntimeException("Error compiling query: " + e.getMessage(),e);
  }
  if (plan == null) {
    String plannerMsg=planner.getErrorMessage();
    if (plannerMsg != null) {
      throw new RuntimeException("ERROR: " + plannerMsg + "\n");
    }
 else {
      throw new RuntimeException("ERROR: UNKNOWN PLANNING ERROR\n");
    }
  }
  if (!allowParameterization && plan.parameters.length > 0) {
    throw new RuntimeException("ERROR: PARAMETERIZATION IN AD HOC QUERY");
  }
  if (plan.isContentDeterministic() == false) {
    String potentialErrMsg="Statement has a non-deterministic result - statement: \"" + sql + "\" , reason: "+ plan.nondeterminismDetail();
    hostLog.warn(potentialErrMsg);
  }
  return new AdHocPlannedStatement(plan);
}
