{
  StringBuilder line=new StringBuilder();
  InputStreamReader isr=new InputStreamReader(p.getInputStream());
  long timeout=100;
  if ((timeout * 2) > timeoutInMillis)   timeout=timeoutInMillis / 2;
  long start=System.nanoTime();
  long now=start;
  char c=' ';
  while (c != '\n') {
    if (p.getInputStream().available() > 0) {
      c=(char)isr.read();
      if (c == '\n')       break;
 else       line.append(c);
    }
 else {
      now=System.nanoTime();
      System.out.printf("Blocked for %d ms\n",(now - start) / 1000000);
      if ((now - start) > (timeoutInMillis * 1000000))       throw new InterruptedException("Timeout while reading output from process");
      Thread.sleep(timeout);
    }
  }
  return line.toString();
}
