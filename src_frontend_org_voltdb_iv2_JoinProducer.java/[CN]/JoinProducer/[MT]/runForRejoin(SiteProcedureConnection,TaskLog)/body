{
  if (!m_receivedFirstFragment) {
  }
 else   if (!m_firstFragResponseSent) {
    sendFirstFragResponse();
  }
 else   if (m_completionMonitorAwait.isDone()) {
    JOINLOG.info("P" + m_partitionId + " run for rejoin is complete");
    SnapshotCompletionInterest.SnapshotCompletionEvent event=null;
    try {
      event=m_completionMonitorAwait.get();
      assert(event != null);
    }
 catch (    InterruptedException e) {
      VoltDB.crashLocalVoltDB("Impossible interruption happend",true,e);
    }
catch (    ExecutionException e) {
      VoltDB.crashLocalVoltDB("Error waiting for snapshot to finish",true,e);
    }
    RejoinMessage rm=new RejoinMessage(m_mailbox.getHSId(),RejoinMessage.Type.SNAPSHOT_FINISHED);
    m_mailbox.send(m_coordinatorHsId,rm);
    setJoinComplete(siteConnection,event.exportSequenceNumbers);
    return;
  }
 else {
    Pair<Integer,ByteBuffer> dataPair=m_snapshotData.poll();
    if (dataPair != null) {
      JOINLOG.info("P" + m_partitionId + " restoring table "+ dataPair.getFirst()+ " block of ("+ dataPair.getSecond().position()+ ","+ dataPair.getSecond().limit()+ ")");
      restoreBlock(dataPair,siteConnection);
    }
  }
  m_taskQueue.offer(this);
}
