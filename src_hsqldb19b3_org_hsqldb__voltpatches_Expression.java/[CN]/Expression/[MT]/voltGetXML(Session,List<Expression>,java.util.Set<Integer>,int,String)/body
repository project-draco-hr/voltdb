{
  int exprOp=getType();
  if (exprOp == OpTypes.SIMPLE_COLUMN) {
    for (int ii=startKey + 1; ii < displayCols.size(); ++ii) {
      Expression otherCol=displayCols.get(ii);
      if (otherCol != null && (otherCol.opType != OpTypes.SIMPLE_COLUMN) && (otherCol.columnIndex == this.columnIndex)) {
        ignoredDisplayColIndexes.add(ii);
        return otherCol.voltGetXML(session,displayCols,ignoredDisplayColIndexes,startKey,getAlias());
      }
    }
    assert(false);
  }
  VoltXMLElement exp=prototypes.get(exprOp);
  if (exp == null) {
    throwForUnsupportedExpression(exprOp);
  }
  exp=exp.duplicate();
  exp.attributes.put("id",this.getUniqueId(session));
  if (realAlias != null) {
    exp.attributes.put("alias",realAlias);
  }
 else   if ((alias != null) && (getAlias().length() > 0)) {
    exp.attributes.put("alias",getAlias());
  }
  for (  Expression expr : nodes) {
    if (expr != null) {
      VoltXMLElement vxmle=expr.voltGetXML(session,displayCols,ignoredDisplayColIndexes,startKey);
      exp.children.add(vxmle);
      assert(vxmle != null);
    }
  }
switch (exprOp) {
case OpTypes.VALUE:
    if (valueData == null) {
      if (dataType == null) {
        exp.attributes.put("valuetype","NULL");
        return exp;
      }
      exp.attributes.put("valuetype",Types.getTypeName(dataType.typeCode));
      return exp;
    }
  if (dataType.isBooleanType()) {
    throw new HSQLParseException("VoltDB does not support WHERE clauses containing only constants");
  }
exp.attributes.put("valuetype",Types.getTypeName(dataType.typeCode));
if (valueData instanceof TimestampData) {
TimestampData time=(TimestampData)valueData;
exp.attributes.put("value",Long.toString(Math.round((time.getSeconds() + time.getZone()) * 1e6) + time.getNanos() / 1000));
return exp;
}
if (valueData instanceof BinaryData) {
BinaryData bd=(BinaryData)valueData;
exp.attributes.put("value",hexEncode(bd.getBytes()));
return exp;
}
exp.attributes.put("value",valueData.toString());
return exp;
case OpTypes.COLUMN:
case OpTypes.COALESCE:
ExpressionColumn ec=(ExpressionColumn)this;
return ec.voltAnnotateColumnXML(exp);
case OpTypes.SQL_FUNCTION:
FunctionSQL fn=(FunctionSQL)this;
return fn.voltAnnotateFunctionXML(exp);
case OpTypes.COUNT:
case OpTypes.SUM:
case OpTypes.AVG:
if (((ExpressionAggregate)this).isDistinctAggregate) {
exp.attributes.put("distinct","true");
}
return exp;
case OpTypes.ORDER_BY:
if (((ExpressionOrderBy)this).isDescending()) {
exp.attributes.put("desc","true");
}
return exp;
case OpTypes.CAST:
if (dataType == null) {
throw new HSQLParseException("VoltDB could not determine the type in a CAST operation");
}
exp.attributes.put("valuetype",dataType.getNameString());
return exp;
case OpTypes.ALTERNATIVE:
assert(nodes.length == 2);
if (nodes[RIGHT] instanceof ExpressionValue) {
ExpressionValue val=(ExpressionValue)nodes[RIGHT];
if (val.valueData == null && val.dataType == Type.SQL_ALL_TYPES) {
exp.children.get(RIGHT).attributes.put("valuetype",dataType.getNameString());
}
}
case OpTypes.CASEWHEN:
assert(dataType != null);
exp.attributes.put("valuetype",dataType.getNameString());
return exp;
default :
return exp;
}
}
