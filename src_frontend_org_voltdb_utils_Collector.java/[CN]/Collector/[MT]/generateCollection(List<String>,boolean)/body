{
  try {
    String timestamp="";
    String rootpath="";
    if (calledFromVEM) {
      rootpath=m_voltDbRootPath;
    }
 else {
      TimestampType ts=new TimestampType(new java.util.Date());
      timestamp=ts.toString().replace(' ','-');
      timestamp=timestamp.substring(0,"YYYY-mm-DD-HH:MM:ss".length());
      rootpath=System.getProperty("user.dir");
    }
    String collectionFilePath=rootpath + File.separator + m_uniqueid+ timestamp+ ".tgz";
    File collectionFile=new File(collectionFilePath);
    TarGenerator tarGenerator=new TarGenerator(collectionFile,true,null);
    for (    String path : paths) {
      if (Arrays.asList(cmdFilenames).contains(path.split(" ")[0])) {
        continue;
      }
      File file=new File(path);
      String filename=file.getName();
      String entryPath=file.getName();
      for (      String logPath : m_logPaths) {
        if (filename.startsWith(new File(logPath).getName())) {
          entryPath="log" + File.separator + file.getName();
          break;
        }
      }
      if (filename.startsWith("voltdb_crash")) {
        entryPath="voltdb_crash" + File.separator + file.getName();
      }
      if (filename.startsWith("syslog") || filename.equals("dmesg")) {
        entryPath="syslog" + File.separator + file.getName();
      }
      if (file.length() > 0) {
        tarGenerator.queueEntry(entryPath,file);
      }
    }
    String[] sarCmd={"bash","-c","sar -A"};
    cmd(tarGenerator,sarCmd,"sardata");
    String[] dmesgCmd={"bash","-c","/bin/dmesg"};
    cmd(tarGenerator,dmesgCmd,"dmesgdata");
    tarGenerator.write(false,true);
    long sizeInByte=collectionFile.length();
    String sizeStringInKB=String.format("%5.2f",(double)sizeInByte / 1000);
    System.out.println("Collection file created at " + collectionFilePath + " size: "+ sizeStringInKB+ " KB");
    boolean upload=false;
    if (!m_host.isEmpty()) {
      if (m_noPrompt) {
        upload=true;
      }
 else {
        upload=getUserResponse("Upload via SFTP");
      }
    }
    if (upload) {
      if (org.voltdb.utils.MiscUtils.isPro()) {
        if (m_username.isEmpty()) {
          System.out.print("username: ");
          m_username=System.console().readLine();
        }
        if (m_password.isEmpty()) {
          System.out.print("password: ");
          m_password=new String(System.console().readPassword());
        }
        try {
          uploadToServer(collectionFilePath,m_host,m_username,m_password);
          System.out.println("Uploaded " + new File(collectionFilePath).getName() + " via SFTP");
          boolean delLocalCopy=false;
          if (m_noPrompt) {
            delLocalCopy=true;
          }
 else {
            delLocalCopy=getUserResponse("Delete local copy " + collectionFilePath);
          }
          if (delLocalCopy) {
            try {
              collectionFile.delete();
              System.out.println("Local copy " + collectionFilePath + " deleted");
            }
 catch (            SecurityException e) {
              System.out.println("Failed to delete local copy " + collectionFilePath + ". "+ e.getMessage());
            }
          }
        }
 catch (        Exception e) {
          System.err.println(e.getMessage());
        }
      }
 else {
        System.out.println("Uploading is only available in the Enterprise Edition");
      }
    }
  }
 catch (  Exception e) {
    System.err.println(e.getMessage());
  }
}
