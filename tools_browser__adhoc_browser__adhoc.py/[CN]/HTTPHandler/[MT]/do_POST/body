def do_POST(self):
    global client
    try:
        (ctype, pdict) = cgi.parse_header(self.headers.getheader('content-type'))
        if (ctype == 'multipart/form-data'):
            query = cgi.parse_multipart(self.rfile, pdict)
        sql_text = query.get('sql')[0]
        button_clicked = query.get('bsubmit')[0].upper()
        snapshot_path = query.get('snapshot_path')[0].strip()
        snapshot_nonce = query.get('snapshot_nonce')[0].strip()
        if query.has_key('blocking_snapshot'):
            blocking_snapshot = True
        else:
            blocking_snapshot = False
        if query.has_key('interval_poll'):
            interval_poll = 1
        else:
            interval_poll = 0
        self.send_response(200)
        self.send_header('Content-type', 'text/html')
        self.end_headers()
        self.wfile.write('<html>\n')
        self.wfile.write('<head>\n')
        self.wfile.write('<style type="text/css">\n')
        self.wfile.write('p {color: white; }\n')
        self.wfile.write('body {font-family: Arial, Helvetica, sans-serif;}\n')
        self.wfile.write('table {border-collapse: collapse; border: 1px solid black;}\n')
        self.wfile.write('th {text-align: center; font-weight: bold; color: white; border: 1px solid black; background: black;}\n')
        self.wfile.write('tr#whiterow {border: 1px solid black;}\n')
        self.wfile.write('tr#grayrow  {border: 1px solid black; background: #CCC;}\n')
        self.wfile.write('td#leftalign  {text-align: left;}\n')
        self.wfile.write('td#rightalign {text-align: right;}\n')
        self.wfile.write('</style>\n')
        self.wfile.write('</head>\n')
        self.wfile.write('<body>\n')
        try:
            if (client == None):
                connect_to_server()
            if (button_clicked == 'SUBMIT SQL'):
                self.wfile.write('SQL<br>\n')
                self.wfile.write((sql_text + '<br>\n<br>\n'))
                self.wfile.write('RESULTS<br>\n')
                response = client.execute(('adhoc %s' % sql_text))
            elif (button_clicked == 'TABLES'):
                self.wfile.write('Table Statistics<br>\n')
                response = client.execute(('stat table %d' % interval_poll))
            elif (button_clicked == 'INDEXES'):
                self.wfile.write('Index Statistics<br>\n')
                response = client.execute(('stat index %d' % interval_poll))
            elif (button_clicked == 'PROCEDURES'):
                self.wfile.write('Procedure Statistics<br>\n')
                response = client.execute(('stat procedure %d' % interval_poll))
            elif (button_clicked == 'INITIATORS'):
                self.wfile.write('Initiator Statistics<br>\n')
                response = client.execute(('stat initiator %d' % interval_poll))
            elif (button_clicked == 'NODE MEMORY'):
                self.wfile.write('Node Memory Statistics<br>\n')
                response = client.execute(('stat memory %d' % interval_poll))
            elif (button_clicked == 'IO'):
                self.wfile.write('IO Statistics<br>\n')
                response = client.execute(('stat iostats %d' % interval_poll))
            elif (button_clicked == 'STARVATION'):
                self.wfile.write('Starvation Statistics<br>\n')
                response = client.execute(('stat starvation %d' % interval_poll))
            elif (button_clicked == 'MANAGEMENT'):
                self.wfile.write('Management statistics<br>\n')
                response = client.execute(('stat management %d' % interval_poll))
            elif (button_clicked == 'SYSTEMINFO'):
                self.wfile.write('System Information<br>\n')
                response = client.execute(('sysinfo %d' % interval_poll))
            elif (button_clicked == 'INITIATE SNAPSHOT'):
                self.wfile.write('Attempting to initiate snapshot to ')
                self.wfile.write(snapshot_path)
                self.wfile.write(' with nonce ')
                self.wfile.write(snapshot_nonce)
                if blocking_snapshot:
                    response = client.execute(('snapshotsave %s %s %d' % (snapshot_path, snapshot_nonce, 1)))
                else:
                    response = client.execute(('snapshotsave %s %s %d' % (snapshot_path, snapshot_nonce, 0)))
            elif (button_clicked == 'RESTORE SNAPSHOT'):
                self.wfile.write('Attempting to restore snapshot from ')
                self.wfile.write(snapshot_path)
                self.wfile.write(' with nonce ')
                self.wfile.write(snapshot_nonce)
                if blocking_snapshot:
                    response = client.execute(('snapshotrestore %s %s %d' % (snapshot_path, snapshot_nonce, 1)))
                else:
                    response = client.execute(('snapshotrestore %s %s %d' % (snapshot_path, snapshot_nonce, 0)))
            elif (button_clicked == 'SNAPSHOT STATUS'):
                self.wfile.write('Retrieving snapshot status')
                response = client.execute('snapshotstatus')
            elif (button_clicked == 'SCAN SNAPSHOTS'):
                self.wfile.write('Scanning for snapshots in ')
                self.wfile.write(snapshot_path)
                response = client.execute(('snapshotscan %s' % snapshot_path))
            elif (button_clicked == 'DELETE SNAPSHOT'):
                self.wfile.write('Attempting to delete snapshot in ')
                self.wfile.write(snapshot_path)
                self.wfile.write(' with nonce ')
                self.wfile.write(snapshot_nonce)
                response = client.execute(('snapshotdelete %s %s' % (snapshot_path, snapshot_nonce)))
            else:
                print 'Illegal call attempted by page.'
                exit((-1))
            for i in range(len(response.tables)):
                self.wfile.write('<table border="1">\n')
                self.wfile.write('  <tr>\n')
                colTypes = list()
                for thisColumn in response.tables[i].columns:
                    colTypes.append(thisColumn.type)
                    self.wfile.write((('    <th>' + str(thisColumn.name).strip()) + '</th>\n'))
                self.wfile.write('  </tr>\n')
                grayBar = 0
                rowsDisplayed = 0
                for thisTuple in response.tables[i].tuples:
                    if (grayBar == 0):
                        self.wfile.write('  <tr id="whiterow">\n')
                        grayBar = 1
                    else:
                        self.wfile.write('  <tr id="grayrow">\n')
                        grayBar = 0
                    rowsDisplayed = (rowsDisplayed + 1)
                    colCounter = 0
                    for thisValue in thisTuple:
                        if (thisValue == None):
                            val = 'NULL'
                        else:
                            val = thisValue
                        if (colTypes[colCounter] == 9):
                            self.wfile.write((('    <td id="leftalign">' + str(val).strip()) + '</td>\n'))
                        else:
                            self.wfile.write((('    <td id="rightalign">' + str(val).strip()) + '</td>\n'))
                        colCounter += 1
                    self.wfile.write('  </tr>\n')
                self.wfile.write('</table>\n')
                self.wfile.write((('<br />' + str(rowsDisplayed)) + ' Row(s) Displayed.\n'))
            if (response.status != 1):
                self.wfile.write(cgi.escape(str(response)).replace('\n', '<br />\n'))
        except IOError as e:
            print e
            self.wfile.write(('Error: %s<br>\n' % e))
            client = None
        except Exception as e:
            print 'something really bad just happened'
            print e
            self.wfile.write('sql failure<br>\n')
            self.wfile.write(e)
        self.wfile.write("<br>\n<br>\n<a href='index.html>Click here to enter another SQL statement.</a>\n")
        self.wfile.write('</body>\n')
        self.wfile.write('</html>\n')
    except:
        pass
