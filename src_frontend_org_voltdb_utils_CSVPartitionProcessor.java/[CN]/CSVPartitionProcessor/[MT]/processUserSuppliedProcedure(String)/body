{
  while (true) {
    if (m_errored) {
      CSVFileReader.m_errored=true;
      return;
    }
    List<CSVLineWithMetaData> mlineList=new ArrayList<CSVLineWithMetaData>();
    mlineList.add(m_partitionQueue.take());
    m_partitionQueue.drainTo(mlineList,m_config.batch);
    for (    CSVLineWithMetaData lineList : mlineList) {
      if (lineList == m_endOfData) {
        return;
      }
      try {
        PartitionSingleExecuteProcedureCallback cbmt=new PartitionSingleExecuteProcedureCallback(lineList,this);
        if (m_csvClient.callProcedure(cbmt,procName,(Object[])lineList.correctedLine)) {
          m_partitionProcessedCount.incrementAndGet();
        }
 else {
          m_log.fatal("Failed to send CSV insert to VoltDB cluster.");
          System.exit(1);
        }
      }
 catch (      IOException ex) {
        String[] info={lineList.rawLine.toString(),ex.toString()};
        m_errored=synchronizeErrorInfo(lineList.lineNumber,info);
        return;
      }
    }
  }
}
