{
  VoltTable table=new VoltTable(colInfo);
  String procName=(isMP ? "@LoadMultipartitionTable" : (isLoadTable ? "@LoadPartitionData" : "@LoadSinglepartitionTable"));
  if (config.ping) {
    procName="@Ping";
  }
 else   if (config.legacy) {
    procName=insertProcedure;
    table=null;
  }
  System.out.println("Using Procedure: " + procName);
  while (true) {
    CSVLineWithMetaData lineList=null;
    try {
      lineList=lineq.take();
    }
 catch (    InterruptedException ex) {
      Logger.getLogger(CSVLoaderMT.class.getName()).log(Level.SEVERE,null,ex);
    }
    if (lineList == dummy) {
      if (config.legacy) {
        System.out.println("Done Processing partition: " + partitionId + " Processed: "+ partitionProcessedCount);
        break;
      }
      if (table.getRowCount() > 0) {
        CSVLoaderMT.MyMTCallback cbmt=new CSVLoaderMT.MyMTCallback(table.getRowCount(),lineList.line);
        try {
          if (!isMP) {
            Object param1;
            if (isLoadTable) {
              param1=partitionId;
            }
 else {
              param1=TheHashinator.valueToBytes(partitionId);
            }
            csvClient.callProcedure(cbmt,procName,param1,tableName,table);
          }
 else {
            csvClient.callProcedure(cbmt,procName,tableName,table);
          }
          CSVFileReader.inCount.addAndGet(table.getRowCount());
          partitionProcessedCount+=table.getRowCount();
        }
 catch (        IOException ex) {
          Logger.getLogger(CSVPartitionProcessor.class.getName()).log(Level.SEVERE,null,ex);
        }
      }
      System.out.println("Done Processing partition: " + partitionId + " Processed: "+ partitionProcessedCount);
      break;
    }
    if (lineList == null) {
      continue;
    }
    if (!config.legacy) {
      VoltTableUtil.toVoltTableFromLine(table,lineList.line,colNames,columnTypes);
      if (table.getRowCount() > config.batch) {
        try {
          CSVLoaderMT.MyMTCallback cbmt=new CSVLoaderMT.MyMTCallback(table.getRowCount(),lineList.line);
          if (!isMP) {
            Object param1;
            if (isLoadTable) {
              param1=partitionId;
            }
 else {
              param1=TheHashinator.valueToBytes(partitionId);
            }
            csvClient.callProcedure(cbmt,procName,param1,tableName,table);
          }
 else {
            csvClient.callProcedure(cbmt,procName,tableName,table);
          }
          CSVFileReader.inCount.addAndGet(table.getRowCount());
          partitionProcessedCount+=table.getRowCount();
          table.clearRowData();
        }
 catch (        IOException ex) {
          Logger.getLogger(CSVPartitionProcessor.class.getName()).log(Level.SEVERE,null,ex);
        }
      }
    }
 else {
      try {
        CSVLoaderMT.MyCallback cbmt=new CSVLoaderMT.MyCallback(0,config,lineList.line);
        csvClient.callProcedure(cbmt,procName,(Object[])lineList.line);
        CSVFileReader.inCount.incrementAndGet();
      }
 catch (      IOException ex) {
        Logger.getLogger(CSVPartitionProcessor.class.getName()).log(Level.SEVERE,null,ex);
      }
    }
  }
}
