{
  FailedBatchProcessor failureProcessor=null;
  if (m_config.useSuppliedProcedure) {
    processUserSuppliedProcedure(m_insertProcedure);
  }
 else {
    Object partitionParam=null;
    if (!m_isMP) {
      partitionParam=TheHashinator.valueToBytes(m_partitionId);
    }
    VoltTable table=new VoltTable(m_colInfo);
    String procName=(m_isMP ? "@LoadMultipartitionTable" : "@LoadSinglepartitionTable");
    failedQueue=new LinkedBlockingQueue<CSVLineWithMetaData>();
    failureProcessor=new FailedBatchProcessor(this,procName,m_tableName,partitionParam);
    failureProcessor.start();
    processLoadTable(table,procName,partitionParam);
  }
  m_partitionQueue.clear();
  try {
    m_csvClient.drain();
    if (failureProcessor != null) {
      failedQueue.put(m_endOfData);
      failureProcessor.join();
      m_csvClient.drain();
    }
  }
 catch (  NoConnectionsException ex) {
    m_log.warn("Failed to Drain the client: ",ex);
  }
catch (  InterruptedException ex) {
    m_log.warn("Failed to Drain the client: ",ex);
  }
  CSVPartitionProcessor.m_processor_cdl.countDown();
  m_log.info("Done Processing partition: " + m_partitionId + " Processed: "+ m_partitionProcessedCount);
}
