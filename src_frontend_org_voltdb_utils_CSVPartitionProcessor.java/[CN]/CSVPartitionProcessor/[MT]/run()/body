{
  FailedBatchProcessor failureProcessor=null;
  if (config.useSuppliedProcedure) {
    processUserSuppliedProcedure(insertProcedure);
  }
 else {
    Object partitionParam=null;
    if (!isMP) {
      partitionParam=TheHashinator.valueToBytes(m_partitionId);
    }
    VoltTable table=new VoltTable(colInfo);
    String procName=(isMP ? "@LoadMultipartitionTable" : "@LoadSinglepartitionTable");
    failedQueue=new LinkedBlockingQueue<CSVLineWithMetaData>();
    failureProcessor=new FailedBatchProcessor(this,procName,tableName,partitionParam);
    failureProcessor.start();
    processLoadTable(table,procName,partitionParam);
  }
  try {
    csvClient.drain();
    if (failureProcessor != null) {
      failedQueue.put(endOfData);
      failureProcessor.join();
      csvClient.drain();
    }
  }
 catch (  NoConnectionsException ex) {
    m_log.warn("Failed to Drain the client: ",ex);
  }
catch (  InterruptedException ex) {
    m_log.warn("Failed to Drain the client: ",ex);
  }
  CSVPartitionProcessor.processor_cdl.countDown();
  m_log.info("Done Processing partition: " + m_partitionId + " Processed: "+ m_partitionProcessedCount);
}
