{
  SnapshotDaemon daemon=getBasicDaemon();
  Pair<String,Object[]> work=daemon.processPeriodicWork(0);
  work=daemon.processClientResponse(getSuccessfulScanOneResult());
  assertNull(work);
  daemon=getBasicDaemon();
  daemon.processPeriodicWork(0);
  work=daemon.processClientResponse(getSuccessfulScanThreeResults());
  assertNotNull(work);
  assertTrue("@SnapshotDelete".equals(work.getFirst()));
  String path=((String[])work.getSecond()[0])[0];
  String nonce=((String[])work.getSecond()[1])[0];
  assertTrue("/tmp".equals(path));
  assertTrue("woobie_2".equals(nonce));
  assertNull(daemon.processPeriodicWork(3));
  assertNull(daemon.processClientResponse(getFailureResponse()));
  assertEquals(daemon.getState(),SnapshotDaemon.State.FAILURE);
  daemon=getBasicDaemon();
  daemon.processPeriodicWork(0);
  work=daemon.processClientResponse(getSuccessfulScanThreeResults());
  daemon.processClientResponse(getErrMsgResponse());
  assertEquals(daemon.getState(),SnapshotDaemon.State.WAITING);
}
