{
  ImmutableSetMultimap.Builder<State,Service> builder=ImmutableSetMultimap.builder();
  monitor.enter();
  try {
    for (    Entry<State,Service> entry : servicesByState.entries()) {
      if (!(entry.getValue() instanceof NoOpService)) {
        builder.put(entry.getKey(),entry.getValue());
      }
    }
  }
  finally {
    monitor.leave();
  }
  return builder.build();
}
