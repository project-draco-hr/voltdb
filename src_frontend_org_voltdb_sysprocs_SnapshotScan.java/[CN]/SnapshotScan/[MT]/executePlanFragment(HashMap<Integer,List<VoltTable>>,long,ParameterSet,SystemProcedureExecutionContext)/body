{
  errorString=null;
  String hostname=ConnectionUtil.getHostnameOrAddress();
  if (fragmentId == SysProcFragmentId.PF_snapshotScan) {
    final VoltTable results=constructFragmentResultsTable();
    int host_id=context.getExecutionSite().getCorrespondingHostId();
    Long lowest_site_id=VoltDB.instance().getSiteTracker().getLowestSiteForHost(host_id);
    if (context.getExecutionSite().getSiteId() == lowest_site_id) {
      assert(params.toArray()[0] != null);
      assert(params.toArray()[0] instanceof String);
      final String path=(String)params.toArray()[0];
      List<File> relevantFiles=retrieveRelevantFiles(path);
      if (relevantFiles == null) {
        results.addRow(context.getHostId(),hostname,"","",0,0,"","FALSE",0,"","",0,"","FAILURE",errorString);
      }
 else {
        for (        final File f : relevantFiles) {
          if (f.getName().endsWith(".digest")) {
            continue;
          }
          if (f.canRead()) {
            try {
              FileInputStream savefile_input=new FileInputStream(f);
              try {
                TableSaveFile savefile=new TableSaveFile(savefile_input.getChannel(),1,null);
                String partitions="";
                for (                int partition : savefile.getPartitionIds()) {
                  partitions=partitions + "," + partition;
                }
                if (partitions.startsWith(",")) {
                  partitions=partitions.substring(1);
                }
                results.addRow(context.getHostId(),hostname,f.getParent(),f.getName(),savefile.getTxnId(),org.voltdb.TransactionIdManager.getTimestampFromTransactionId(savefile.getTxnId()),savefile.getTableName(),savefile.getCompleted() ? "TRUE" : "FALSE",f.length(),savefile.isReplicated() ? "TRUE" : "FALSE",partitions,savefile.getTotalPartitions(),f.canRead() ? "TRUE" : "FALSE","SUCCESS","");
              }
 catch (              IOException e) {
                HOST_LOG.warn(e);
              }
 finally {
                savefile_input.close();
              }
            }
 catch (            IOException e) {
              HOST_LOG.warn(e);
            }
          }
 else {
            results.addRow(context.getHostId(),hostname,f.getParent(),f.getName(),0L,f.lastModified(),"","FALSE",f.length(),"FALSE","",-1,f.canRead() ? "TRUE" : "FALSE","SUCCESS","");
          }
        }
      }
    }
    return new DependencyPair(DEP_snapshotScan,results);
  }
 else   if (fragmentId == SysProcFragmentId.PF_snapshotScanResults) {
    final VoltTable results=constructFragmentResultsTable();
    TRACE_LOG.trace("Aggregating Snapshot Scan  results");
    assert(dependencies.size() > 0);
    List<VoltTable> dep=dependencies.get(DEP_snapshotScan);
    for (    VoltTable table : dep) {
      while (table.advanceRow()) {
        results.add(table);
      }
    }
    return new DependencyPair(DEP_snapshotScanResults,results);
  }
 else   if (fragmentId == SysProcFragmentId.PF_snapshotDigestScan) {
    final VoltTable results=constructDigestResultsTable();
    int host_id=context.getExecutionSite().getCorrespondingHostId();
    Long lowest_site_id=VoltDB.instance().getSiteTracker().getLowestSiteForHost(host_id);
    if (context.getExecutionSite().getSiteId() == lowest_site_id) {
      assert(params.toArray()[0] != null);
      assert(params.toArray()[0] instanceof String);
      final String path=(String)params.toArray()[0];
      List<File> relevantFiles=retrieveRelevantFiles(path);
      if (relevantFiles == null) {
        results.addRow(context.getHostId(),"","","","FAILURE",errorString);
      }
 else {
        for (        final File f : relevantFiles) {
          if (f.getName().endsWith(".vpt")) {
            continue;
          }
          if (f.canRead()) {
            try {
              HashSet<String> tableNames=new HashSet<String>();
              JSONArray tables=SnapshotUtil.CRCCheck(f).getJSONArray("tables");
              for (int ii=0; ii < tables.length(); ii++) {
                tableNames.add(tables.getString(ii));
              }
              final StringWriter sw=new StringWriter();
              int ii=0;
              for (              String name : tableNames) {
                sw.append(name);
                if (ii != tableNames.size() - 1) {
                  sw.append(',');
                }
                ii++;
              }
              results.addRow(context.getHostId(),path,f.getName(),sw.toString(),"SUCCESS","");
            }
 catch (            Exception e) {
              HOST_LOG.warn(e);
            }
          }
        }
      }
    }
    return new DependencyPair(DEP_snapshotDigestScan,results);
  }
 else   if (fragmentId == SysProcFragmentId.PF_snapshotDigestScanResults) {
    final VoltTable results=constructDigestResultsTable();
    TRACE_LOG.trace("Aggregating Snapshot Digest Scan  results");
    assert(dependencies.size() > 0);
    List<VoltTable> dep=dependencies.get(DEP_snapshotDigestScan);
    for (    VoltTable table : dep) {
      while (table.advanceRow()) {
        results.add(table);
      }
    }
    return new DependencyPair(DEP_snapshotDigestScanResults,results);
  }
 else   if (fragmentId == SysProcFragmentId.PF_hostDiskFreeScan) {
    final VoltTable results=constructDiskFreeResultsTable();
    int host_id=context.getExecutionSite().getCorrespondingHostId();
    Long lowest_site_id=VoltDB.instance().getSiteTracker().getLowestSiteForHost(host_id);
    if (context.getExecutionSite().getSiteId() == lowest_site_id) {
      assert(params.toArray()[0] != null);
      assert(params.toArray()[0] instanceof String);
      final String path=(String)params.toArray()[0];
      File dir=new VoltFile(path);
      if (dir.isDirectory()) {
        final long free=dir.getUsableSpace();
        final long total=dir.getTotalSpace();
        final long used=total - free;
        results.addRow(context.getHostId(),hostname,path,total,free,used,"SUCCESS","");
      }
 else {
        results.addRow(context.getHostId(),hostname,path,0,0,0,"FAILURE","Path is not a directory");
      }
    }
    return new DependencyPair(DEP_hostDiskFreeScan,results);
  }
 else   if (fragmentId == SysProcFragmentId.PF_hostDiskFreeScanResults) {
    final VoltTable results=constructDiskFreeResultsTable();
    TRACE_LOG.trace("Aggregating disk free results");
    assert(dependencies.size() > 0);
    List<VoltTable> dep=dependencies.get(DEP_hostDiskFreeScan);
    for (    VoltTable table : dep) {
      while (table.advanceRow()) {
        results.add(table);
      }
    }
    return new DependencyPair(DEP_hostDiskFreeScanResults,results);
  }
  assert(false);
  return null;
}
