{
  m_file=file;
  m_tempFile=new File(m_file.getParentFile(),m_file.getName() + ".incomplete");
  RandomAccessFile ras=new RandomAccessFile(m_tempFile,"rw");
  m_fc=ras.getChannel();
  m_needsFinalClose=needsFinalClose;
  m_es=CoreUtils.getSingleThreadExecutor("Snapshot write thread for " + m_file);
  ScheduledFuture<?> syncTask=null;
  syncTask=DefaultSnapshotDataTarget.m_syncService.scheduleAtFixedRate(new Runnable(){
    @Override public void run(){
      while (m_bytesSinceLastSync.get() > 1024 * 1024 * 4) {
        try {
          m_fc.force(false);
        }
 catch (        IOException e) {
          SNAP_LOG.error("Error syncing snapshot",e);
        }
        m_bytesSinceLastSync.set(0);
      }
    }
  }
,DefaultSnapshotDataTarget.SNAPSHOT_SYNC_FREQUENCY,DefaultSnapshotDataTarget.SNAPSHOT_SYNC_FREQUENCY,TimeUnit.MILLISECONDS);
  m_syncTask=syncTask;
}
