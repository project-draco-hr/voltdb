{
  System.out.println("testConnectingToFailingCluster");
  NullExportClient client=new NullExportClient();
  client.addServerInfo(new InetSocketAddress("localhost",VoltDB.DEFAULT_PORT));
  VoltDBFickleCluster.start();
  client.addServerInfo(new InetSocketAddress(VoltDBFickleCluster.getPort(0)));
  assertTrue(client.connect());
  VoltDBFickleCluster.killNode();
  long now=System.currentTimeMillis();
  while ((System.currentTimeMillis() - now) < 10000) {
    try {
      client.work();
      fail();
    }
 catch (    ExportClientException e) {
      break;
    }
  }
  client.disconnect();
  boolean connected=client.connect();
  if (!connected) {
    System.out.println("Couldn't reconnect");
    Process p=Runtime.getRuntime().exec("lsof -i");
    java.io.InputStreamReader reader=new java.io.InputStreamReader(p.getInputStream());
    java.io.BufferedReader br=new java.io.BufferedReader(reader);
    String str=null;
    while ((str=br.readLine()) != null) {
      if (str.contains("LISTEN")) {
        System.out.println(str);
      }
    }
  }
  assertTrue(connected);
  client.disconnect();
  VoltDBFickleCluster.stop();
}
