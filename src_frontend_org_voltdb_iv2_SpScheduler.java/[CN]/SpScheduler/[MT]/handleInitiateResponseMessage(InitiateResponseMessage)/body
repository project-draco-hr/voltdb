{
  final long spHandle=message.getSpHandle();
  final DuplicateCounterKey dcKey=new DuplicateCounterKey(message.getTxnId(),spHandle);
  DuplicateCounter counter=m_duplicateCounters.get(dcKey);
  if (counter != null) {
    int result=counter.offer(message);
    if (result == DuplicateCounter.DONE) {
      m_duplicateCounters.remove(dcKey);
      m_repairLogTruncationHandle=spHandle;
      m_mailbox.send(counter.m_destinationId,counter.getLastResponse());
    }
 else     if (result == DuplicateCounter.MISMATCH) {
      VoltDB.crashGlobalVoltDB("HASH MISMATCH: replicas produced different results.",true,null);
    }
  }
 else {
    m_repairLogTruncationHandle=spHandle;
    m_mailbox.send(message.getInitiatorHSId(),message);
  }
}
