{
  if (m_isLeader) {
    CompleteTransactionMessage replmsg=new CompleteTransactionMessage(message);
    replmsg.setSpHandle(getCurrentTxnId());
    if (m_sendToHSIds.length > 0) {
      m_mailbox.send(m_sendToHSIds,replmsg);
    }
  }
 else {
    setMaxSeenTxnId(message.getSpHandle());
  }
  TransactionState txn=m_outstandingTxns.get(message.getTxnId());
  if (txn != null) {
    Iv2Trace.logCompleteTransactionMessage(message,m_mailbox.getHSId());
    final CompleteTransactionTask task=new CompleteTransactionTask(txn,m_pendingTasks,message,m_drGateway);
    queueOrOfferMPTask(task);
    if (!message.isRestart()) {
      m_outstandingTxns.remove(message.getTxnId());
    }
  }
}
