{
  if (m_sendToHSIds.size() > 0) {
    CompleteTransactionMessage replmsg=message;
    m_mailbox.send(com.google.common.primitives.Longs.toArray(m_sendToHSIds),replmsg);
  }
  TransactionState txn=m_outstandingTxns.get(message.getTxnId());
  if (txn != null) {
    final CompleteTransactionTask task=new CompleteTransactionTask(txn,m_pendingTasks,message,m_drGateway);
    m_pendingTasks.offer(task);
    if (!message.isRollbackForFault()) {
      m_outstandingTxns.remove(message.getTxnId());
    }
  }
}
