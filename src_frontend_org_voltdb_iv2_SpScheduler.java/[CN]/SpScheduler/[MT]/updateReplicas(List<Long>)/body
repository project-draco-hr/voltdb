{
  m_replicaHSIds=replicas;
  m_sendToHSIds=new ArrayList<Long>(m_replicaHSIds);
  m_sendToHSIds.remove(m_mailbox.getHSId());
  List<Long> doneCounters=new LinkedList<Long>();
  for (  DuplicateCounter counter : m_duplicateCounters.values()) {
    int result=counter.updateReplicas(m_replicaHSIds);
    if (result == DuplicateCounter.DONE) {
      doneCounters.add(counter.getTxnId());
    }
  }
  Collections.sort(doneCounters);
  for (  Long txnId : doneCounters) {
    DuplicateCounter counter=m_duplicateCounters.remove(txnId);
    VoltMessage resp=counter.getLastResponse();
    if (resp != null) {
      m_mailbox.send(counter.m_destinationId,resp);
    }
 else {
      hostLog.warn("TXN " + counter.getTxnId() + " lost all replicas and "+ "had no responses.  This should be impossible?");
    }
  }
}
