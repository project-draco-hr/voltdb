{
  assert(invocation != null);
  assert(partitions != null);
  assert(numPartitions >= 1);
  if (isSinglePartition) {
    assert(numPartitions == 1);
    createSinglePartitionTxn(connectionId,connectionHostname,invocation,isReadOnly,partitions[0],clientData,messageSize,now);
    return;
  }
 else {
    long txnId=m_idManager.getNextUniqueTransactionId();
    int[] allSiteIds=m_siteTracker.getAllSitesForEachPartition(partitions);
    int coordinatorId=allSiteIds[0];
    int[] otherSiteIds=new int[allSiteIds.length - 1];
    for (int i=1; i < allSiteIds.length; i++) {
      if (m_hostId == allSiteIds[i] / VoltDB.SITES_TO_HOST_DIVISOR) {
        otherSiteIds[i - 1]=coordinatorId;
        coordinatorId=allSiteIds[i];
      }
 else {
        otherSiteIds[i - 1]=allSiteIds[i];
      }
    }
    InFlightTxnState txn=new InFlightTxnState(txnId,coordinatorId,otherSiteIds,isReadOnly,false,invocation,clientData,messageSize,now,connectionId,connectionHostname);
    dispatchMultiPartitionTxn(txn);
  }
}
