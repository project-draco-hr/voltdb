{
  long txnId=m_idManager.getNextUniqueTransactionId();
  ArrayList<Integer> site_ids=m_siteTracker.getAllSitesForPartition(partition);
  ArrayList<InFlightTxnState> txn_states=new ArrayList<InFlightTxnState>();
  m_stats.logTransactionCreated(connectionId,invocation);
  for (  int site_id : site_ids) {
    InFlightTxnState txn=new InFlightTxnState(txnId,site_id,null,isReadOnly,true,invocation,clientData);
    txn_states.add(txn);
synchronized (m_pendingTxns) {
      m_pendingTxns.addTxn(txn.txnId,txn.coordinatorId,txn);
      if (m_pendingTxns.size() > MAX_DESIRED_PENDING) {
        if (!m_hadBackPressure) {
          transactionLog.trace("DTXN back pressure began");
          m_hadBackPressure=true;
          m_onBackPressure.run();
        }
      }
    }
  }
  for (  InFlightTxnState txn_state : txn_states) {
    sendTransactionToCoordinator(txn_state);
  }
}
