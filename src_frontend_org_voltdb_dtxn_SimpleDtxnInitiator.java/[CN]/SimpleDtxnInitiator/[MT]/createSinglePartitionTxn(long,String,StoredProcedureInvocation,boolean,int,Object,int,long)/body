{
  long txnId=m_idManager.getNextUniqueTransactionId();
  ArrayList<Integer> site_ids=m_siteTracker.getAllSitesForPartition(partition);
  ArrayList<InFlightTxnState> txn_states=new ArrayList<InFlightTxnState>();
  m_pendingTxnBytes+=messageSize;
  m_pendingTxnCount++;
  if (m_pendingTxnCount > MAX_DESIRED_PENDING_TXNS || m_pendingTxnBytes > MAX_DESIRED_PENDING_BYTES) {
    if (!m_hadBackPressure) {
      transactionLog.trace("DTXN back pressure began");
      m_hadBackPressure=true;
      m_onBackPressure.run();
    }
  }
  for (  int site_id : site_ids) {
    InFlightTxnState txn=new InFlightTxnState(txnId,site_id,null,isReadOnly,true,invocation.getShallowCopy(),clientData,messageSize,now,connectionId,connectionHostname);
    txn_states.add(txn);
    m_pendingTxns.addTxn(txn.txnId,txn.coordinatorId,txn);
  }
  for (  InFlightTxnState txn_state : txn_states) {
    sendTransactionToCoordinator(txn_state);
  }
}
