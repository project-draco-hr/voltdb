{
  buildCatalog();
  VoltDB.replaceVoltDBInstanceForTest(m_volt);
  doReturn(m_statsAgent).when(m_volt).getStatsAgent();
  doReturn(mock(SnapshotCompletionMonitor.class)).when(m_volt).getSnapshotCompletionMonitor();
  doReturn(m_messenger).when(m_volt).getHostMessenger();
  doReturn(mock(Configuration.class)).when(m_volt).getConfig();
  AgreementSite agreementSite=mock(AgreementSite.class);
  doReturn(AGREEMENT_SITE_ID).when(agreementSite).siteId();
  doReturn(agreementSite).when(m_volt).getAgreementSite();
  VoltNetworkPool network=mock(VoltNetworkPool.class);
  m_ci=spy(new ClientInterface(VoltDB.DEFAULT_PORT,VoltDB.DEFAULT_ADMIN_PORT,m_context,network,ReplicationRole.NONE,100,m_initiator,m_allPartitions));
  ArgumentCaptor<Mailbox> captor=ArgumentCaptor.forClass(Mailbox.class);
  verify(m_messenger).createMailbox(eq(100),eq(VoltDB.CLIENT_INTERFACE_MAILBOX_ID),captor.capture());
  assertNotNull(captor.getValue());
  m_mb=captor.getValue();
}
