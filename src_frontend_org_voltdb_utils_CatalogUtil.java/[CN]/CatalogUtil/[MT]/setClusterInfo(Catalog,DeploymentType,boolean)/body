{
  ClusterType cluster=deployment.getCluster();
  int hostCount=cluster.getHostcount();
  int sitesPerHost=cluster.getSitesperhost();
  int kFactor=cluster.getKfactor();
  ClusterConfig config=new ClusterConfig(hostCount,sitesPerHost,kFactor);
  if (printLog) {
    hostLog.l7dlog(Level.INFO,LogKeys.compiler_VoltCompiler_LeaderAndHostCountAndSitesPerHost.name(),new Object[]{config.getHostCount(),VoltDB.instance().getConfig().m_leader,config.getSitesPerHost(),config.getReplicationFactor()},null);
  }
  int replicas=config.getReplicationFactor() + 1;
  int partitionCount=config.getSitesPerHost() * config.getHostCount() / replicas;
  if (printLog) {
    hostLog.info(String.format("The entire cluster has %d %s of%s %d logical partition%s.",replicas,replicas > 1 ? "copies" : "copy",partitionCount > 1 ? " each of the" : "",partitionCount,partitionCount > 1 ? "s" : ""));
  }
  if (!config.validate()) {
    hostLog.error(config.getErrorMsg());
  }
 else {
    Cluster catCluster=catalog.getClusters().get("cluster");
    Deployment catDeploy=catCluster.getDeployment().get("deployment");
    catDeploy.setHostcount(hostCount);
    catDeploy.setSitesperhost(sitesPerHost);
    catDeploy.setKfactor(kFactor);
    String defaultPPDPrefix="partition_detection";
    if (deployment.getPartitionDetection() != null) {
      if (deployment.getPartitionDetection().isEnabled()) {
        catCluster.setNetworkpartition(true);
        CatalogMap<SnapshotSchedule> faultsnapshots=catCluster.getFaultsnapshots();
        SnapshotSchedule sched=faultsnapshots.add("CLUSTER_PARTITION");
        if (deployment.getPartitionDetection().getSnapshot() != null) {
          sched.setPrefix(deployment.getPartitionDetection().getSnapshot().getPrefix());
        }
 else {
          sched.setPrefix(defaultPPDPrefix);
        }
        if (printLog) {
          hostLog.info("Detection of network partitions in the cluster is enabled.");
        }
      }
 else {
        catCluster.setNetworkpartition(false);
        if (printLog) {
          hostLog.info("Detection of network partitions in the cluster is not enabled.");
        }
      }
    }
 else {
      if (VoltDB.instance().isIV2Enabled()) {
        catCluster.setNetworkpartition(true);
        CatalogMap<SnapshotSchedule> faultsnapshots=catCluster.getFaultsnapshots();
        SnapshotSchedule sched=faultsnapshots.add("CLUSTER_PARTITION");
        sched.setPrefix(defaultPPDPrefix);
        if (printLog) {
          hostLog.info("Detection of network partitions in the cluster is enabled.");
        }
      }
 else {
        catCluster.setNetworkpartition(false);
        if (printLog) {
          hostLog.info("Detection of network partitions in the cluster is not enabled.");
        }
      }
    }
    if (deployment.getAdminMode() != null) {
      catCluster.setAdminport(deployment.getAdminMode().getPort());
      catCluster.setAdminstartup(deployment.getAdminMode().isAdminstartup());
    }
 else {
      catCluster.setAdminport(VoltDB.DEFAULT_ADMIN_PORT);
      catCluster.setAdminstartup(false);
    }
    setSystemSettings(deployment,catDeploy);
    if (deployment.getHeartbeat() != null) {
      catCluster.setHeartbeattimeout(deployment.getHeartbeat().getTimeout());
    }
 else {
      catCluster.setHeartbeattimeout(10);
    }
  }
}
