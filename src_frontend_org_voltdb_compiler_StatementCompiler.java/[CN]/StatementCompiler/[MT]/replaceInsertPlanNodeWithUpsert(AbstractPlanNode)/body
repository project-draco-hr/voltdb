{
  if (root == null)   return null;
  List<AbstractPlanNode> inserts=root.findAllNodesOfType(PlanNodeType.INSERT);
  if (inserts.size() == 1) {
    InsertPlanNode insertNode=(InsertPlanNode)inserts.get(0);
    UpsertPlanNode upsertNode=new UpsertPlanNode(insertNode);
    assert(insertNode.getParentCount() == 1);
    AbstractPlanNode parent=insertNode.getParent(0);
    parent.clearChildren();
    parent.addAndLinkChild(upsertNode);
    assert(insertNode.getChildCount() == 1);
    AbstractPlanNode child=insertNode.getChild(0);
    child.clearParents();
    upsertNode.addAndLinkChild(child);
  }
  return root;
}
