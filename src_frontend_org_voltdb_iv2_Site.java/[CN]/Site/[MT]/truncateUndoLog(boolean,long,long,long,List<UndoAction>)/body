{
  if (!rollback) {
    setLastCommittedSpHandleAndSpUniqueId(spHandle,spUniqueId);
  }
  latestUndoTxnId=Long.MIN_VALUE;
  if (beginUndoToken == Site.kInvalidUndoToken)   return;
  if (rollback) {
    m_ee.undoUndoToken(beginUndoToken);
  }
 else {
    assert(latestUndoToken != Site.kInvalidUndoToken);
    assert(latestUndoToken >= beginUndoToken);
    if (latestUndoToken > beginUndoToken) {
      m_ee.releaseUndoToken(latestUndoToken);
    }
  }
  handleUndoLog(undoLog,rollback);
}
