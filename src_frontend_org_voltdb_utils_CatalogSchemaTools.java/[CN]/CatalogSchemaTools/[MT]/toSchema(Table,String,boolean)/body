{
  assert(!catalog_tbl.getColumns().isEmpty());
  final String spacer="   ";
  boolean tableIsView=(viewQuery != null);
  Set<Index> skip_indexes=new HashSet<Index>();
  Set<Constraint> skip_constraints=new HashSet<Constraint>();
  String ret=new String();
  if (tableIsView) {
    ret="CREATE VIEW " + catalog_tbl.getTypeName() + " (";
  }
 else {
    ret="CREATE TABLE " + catalog_tbl.getTypeName() + " (";
  }
  String add="\n";
  for (  Column catalog_col : CatalogUtil.getSortedCatalogItems(catalog_tbl.getColumns(),"index")) {
    VoltType col_type=VoltType.get((byte)catalog_col.getType());
    if (tableIsView) {
      ret+=add + spacer + catalog_col.getTypeName();
      add=",\n";
      continue;
    }
    ret+=add + spacer + catalog_col.getTypeName()+ " "+ col_type.toSQLString()+ ((col_type == VoltType.STRING || col_type == VoltType.VARBINARY) && catalog_col.getSize() > 0 ? "(" + catalog_col.getSize() + ")" : "");
    String defaultvalue=catalog_col.getDefaultvalue();
    boolean nullable=catalog_col.getNullable();
    if (defaultvalue == null) {
    }
 else     if (defaultvalue.toLowerCase().equals("null") && nullable) {
      defaultvalue=null;
    }
 else {
      defaultvalue=defaultvalue.replace("\'","\'\'");
      defaultvalue="'" + defaultvalue + "'";
    }
    if (defaultvalue == null) {
      ret+=(!nullable ? " NOT NULL" : "");
    }
 else {
      ret+=" DEFAULT " + (defaultvalue != null ? defaultvalue : "NULL") + (!nullable ? " NOT NULL" : "");
    }
    for (    ConstraintRef catalog_const_ref : catalog_col.getConstraints()) {
      Constraint catalog_const=catalog_const_ref.getConstraint();
      ConstraintType const_type=ConstraintType.get(catalog_const.getType());
      boolean found=false;
      for (      Column catalog_other_col : catalog_tbl.getColumns()) {
        if (catalog_other_col.equals(catalog_col))         continue;
        if (catalog_other_col.getConstraints().getIgnoreCase(catalog_const.getTypeName()) != null) {
          found=true;
          break;
        }
      }
      if (!found) {
switch (const_type) {
case FOREIGN_KEY:
{
            Table catalog_fkey_tbl=catalog_const.getForeignkeytable();
            Column catalog_fkey_col=null;
            for (            ColumnRef ref : catalog_const.getForeignkeycols()) {
              catalog_fkey_col=ref.getColumn();
              break;
            }
            assert(catalog_fkey_col != null);
            ret+=" REFERENCES " + catalog_fkey_tbl.getTypeName() + " ("+ catalog_fkey_col.getTypeName()+ ")";
            skip_constraints.add(catalog_const);
            break;
          }
default :
      }
    }
  }
  add=",\n";
}
for (Constraint catalog_const : catalog_tbl.getConstraints()) {
  if (skip_constraints.contains(catalog_const))   continue;
  ConstraintType const_type=ConstraintType.get(catalog_const.getType());
  if (const_type == ConstraintType.PRIMARY_KEY || const_type == ConstraintType.UNIQUE) {
    Index catalog_idx=catalog_const.getIndex();
    if (!tableIsView) {
      ret+=add + spacer;
      if (!catalog_const.getTypeName().startsWith("AUTOGEN_")) {
        ret+="CONSTRAINT " + catalog_const.getTypeName() + " ";
      }
      if (const_type == ConstraintType.PRIMARY_KEY || const_type == ConstraintType.UNIQUE) {
        if (const_type == ConstraintType.PRIMARY_KEY) {
          ret+="PRIMARY KEY (";
        }
 else {
          if (catalog_idx.getAssumeunique()) {
            ret+="ASSUMEUNIQUE (";
          }
 else {
            ret+="UNIQUE (";
          }
        }
        String col_add="";
        String exprStrings=new String();
        if (catalog_idx.getExpressionsjson() != null && !catalog_idx.getExpressionsjson().equals("")) {
          StmtTargetTableScan tableScan=new StmtTargetTableScan(catalog_tbl,catalog_tbl.getTypeName());
          try {
            List<AbstractExpression> expressions=AbstractExpression.fromJSONArrayString(catalog_idx.getExpressionsjson(),tableScan);
            String sep="";
            for (            AbstractExpression expr : expressions) {
              exprStrings+=sep + expr.explain(catalog_tbl.getTypeName());
              sep=",";
            }
          }
 catch (          JSONException e) {
          }
          ret+=col_add + exprStrings;
        }
 else {
          for (          ColumnRef catalog_colref : CatalogUtil.getSortedCatalogItems(catalog_idx.getColumns(),"index")) {
            ret+=col_add + catalog_colref.getColumn().getTypeName();
            col_add=", ";
          }
        }
        ret+=")";
      }
 else       if (const_type == ConstraintType.LIMIT) {
        ret+="LIMIT PARTITION ROWS " + String.valueOf(catalog_tbl.getTuplelimit());
      }
    }
    skip_indexes.add(catalog_idx);
  }
 else   if (const_type == ConstraintType.FOREIGN_KEY) {
    Table catalog_fkey_tbl=catalog_const.getForeignkeytable();
    String col_add="";
    String our_columns="";
    String fkey_columns="";
    for (    ColumnRef catalog_colref : catalog_const.getForeignkeycols()) {
      Column our_column=catalog_tbl.getColumns().getIgnoreCase(catalog_colref.getTypeName());
      assert(our_column != null);
      our_columns+=col_add + our_column.getTypeName();
      Column fkey_column=catalog_colref.getColumn();
      assert(fkey_column != null);
      fkey_columns+=col_add + fkey_column.getTypeName();
      col_add=", ";
    }
    ret+=add + spacer + "CONSTRAINT "+ catalog_const.getTypeName()+ " "+ "FOREIGN KEY ("+ our_columns+ ") "+ "REFERENCES "+ catalog_fkey_tbl.getTypeName()+ " ("+ fkey_columns+ ")";
  }
  skip_constraints.add(catalog_const);
}
if (catalog_tbl.getTuplelimit() != Integer.MAX_VALUE) {
  ret+=add + spacer + "LIMIT PARTITION ROWS "+ String.valueOf(catalog_tbl.getTuplelimit());
}
if (viewQuery != null) {
  ret+="\n) AS \n";
  ret+=spacer + viewQuery + ";\n";
}
 else {
  ret+="\n);\n";
}
if (catalog_tbl.getPartitioncolumn() != null && viewQuery == null) {
  ret+="PARTITION TABLE " + catalog_tbl.getTypeName() + " ON COLUMN "+ catalog_tbl.getPartitioncolumn().getTypeName()+ ";\n";
}
for (Index catalog_idx : catalog_tbl.getIndexes()) {
  if (skip_indexes.contains(catalog_idx))   continue;
  if (catalog_idx.getUnique()) {
    if (catalog_idx.getAssumeunique()) {
      ret+="CREATE ASSUMEUNIQUE INDEX ";
    }
 else {
      ret+="CREATE UNIQUE INDEX ";
    }
  }
 else {
    ret+="CREATE INDEX ";
  }
  ret+=catalog_idx.getTypeName() + " ON " + catalog_tbl.getTypeName()+ " (";
  add="";
  String jsonstring=catalog_idx.getExpressionsjson();
  if (jsonstring.isEmpty()) {
    for (    ColumnRef catalog_colref : CatalogUtil.getSortedCatalogItems(catalog_idx.getColumns(),"index")) {
      ret+=add + catalog_colref.getColumn().getTypeName();
      add=", ";
    }
  }
 else {
    List<AbstractExpression> indexedExprs=null;
    try {
      indexedExprs=AbstractExpression.fromJSONArrayString(jsonstring,new StmtTargetTableScan(catalog_tbl,catalog_tbl.getTypeName()));
    }
 catch (    JSONException e) {
      e.printStackTrace();
    }
    for (    AbstractExpression expr : indexedExprs) {
      ret+=add + expr.explain(catalog_tbl.getTypeName());
      add=", ";
    }
  }
  ret+=");\n";
}
if (isExportTable) {
  ret+="EXPORT TABLE " + catalog_tbl.getTypeName() + ";\n";
}
ret+="\n";
return ret;
}
