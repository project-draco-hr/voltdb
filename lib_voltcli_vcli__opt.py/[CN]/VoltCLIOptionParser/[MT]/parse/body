def parse(self, cmdargs):
    iverb = 0
    while (iverb < len(cmdargs)):
        if cmdargs[iverb].startswith('-'):
            for opt in self.options:
                if (cmdargs[iverb] in opt.args):
                    if ((not ('action' in opt.kwargs)) or (opt.kwargs['action'] == 'store')):
                        iverb += 1
        else:
            break
        iverb += 1
    (opts, args) = optparse.OptionParser.parse_args(self, list(cmdargs[:iverb]))
    assert (len(args) == 0)
    for option in self.options:
        name = option.kwargs['dest']
        setattr(sys.modules[__name__], name, getattr(opts, name))
    if (iverb == len(cmdargs)):
        self._abort('Missing command.')
    verb_name = cmdargs[iverb].lower()
    verb = None
    for verb_chk in self.verbs:
        if (verb_chk.name == verb_name):
            verb = verb_chk
            break
    else:
        self._abort(('Unknown command: %s' % verb_name))
    verb_parser = optparse.OptionParser(description=verb.metadata.description, usage=verb.metadata.usage)
    if (iverb < len(cmdargs)):
        if verb.metadata.options:
            for opt in verb.metadata.options:
                verb_parser.add_option(*opt.args, **opt.kwargs)
        (options, args) = verb_parser.parse_args(list(cmdargs[(iverb + 1):]))
    else:
        options = None
        args = []
    return (verb, options, args, self, verb_parser)
