{
  int hostId=siteId / VoltDB.SITES_TO_HOST_DIVISOR;
  int localSiteId=siteId % VoltDB.SITES_TO_HOST_DIVISOR;
  if (hostId == m_localHostId) {
    MessengerSite site=m_messengerSites[localSiteId];
    if (site != null) {
      SiteMailbox mbox=site.getMailbox(mailboxId);
      if (mbox != null) {
        mbox.deliver(message);
        return null;
      }
    }
  }
  ForeignHost fhost=m_foreignHosts[hostId];
  if (fhost == null) {
    throw new MessagingException("Really shouldn't have gotten here...");
  }
  if (!fhost.isUp()) {
    m_logger.info("Attempted delivery of message to failed site: " + siteId);
    return null;
  }
  return fhost;
}
