{
  final Map<Long,PartitionInfo> currentPartitionInfo=partitionData.getPartitionInfo();
  final long partitionCount=currentPartitionInfo.size();
  final CountDownLatch latch=new CountDownLatch((int)partitionCount);
  final AtomicLong totalTuplesDeleted=new AtomicLong(0);
  final AtomicLong partitionsUnfinished=new AtomicLong(0);
  TimestampType dateTarget=new TimestampType((System.currentTimeMillis() - 30 * 1000) * 1000);
  for (  PartitionInfo pinfo : currentPartitionInfo.values()) {
    try {
      client.callProcedure(new Callback(latch,totalTuplesDeleted,partitionsUnfinished),"DeleteAfterDate",pinfo.partitionKey,dateTarget,CHUNK_SIZE);
    }
 catch (    Exception e) {
      e.printStackTrace();
      latch.countDown();
    }
  }
  try {
    latch.await();
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
  return new long[]{totalTuplesDeleted.get(),partitionsUnfinished.get()};
}
