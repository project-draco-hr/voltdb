{
  byte[] catalogBytes=null;
  int version=0;
  do {
    try {
      ByteBuffer versionAndBytes=ByteBuffer.wrap(m_rvdb.getHostMessenger().getZK().getData(VoltZK.catalogbytes,false,null));
      version=versionAndBytes.getInt();
      catalogBytes=new byte[versionAndBytes.remaining()];
      versionAndBytes.get(catalogBytes);
      versionAndBytes=null;
    }
 catch (    org.apache.zookeeper_voltpatches.KeeperException.NoNodeException e) {
    }
catch (    Exception e) {
      VoltDB.crashLocalVoltDB("System was interrupted while waiting for a catalog.",false,null);
    }
  }
 while (catalogBytes == null);
  try {
    m_rvdb.m_serializedCatalog=CatalogUtil.loadCatalogFromJar(catalogBytes,hostLog);
  }
 catch (  IOException e) {
    VoltDB.crashLocalVoltDB("Unable to load catalog: " + e.getMessage(),false,null);
  }
  if ((m_rvdb.m_serializedCatalog == null) || (m_rvdb.m_serializedCatalog.length() == 0))   VoltDB.crashLocalVoltDB("Catalog loading failure",false,null);
  Catalog catalog=new Catalog();
  catalog.execute(m_rvdb.m_serializedCatalog);
  try {
    m_rvdb.m_depCRC=CatalogUtil.compileDeploymentAndGetCRC(catalog,m_deployment,true,false);
    if (m_rvdb.m_depCRC < 0)     System.exit(-1);
  }
 catch (  Exception e) {
    hostLog.fatal("Error parsing deployment file",e);
    System.exit(-1);
  }
  try {
    long catalogTxnId;
    if (m_rvdb.isIV2Enabled()) {
      catalogTxnId=TxnEgo.makeZero(0).getTxnId();
    }
 else {
      catalogTxnId=org.voltdb.TransactionIdManager.makeIdFromComponents(System.currentTimeMillis(),0,0);
    }
    ZooKeeper zk=m_rvdb.getHostMessenger().getZK();
    zk.create(VoltZK.initial_catalog_txnid,String.valueOf(catalogTxnId).getBytes("UTF-8"),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,new ZKUtil.StringCallback(),null);
    ZKUtil.ByteArrayCallback cb=new ZKUtil.ByteArrayCallback();
    zk.getData(VoltZK.initial_catalog_txnid,false,cb,null);
    catalogTxnId=Long.valueOf(new String(cb.getData(),"UTF-8"));
    m_rvdb.m_serializedCatalog=catalog.serialize();
    m_rvdb.m_catalogContext=new CatalogContext(catalogTxnId,catalog,catalogBytes,m_rvdb.m_depCRC,version,-1);
  }
 catch (  Exception e) {
    VoltDB.crashLocalVoltDB("Error agreeing on starting catalog version",false,e);
  }
}
