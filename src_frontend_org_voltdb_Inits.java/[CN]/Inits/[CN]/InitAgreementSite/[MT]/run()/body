{
  int myAgreementSiteId=-1;
  HashSet<Integer> agreementSiteIds=new HashSet<Integer>();
  int myAgreementInitiatorId=0;
  for (  Site site : m_rvdb.m_catalogContext.siteTracker.getAllSites()) {
    int sitesHostId=Integer.parseInt(site.getHost().getTypeName());
    int currSiteId=Integer.parseInt(site.getTypeName());
    if (sitesHostId == m_rvdb.m_myHostId) {
      hostLog.l7dlog(Level.TRACE,LogKeys.org_voltdb_VoltDB_CreatingLocalSite.name(),new Object[]{currSiteId},null);
      m_rvdb.m_messenger.createLocalSite(currSiteId);
    }
    if (site.getIsexec() == false) {
      agreementSiteIds.add(currSiteId);
      if (sitesHostId == m_rvdb.m_myHostId) {
        myAgreementSiteId=currSiteId;
        myAgreementInitiatorId=site.getInitiatorid();
      }
    }
  }
  assert(m_rvdb.m_agreementSite == null);
  assert(myAgreementSiteId != -1);
  Mailbox agreementMailbox=m_rvdb.m_messenger.createMailbox(myAgreementSiteId,VoltDB.AGREEMENT_MAILBOX_ID,false);
  try {
    m_rvdb.m_agreementSite=new AgreementSite(myAgreementSiteId,agreementSiteIds,myAgreementInitiatorId,m_rvdb.m_downNonExecSites,agreementMailbox,new InetSocketAddress(m_config.m_zkInterface.split(":")[0],Integer.parseInt(m_config.m_zkInterface.split(":")[1])),m_rvdb.m_faultManager,m_rvdb.m_recovering);
    m_rvdb.m_agreementSite.start();
  }
 catch (  Exception e) {
    hostLog.fatal(null,e);
    System.exit(-1);
  }
}
