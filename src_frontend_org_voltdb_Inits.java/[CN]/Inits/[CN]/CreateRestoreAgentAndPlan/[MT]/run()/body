{
  if (!m_isRejoin && !m_config.m_isRejoinTest && !m_rvdb.m_joining) {
    String snapshotPath=null;
    if (m_rvdb.m_catalogContext.cluster.getDatabases().get("database").getSnapshotschedule().get("default") != null) {
      snapshotPath=m_rvdb.m_catalogContext.cluster.getDatabases().get("database").getSnapshotschedule().get("default").getPath();
    }
    int[] allPartitions=new int[m_rvdb.m_configuredNumberOfPartitions];
    for (int ii=0; ii < allPartitions.length; ii++) {
      allPartitions[ii]=ii;
    }
    org.voltdb.catalog.CommandLog cl=m_rvdb.m_catalogContext.cluster.getLogconfig().get("log");
    try {
      m_rvdb.m_restoreAgent=new RestoreAgent(m_rvdb.m_messenger.getZK(),m_rvdb.getSnapshotCompletionMonitor(),m_rvdb,m_rvdb.m_myHostId,m_config.m_startAction,cl.getEnabled(),cl.getLogpath(),cl.getInternalsnapshotpath(),snapshotPath,allPartitions,ImmutableSet.copyOf(m_rvdb.m_messenger.getLiveHostIds()),CatalogUtil.getVoltDbRoot(m_deployment.getPaths()).getAbsolutePath());
    }
 catch (    IOException e) {
      VoltDB.crashLocalVoltDB("Unable to construct the RestoreAgent",true,e);
    }
    m_rvdb.m_restoreAgent.setCatalogContext(m_rvdb.m_catalogContext);
    Pair<Integer,String> catalog=m_rvdb.m_restoreAgent.findRestoreCatalog();
    if (catalog != null) {
      hostLog.debug("Found catalog to load on host " + catalog.getFirst() + ": "+ catalog.getSecond());
      m_rvdb.m_hostIdWithStartupCatalog=catalog.getFirst().intValue();
      assert(m_rvdb.m_hostIdWithStartupCatalog >= 0);
      m_rvdb.m_pathToStartupCatalog=catalog.getSecond();
      assert(m_rvdb.m_pathToStartupCatalog != null);
    }
  }
}
