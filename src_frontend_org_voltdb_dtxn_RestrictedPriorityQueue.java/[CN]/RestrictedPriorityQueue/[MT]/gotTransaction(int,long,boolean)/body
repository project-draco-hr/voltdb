{
  assert(m_lastTxnFromEachInitiator.containsKey(initiatorId));
  if (m_lastTxnPopped > txnId) {
    StringBuilder msg=new StringBuilder();
    msg.append("Txn ordering deadlock at site ").append(m_siteId).append(":\n");
    msg.append("   txn ").append(m_lastTxnPopped).append(" (");
    msg.append(TransactionIdManager.toString(m_lastTxnPopped)).append(" HB:");
    msg.append(isHeartbeat).append(") before\n");
    msg.append("   txn ").append(txnId).append(" (");
    msg.append(TransactionIdManager.toString(txnId)).append(" HB:");
    msg.append(isHeartbeat).append(").\n");
    throw new RuntimeException(msg.toString());
  }
  long prevTxnId=m_lastTxnFromEachInitiator.get(initiatorId);
  if (prevTxnId < txnId)   m_lastTxnFromEachInitiator.put(initiatorId,txnId);
  long min=Long.MAX_VALUE;
  for (  long l : m_lastTxnFromEachInitiator.values())   if (l < min)   min=l;
  m_newestSafeTransaction=min;
}
