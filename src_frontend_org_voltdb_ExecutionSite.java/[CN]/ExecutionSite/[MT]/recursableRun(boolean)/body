{
  while ((!shutdownAllowed) || (m_shouldContinue)) {
    boolean moreWork=(m_currentTransactionState != null) || ((m_currentTransactionState=m_transactionQueue.poll()) != null);
    while (moreWork) {
      assert(m_currentTransactionState != null);
      if (m_currentTransactionState.doWork()) {
        completeTransaction(m_currentTransactionState.isReadOnly);
        TransactionState ts=m_transactionsById.remove(m_currentTransactionState.txnId);
        assert(ts != null);
        moreWork=(m_currentTransactionState=m_transactionQueue.poll()) != null;
      }
 else {
        moreWork=false;
        if (m_currentTransactionState.shouldResumeProcedure()) {
          Map<Integer,List<VoltTable>> retval=m_currentTransactionState.getPreviousStackFrameDropDependendencies();
          assert(retval != null);
          assert(shutdownAllowed == false);
          return retval;
        }
      }
    }
    VoltMessage message=m_mailbox.recvBlocking(5);
    tick();
    if (message != null) {
      handleMailboxMessage(message);
    }
  }
  assert(shutdownAllowed);
  return null;
}
