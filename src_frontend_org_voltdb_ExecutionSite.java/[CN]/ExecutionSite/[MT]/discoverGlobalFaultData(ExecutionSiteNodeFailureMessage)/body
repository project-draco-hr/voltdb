{
  SiteTracker siteTracker=VoltDB.instance().getSiteTracker();
  if (m_recovering) {
    VoltDB.crashLocalVoltDB("Aborting recovery due to a remote node failure. Retry again.",false,null);
  }
  HashSet<NodeFailureFault> failures=message.m_failedHosts;
  m_context=VoltDB.instance().getCatalogContext();
  HashSet<Long> failedSiteIds=new HashSet<Long>();
  for (  NodeFailureFault fault : failures) {
    failedSiteIds.addAll(siteTracker.getSitesForHost(fault.getHostId()));
  }
  m_knownFailedSites.addAll(failedSiteIds);
  HashMap<Long,Long> initiatorSafeInitPoint=new HashMap<Long,Long>();
  int expectedResponses=discoverGlobalFaultData_send();
  Long multiPartitionCommitPoint=discoverGlobalFaultData_rcv(expectedResponses,initiatorSafeInitPoint);
  if (multiPartitionCommitPoint == null) {
    return;
  }
  HashSet<Long> newFailedSiteIds=new HashSet<Long>(failedSiteIds);
  newFailedSiteIds.removeAll(m_handledFailedSites);
  PPDPolicyDecision makePPDPolicyDecisions=VoltDB.instance().getFaultDistributor().makePPDPolicyDecisions(newFailedSiteIds);
  if (makePPDPolicyDecisions == PPDPolicyDecision.NodeFailure) {
    handleSiteFaults(false,newFailedSiteIds,multiPartitionCommitPoint,initiatorSafeInitPoint);
  }
 else   if (makePPDPolicyDecisions == PPDPolicyDecision.PartitionDetection) {
    handleSiteFaults(true,newFailedSiteIds,multiPartitionCommitPoint,initiatorSafeInitPoint);
  }
  m_handledFailedSites.addAll(failedSiteIds);
  for (  NodeFailureFault fault : failures) {
    if (newFailedSiteIds.containsAll(siteTracker.getSitesForHost(fault.getHostId()))) {
      VoltDB.instance().getFaultDistributor().reportFaultHandled(m_faultHandler,fault);
    }
  }
}
