{
  SiteTracker siteTracker=VoltDB.instance().getSiteTracker();
  int expectedResponses=0;
  Set<Long> survivors=siteTracker.getAllSites();
  HashSet<Long> survivorSet=new HashSet<Long>();
  for (  long survivor : survivors) {
    survivorSet.add(survivor);
  }
  m_recoveryLog.info("Sending fault data " + m_knownFailedSites.toString() + " to "+ survivorSet.toString()+ " survivors with lastKnownGloballyCommitedMultiPartTxnId "+ lastKnownGloballyCommitedMultiPartTxnId);
  try {
    for (    Long site : m_knownFailedSites) {
      Integer hostId=SiteTracker.getHostForSite(site);
      HashMap<Long,Long> siteMap=m_newestSafeTransactionForInitiatorLedger.get(hostId);
      if (siteMap == null) {
        siteMap=new HashMap<Long,Long>();
        m_newestSafeTransactionForInitiatorLedger.put(hostId,siteMap);
      }
      if (siteTracker.getAllInitiators().contains(site)) {
        Long txnId=m_transactionQueue.getNewestSafeTransactionForInitiator(site);
        if (txnId == null) {
          txnId=siteMap.get(site);
        }
 else {
          siteMap.put(site,txnId);
        }
        FailureSiteUpdateMessage srcmsg=new FailureSiteUpdateMessage(m_siteId,m_knownFailedSites,site,txnId != null ? txnId : Long.MIN_VALUE,lastKnownGloballyCommitedMultiPartTxnId);
        m_mailbox.send(MiscUtils.toLongArray(survivors),srcmsg);
        expectedResponses+=(survivors.size());
      }
    }
  }
 catch (  MessagingException e) {
    VoltDB.crashLocalVoltDB(e.getMessage(),true,e);
  }
  m_recoveryLog.info("Sent fault data. Expecting " + expectedResponses + " responses.");
  return expectedResponses;
}
