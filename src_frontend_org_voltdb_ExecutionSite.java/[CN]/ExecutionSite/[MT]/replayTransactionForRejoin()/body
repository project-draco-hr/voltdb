{
  boolean doneWork=false;
  if (m_rejoinTaskLog == null) {
    return doneWork;
  }
  TransactionState ts=null;
  try {
    TransactionInfoBaseMessage msg=m_rejoinTaskLog.getNextMessage();
    if (msg != null) {
      if (msg.isSinglePartition()) {
        ts=new SinglePartitionTxnState(m_mailbox,this,msg);
      }
 else {
        m_recoveryLog.info("Unknown message " + msg.getClass());
      }
    }
  }
 catch (  IOException e) {
    m_recoveryLog.error("Failed to replay logged transactions: " + e.getMessage());
  }
  if (ts != null) {
    m_lastTimeLogWasEmpty=0;
    recursableRun(ts,true);
    doneWork=true;
    m_recoveryLog.trace("Replayed " + ts.getNotice().getTxnId());
    m_replayedTxnCount++;
  }
 else {
    boolean rejoinCompleted=false;
    try {
      if (m_rejoinTaskLog.isEmpty()) {
        long currentTime=System.currentTimeMillis();
        if (m_lastTimeLogWasEmpty > 0 && (currentTime - m_lastTimeLogWasEmpty) > 2000) {
          rejoinCompleted=true;
        }
 else         if (m_lastTimeLogWasEmpty == 0) {
          m_lastTimeLogWasEmpty=currentTime;
        }
      }
    }
 catch (    IOException e) {
      m_recoveryLog.error("Failed to determine if the task log is empty: " + e.getMessage());
    }
    if (rejoinCompleted) {
      m_recoveryLog.info("Replay of task messages are done");
      try {
        m_rejoinTaskLog.close();
      }
 catch (      IOException e) {
        m_recoveryLog.error("Failed to close the task log:" + e.getMessage());
      }
      m_onRecoveryCompletion.run();
    }
  }
  return doneWork;
}
