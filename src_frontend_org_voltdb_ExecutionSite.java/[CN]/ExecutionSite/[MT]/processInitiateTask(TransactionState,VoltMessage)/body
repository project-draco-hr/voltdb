{
  final InitiateTaskMessage itask=(InitiateTaskMessage)task;
  final ProcedureRunner runner=procs.get(itask.getStoredProcedureName());
  final InitiateResponseMessage response=new InitiateResponseMessage(itask);
  if (runner == null) {
    response.setResults(new ClientResponseImpl(ClientResponse.GRACEFUL_FAILURE,new VoltTable[]{},"Procedure does not exist: " + itask.getStoredProcedureName()));
  }
 else {
    try {
      Object[] callerParams=null;
      try {
        callerParams=itask.getParameters();
      }
 catch (      RuntimeException e) {
        Writer result=new StringWriter();
        PrintWriter pw=new PrintWriter(result);
        e.printStackTrace(pw);
        response.setResults(new ClientResponseImpl(ClientResponse.GRACEFUL_FAILURE,new VoltTable[]{},"Exception while deserializing procedure params\n" + result.toString()));
      }
      if (callerParams != null) {
        ClientResponseImpl cr=null;
        long txnId=txnState.txnId;
        StoredProcedureInvocation invocation=txnState.getInvocation();
        if ((invocation != null) && (invocation.getType() == ProcedureInvocationType.REPLICATED)) {
          txnId=invocation.getOriginalTxnId();
        }
        runner.setupTransaction(txnState);
        if (runner.isSystemProcedure()) {
          final Object[] combinedParams=new Object[callerParams.length + 1];
          combinedParams[0]=m_systemProcedureContext;
          for (int i=0; i < callerParams.length; ++i)           combinedParams[i + 1]=callerParams[i];
          cr=runner.call(txnId,combinedParams);
        }
 else {
          cr=runner.call(txnId,itask.getParameters());
        }
        response.setResults(cr,itask);
        if ((!itask.isReadOnly()) && itask.isSinglePartition()) {
          txnState.storeResults(cr);
        }
      }
    }
 catch (    final ExpectedProcedureException e) {
      log.l7dlog(Level.TRACE,LogKeys.org_voltdb_ExecutionSite_ExpectedProcedureException.name(),e);
      response.setResults(new ClientResponseImpl(ClientResponse.GRACEFUL_FAILURE,new VoltTable[]{},e.toString()));
    }
catch (    final Exception e) {
      hostLog.l7dlog(Level.ERROR,LogKeys.host_ExecutionSite_UnexpectedProcedureException.name(),e);
      VoltDB.crashLocalVoltDB(e.getMessage(),true,e);
    }
  }
  log.l7dlog(Level.TRACE,LogKeys.org_voltdb_ExecutionSite_SendingCompletedWUToDtxn.name(),null);
  return response;
}
