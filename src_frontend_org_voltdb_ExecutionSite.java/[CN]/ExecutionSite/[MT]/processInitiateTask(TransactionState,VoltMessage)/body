{
  final InitiateTaskMessage itask=(InitiateTaskMessage)task;
  final VoltProcedure wrapper=procs.get(itask.getStoredProcedureName());
  final InitiateResponseMessage response=new InitiateResponseMessage(itask);
  if (wrapper == null) {
    response.setResults(new ClientResponseImpl(ClientResponse.GRACEFUL_FAILURE,new VoltTable[]{},"Procedure does not exist: " + itask.getStoredProcedureName()));
  }
 else {
    try {
      Object[] callerParams=null;
      try {
        callerParams=itask.getParameters();
      }
 catch (      RuntimeException e) {
        Writer result=new StringWriter();
        PrintWriter pw=new PrintWriter(result);
        e.printStackTrace(pw);
        response.setResults(new ClientResponseImpl(ClientResponse.GRACEFUL_FAILURE,new VoltTable[]{},"Exception while deserializing procedure params\n" + result.toString()));
      }
      if (callerParams != null) {
        ClientResponseImpl cr=null;
        if (wrapper instanceof VoltSystemProcedure) {
          final Object[] combinedParams=new Object[callerParams.length + 1];
          combinedParams[0]=m_systemProcedureContext;
          for (int i=0; i < callerParams.length; ++i)           combinedParams[i + 1]=callerParams[i];
          cr=wrapper.call(txnState,combinedParams);
          response.setResults(cr,itask);
        }
 else {
          cr=wrapper.call(txnState,itask.getParameters());
          response.setResults(cr,itask);
        }
        m_partitionDRGateway.onSuccessfulProcedureCall(itask.getTxnId(),itask.getStoredProcedureInvocation(),cr);
      }
    }
 catch (    final ExpectedProcedureException e) {
      log.l7dlog(Level.TRACE,LogKeys.org_voltdb_ExecutionSite_ExpectedProcedureException.name(),e);
      response.setResults(new ClientResponseImpl(ClientResponse.GRACEFUL_FAILURE,new VoltTable[]{},e.toString()));
    }
catch (    final Exception e) {
      hostLog.l7dlog(Level.ERROR,LogKeys.host_ExecutionSite_UnexpectedProcedureException.name(),e);
      VoltDB.crashVoltDB();
    }
  }
  log.l7dlog(Level.TRACE,LogKeys.org_voltdb_ExecutionSite_SendingCompletedWUToDtxn.name(),null);
  return response;
}
