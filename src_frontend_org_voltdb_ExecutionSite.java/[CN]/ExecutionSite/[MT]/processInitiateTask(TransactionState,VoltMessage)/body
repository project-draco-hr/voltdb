{
  final InitiateTaskMessage itask=(InitiateTaskMessage)task;
  final ProcedureRunner runner=m_loadedProcedures.procs.get(itask.getStoredProcedureName());
  final InitiateResponseMessage response=new InitiateResponseMessage(itask);
  if (runner == null) {
    response.setResults(new ClientResponseImpl(ClientResponse.GRACEFUL_FAILURE,new VoltTable[]{},"Procedure does not exist: " + itask.getStoredProcedureName()));
  }
 else {
    try {
      Object[] callerParams=null;
      try {
        callerParams=itask.getParameters();
      }
 catch (      RuntimeException e) {
        Writer result=new StringWriter();
        PrintWriter pw=new PrintWriter(result);
        e.printStackTrace(pw);
        response.setResults(new ClientResponseImpl(ClientResponse.GRACEFUL_FAILURE,new VoltTable[]{},"Exception while deserializing procedure params\n" + result.toString()));
      }
      if (callerParams != null) {
        ClientResponseImpl cr=null;
        runner.setupTransaction(txnState);
        cr=runner.call(itask.getParameters());
        response.setResults(cr);
        if ((!itask.isReadOnly()) && itask.isSinglePartition()) {
          txnState.storeResults(cr);
        }
      }
    }
 catch (    final ExpectedProcedureException e) {
      log.l7dlog(Level.TRACE,LogKeys.org_voltdb_ExecutionSite_ExpectedProcedureException.name(),e);
      response.setResults(new ClientResponseImpl(ClientResponse.GRACEFUL_FAILURE,new VoltTable[]{},e.toString()));
    }
catch (    final Exception e) {
      hostLog.l7dlog(Level.ERROR,LogKeys.host_ExecutionSite_UnexpectedProcedureException.name(),e);
      VoltDB.crashLocalVoltDB(e.getMessage(),true,e);
    }
  }
  log.l7dlog(Level.TRACE,LogKeys.org_voltdb_ExecutionSite_SendingCompletedWUToDtxn.name(),null);
  return response;
}
