{
  ReplayEntry found=m_replayEntries.get(inTxnId);
  if (in instanceof Iv2EndOfLogMessage) {
    m_mpiEOLReached=true;
    return true;
  }
  if (in instanceof MultiPartitionParticipantMessage) {
    if (inTxnId <= m_lastPolledFragmentTxnId) {
      return true;
    }
    if (found == null) {
      ReplayEntry newEntry=new ReplayEntry();
      newEntry.m_sentinalTxnId=inTxnId;
      m_replayEntries.put(inTxnId,newEntry);
    }
 else {
      found.m_sentinalTxnId=inTxnId;
      assert(found.isReady());
    }
  }
 else   if (in instanceof FragmentTaskMessage) {
    if (inTxnId <= m_lastPolledFragmentTxnId) {
      return false;
    }
    FragmentTaskMessage ftm=(FragmentTaskMessage)in;
    if (found == null) {
      ReplayEntry newEntry=new ReplayEntry();
      newEntry.m_firstFragment=ftm;
      m_replayEntries.put(inTxnId,newEntry);
    }
 else     if (found.m_firstFragment == null) {
      found.m_firstFragment=ftm;
      assert(found.isReady());
    }
 else {
      found.addFragmentMessage(ftm);
    }
  }
 else   if (in instanceof CompleteTransactionMessage) {
    CompleteTransactionMessage ctm=(CompleteTransactionMessage)in;
    if (inTxnId <= m_lastPolledFragmentTxnId) {
      if (found != null && found.m_firstFragment != null) {
        found.markLastFragment(ctm);
      }
      return false;
    }
    if (found != null && found.m_firstFragment != null) {
      found.addCommpletedMessage(ctm);
    }
 else {
      return false;
    }
  }
 else {
    if (dedupe(inTxnId,in) != null) {
      return true;
    }
    updateLastSeenTxnId(inTxnId,in);
    if (m_replayEntries.isEmpty() || !m_replayEntries.lastEntry().getValue().hasSentinel()) {
      return false;
    }
 else {
      m_replayEntries.lastEntry().getValue().addBlockedMessage(in);
    }
  }
  return true;
}
