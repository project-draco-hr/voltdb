{
  ClientImpl ci=(ClientImpl)client;
  if (force) {
    if (client == this.m_unauthClient) {
      closeClient(this.m_unauthClient);
      this.m_unauthClient=null;
      return;
    }
    if (client == this.m_adminUnauthClient) {
      closeClient(this.m_adminUnauthClient);
      this.m_adminUnauthClient=null;
      return;
    }
  }
  if (ci.getUsername().length() == 0) {
    return;
  }
  StringBuilder userNameBuilder=new StringBuilder(ci.getUsername());
  if (FluentIterable.from(ci.getConnectedHostList()).allMatch(onAdminPort)) {
    userNameBuilder.append(ADMIN_SUFFIX);
  }
  String ckey=userNameBuilder.toString() + scheme;
  Connection conn=m_connections.get(ckey);
  if (conn == null) {
    throw new RuntimeException("Released client not in pool.");
  }
  if (force) {
    conn.refCount=0;
  }
 else {
    conn.refCount--;
  }
  attemptToShrinkPoolIfNeeded();
}
