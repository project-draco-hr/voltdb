{
  if (e == null)   throw new NullPointerException();
  _tailLock.lock();
  try {
    _headLock.lock();
    try {
      if (index < 0 || index >= _size.get())       throw new IndexOutOfBoundsException("!(" + 0 + "<"+ index+ "<="+ _size+ ")");
      int i=_head + index;
      if (i >= _capacity)       i-=_capacity;
      E old=(E)_elements[i];
      _elements[i]=e;
      return old;
    }
  finally {
      _headLock.unlock();
    }
  }
  finally {
    _tailLock.unlock();
  }
}
