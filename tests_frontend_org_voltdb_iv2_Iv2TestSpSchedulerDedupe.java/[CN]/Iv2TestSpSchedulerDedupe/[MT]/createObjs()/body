{
  mbox=mock(Mailbox.class);
  when(mbox.getHSId()).thenReturn(dut_hsid);
  iv2masters=mock(MapCache.class);
  HashMap<String,JSONObject> fakecache=new HashMap<String,JSONObject>();
  fakecache.put("0",new JSONObject("{hsid:0}"));
  when(iv2masters.pointInTimeCache()).thenReturn(ImmutableMap.copyOf(fakecache));
  procs=mock(LoadedProcedureSet.class);
  runner=mock(ProcedureRunner.class);
  when(runner.isSystemProcedure()).thenReturn(false);
  when(procs.getProcByName(MockSPName)).thenReturn(runner);
  dut=new SpScheduler(0,new SiteTaskerQueue());
  dut.setMailbox(mbox);
  dut.setProcedureSet(procs);
  dut.setCommandLog(mock(CommandLog.class));
}
