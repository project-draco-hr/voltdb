{
  if (buffer == null)   return 0;
  int length=buffer.length();
  StringBuilder builder=new StringBuilder();
  int written=endPoint.flush(buffer);
  builder.append(written);
  buffer.compact();
  if (!endPoint.isBlocking()) {
    while (buffer.space() == 0) {
      boolean ready=endPoint.blockWritable(getWriteTimeout());
      if (!ready)       throw new IOException("Write timeout");
      written=endPoint.flush(buffer);
      builder.append("+").append(written);
      buffer.compact();
    }
  }
  _logger.debug("Written {}/{} bytes {}",builder,length,endPoint);
  return length;
}
