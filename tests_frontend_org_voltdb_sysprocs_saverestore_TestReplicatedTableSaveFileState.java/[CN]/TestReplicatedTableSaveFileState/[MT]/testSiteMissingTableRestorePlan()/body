{
  MockVoltDB catalog_creator=new MockVoltDB();
  VoltDB.replaceVoltDBInstanceForTest(catalog_creator);
  catalog_creator.addTable(TABLE_NAME,true);
  int number_of_sites=4;
  for (int i=0; i < number_of_sites - 1; ++i) {
    addHostToTestData(i);
    catalog_creator.addSite(CoreUtils.getHSIdFromHostAndSite(i,i),i);
  }
  catalog_creator.addSite(CoreUtils.getHSIdFromHostAndSite(number_of_sites - 1,number_of_sites - 1),number_of_sites - 1);
  catalog_creator.addSite(CoreUtils.getHSIdFromHostAndSite(0,number_of_sites),MailboxType.Initiator);
  catalog_creator.addSite(CoreUtils.getHSIdFromHostAndSite(1,number_of_sites + 1),MailboxType.Initiator);
  m_siteInput.resetRowPosition();
  while (m_siteInput.advanceRow()) {
    try {
      m_state.addHostData(m_siteInput);
    }
 catch (    IOException e) {
      e.printStackTrace();
      assertTrue(false);
    }
  }
  Table test_table=catalog_creator.getTable(TABLE_NAME);
  SynthesizedPlanFragment[] test_plan=m_state.generateRestorePlan(test_table,VoltDB.instance().getSiteTracker());
  assertEquals(test_plan.length,number_of_sites + 1);
  for (int i=0; i < number_of_sites - 1; ++i) {
    assertEquals(test_plan[i].fragmentId,SysProcFragmentId.PF_restoreLoadReplicatedTable);
    assertFalse(test_plan[i].multipartition);
    assertEquals(test_plan[i].siteId,CoreUtils.getHSIdFromHostAndSite(i,i));
    assertEquals(test_plan[i].parameters.toArray()[0],TABLE_NAME);
  }
  assertEquals(test_plan[number_of_sites - 1].fragmentId,SysProcFragmentId.PF_restoreDistributeReplicatedTable);
  assertEquals(test_plan[number_of_sites - 1].siteId,0);
  assertFalse(test_plan[number_of_sites - 1].multipartition);
  assertEquals(test_plan[number_of_sites - 1].parameters.toArray()[0],TABLE_NAME);
  assertEquals(test_plan[number_of_sites - 1].parameters.toArray()[1],CoreUtils.getHSIdFromHostAndSite(3,3));
  assertEquals(test_plan[number_of_sites].fragmentId,SysProcFragmentId.PF_restoreLoadReplicatedTableResults);
  assertFalse(test_plan[number_of_sites].multipartition);
  checkPlanDependencies(test_plan);
  assertEquals(test_plan[number_of_sites].parameters.toArray()[0],m_state.getRootDependencyId());
  catalog_creator.shutdown(null);
}
