{
  rejoinLog.debug("Closing stream snapshot target");
  ByteBuffer buf=ByteBuffer.allocate(1);
  buf.put((byte)StreamSnapshotMessageType.END.ordinal());
  buf.flip();
  BBContainer container=DBBPool.wrapBB(buf);
  m_out.offer(container);
  m_out.offer(new BBContainer(null,0){
    @Override public void discard(){
    }
  }
);
  while (!m_writeFailed && m_ackTracker.hasOutstanding()) {
    Thread.yield();
  }
  m_in.close();
}
