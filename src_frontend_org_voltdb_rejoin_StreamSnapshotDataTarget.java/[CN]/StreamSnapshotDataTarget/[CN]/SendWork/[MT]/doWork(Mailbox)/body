{
  if (m_message == null) {
    return 0;
  }
  int bytesSent=0;
  try {
    if (m_schema != null) {
      bytesSent=send(mb,m_schema);
    }
    bytesSent+=send(mb,m_message);
    return bytesSent;
  }
  finally {
    discard();
    m_future.set(true);
  }
}
