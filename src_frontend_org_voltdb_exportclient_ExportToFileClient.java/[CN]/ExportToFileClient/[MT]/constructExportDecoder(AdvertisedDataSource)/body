{
  m_batchLock.writeLock().lock();
  try {
    String table_name=source.tableName;
    HashMap<String,ExportToFileDecoder> decoders=m_tableDecoders.get(source.m_generation);
    if (decoders == null) {
      decoders=new HashMap<String,ExportToFileDecoder>();
      m_tableDecoders.put(source.m_generation,decoders);
    }
    ExportToFileDecoder decoder=decoders.get(table_name);
    if (decoder == null) {
      decoder=new ExportToFileDecoder(source,table_name,source.m_generation);
      decoders.put(table_name,decoder);
    }
    decoder.m_sources.add(source);
    return decoders.get(table_name);
  }
  finally {
    m_batchLock.writeLock().unlock();
  }
}
