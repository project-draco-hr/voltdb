{
  JSONObject conf=new JSONObject(new String(config,"UTF-8"));
  String nonce=conf.getString("nonce");
  char delimiter='\0';
  String type=conf.optString("type",null).trim();
  if (type != null) {
    if (type.equalsIgnoreCase("csv")) {
      delimiter=',';
    }
 else     if (type.equalsIgnoreCase("tsv")) {
      delimiter='\t';
    }
 else {
      throw new IllegalArgumentException("Error: --type must be one of CSV or TSV");
    }
  }
  if (delimiter == '\0') {
    throw new IllegalArgumentException("ExportToFile: must provide an output type");
  }
  if (delimiter == '\0') {
    System.err.println("ExportToFile: must provide an output type");
    printHelpAndQuit(-1);
  }
  File outdir=new File(conf.optString("outdir","."));
  if (!outdir.exists()) {
    if (!outdir.mkdir()) {
      throw new IllegalArgumentException("Error: " + outdir.getPath() + " cannot be created");
    }
  }
  if (!outdir.canRead()) {
    throw new IllegalArgumentException("Error: " + outdir.getPath() + " does not have read permission set");
  }
  if (!outdir.canExecute()) {
    throw new IllegalArgumentException("Error: " + outdir.getPath() + " does not have execute permission set");
  }
  if (!outdir.canWrite()) {
    throw new IllegalArgumentException("Error: " + outdir.getPath() + " does not have write permission set");
  }
  int firstfield=conf.optBoolean("skipinternals") ? 6 : 0;
  int period=conf.optInt("period",60);
  if (period < 1) {
    throw new IllegalArgumentException("Error: Specified value for --period must be >= 1.");
  }
  String dateformatString=conf.optString("dateformat","yyyyMMddHHmmss").trim();
  boolean batched=conf.optBoolean("batched",false);
  boolean withSchema=conf.optBoolean("with-schema",false);
  String fullDelimiters=conf.optString("delimeters",null);
  if (fullDelimiters != null) {
    fullDelimiters=fullDelimiters.trim();
    String charsAsStr=StringEscapeUtils.unescapeHtml4(fullDelimiters.trim());
    if (charsAsStr.length() != 4) {
      throw new IllegalArgumentException("The delimiter set must contain exactly 4 characters (after any html escaping).");
    }
  }
  configureInternal(delimiter,nonce,outdir,period,dateformatString,fullDelimiters,firstfield,batched,withSchema);
}
