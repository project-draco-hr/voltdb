{
  FileHandle handle=new FileHandle(tableName,generation);
  CSVWriter writer=m_writers.get(handle);
  if (writer != null)   return writer;
  String path=handle.getPath(ACTIVE_PREFIX);
  File newFile=new File(path);
  if (newFile.exists()) {
    m_logger.error("Error: Output file for next period already exists at path: " + newFile.getPath());
    m_logger.error("Consider using a more specific timestamp in your filename or cleaning up your export data directory.");
    m_logger.error("ExportToFileClient will stop to prevent data loss.");
    throw new RuntimeException();
  }
  try {
    OutputStreamWriter osw=new OutputStreamWriter(new FileOutputStream(newFile,false),"UTF-8");
    if (m_fullDelimiters != null) {
      writer=new CSVWriter(new BufferedWriter(osw,4096 * 4),m_fullDelimiters[0],m_fullDelimiters[1],m_fullDelimiters[2],String.valueOf(m_fullDelimiters[3]));
    }
 else     if (m_delimiter == ',')     writer=new CSVWriter(new BufferedWriter(osw,4096 * 4),m_delimiter);
 else {
      writer=CSVWriter.getStrictTSVWriter(new BufferedWriter(osw,4096 * 4));
    }
  }
 catch (  Exception e) {
    m_logger.error(e.getMessage());
    m_logger.error("Error: Failed to create output file: " + path);
    throw new RuntimeException();
  }
  m_writers.put(handle,writer);
  return writer;
}
