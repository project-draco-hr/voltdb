{
  if (!m_withSchema)   return;
  FileHandle handle=new FileHandle(tableName,generation);
  String path=handle.getPathForSchema();
  Set<String> targetSet=m_batched ? m_batchSchemasWritten : m_globalSchemasWritten;
synchronized (targetSet) {
    if (m_batched) {
      if (m_batchSchemasWritten.contains(path)) {
        return;
      }
    }
 else {
      if (m_globalSchemasWritten.contains(path)) {
        return;
      }
    }
    File newFile=new VoltFile(path);
    try {
      OutputStreamWriter osw=new OutputStreamWriter(new FileOutputStream(newFile,false),"UTF-8");
      BufferedWriter writer=new BufferedWriter(osw);
      writer.write(schema);
      writer.flush();
      writer.close();
      if (m_batched) {
        m_batchSchemasWritten.add(path);
      }
 else {
        m_globalSchemasWritten.add(path);
      }
    }
 catch (    Exception e) {
      m_logger.error(e.getMessage());
      m_logger.error("Error: Failed to create output file: " + path);
      throw new RuntimeException();
    }
  }
}
