{
  if (VoltDB.instance().getMode() == OperationMode.PAUSED) {
    warn(null,"Server is paused and is currently unavailable - please try again later.");
    m_failedCount.incrementAndGet();
    return false;
  }
  Procedure catProc=m_catalogContext.procedures.get(proc);
  if (catProc == null) {
    catProc=m_catalogContext.m_defaultProcs.checkForDefaultProcedure(proc);
  }
  if (catProc == null) {
    if (proc.equals("@AdHoc")) {
      proc="@AdHoc_RW_MP";
    }
    SystemProcedureCatalog.Config sysProc=SystemProcedureCatalog.listing.get(proc);
    if (sysProc != null) {
      catProc=sysProc.asCatalogProcedure();
    }
    if (catProc == null) {
      String fmt="Can not invoke procedure %s from streaming interface %s procedure not found.";
      error(null,fmt,proc,ic.getName());
      m_failedCount.incrementAndGet();
      return false;
    }
  }
  boolean b=m_adapter.hasBackPressure();
  m_importContext.hasBackPressure(b);
  if (b) {
    try {
      Thread.sleep(100);
    }
 catch (    InterruptedException ex) {
    }
  }
  final long nowNanos=System.nanoTime();
  StoredProcedureInvocation task=new StoredProcedureInvocation();
  ParameterSet pset=ParameterSet.fromArrayWithCopy(fieldList);
  int sz=1 + 4 + proc.length()+ 8+ pset.getSerializedSize();
  final BBContainer tcont=getBuffer(sz);
  final ByteBuffer taskbuf=tcont.b();
  try {
    taskbuf.put(ProcedureInvocationType.ORIGINAL.getValue());
    taskbuf.putInt(proc.length());
    taskbuf.put(proc.getBytes());
    taskbuf.putLong(m_adapter.connectionId());
    pset.flattenToBuffer(taskbuf);
    taskbuf.flip();
    task.initFromBuffer(taskbuf);
  }
 catch (  IOException ex) {
    m_failedCount.incrementAndGet();
    m_logger.error("Failed to serialize parameters for stream: " + proc,ex);
    tcont.discard();
    return false;
  }
  final CatalogContext.ProcedurePartitionInfo ppi=(CatalogContext.ProcedurePartitionInfo)catProc.getAttachment();
  int partition=-1;
  if (catProc.getSinglepartition()) {
    try {
      partition=getPartitionForProcedure(ppi.index,ppi.type,task);
    }
 catch (    Exception e) {
      String fmt="Can not invoke procedure %s from streaming interface %s partition not found.";
      error(null,fmt,proc,ic.getName());
      m_failedCount.incrementAndGet();
      tcont.discard();
      return false;
    }
  }
  boolean success;
  success=m_adapter.createTransaction(m_importContext,proc,catProc,cb,task,tcont,partition,nowNanos);
  if (!success) {
    tcont.discard();
    m_failedCount.incrementAndGet();
  }
 else {
    m_submitSuccessCount.incrementAndGet();
  }
  return success;
}
