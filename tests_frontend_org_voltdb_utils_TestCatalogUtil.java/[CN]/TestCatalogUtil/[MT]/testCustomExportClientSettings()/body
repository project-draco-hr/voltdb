{
  final String withBadCustomExport="<?xml version='1.0' encoding='UTF-8' standalone='no'?>" + "<deployment>" + "<cluster hostcount='3' kfactor='1' sitesperhost='2'/>"+ "       <export enabled='true' >"+ "       <onserver exportto='custom' exportconnectorclass=\"com.foo.export.ExportClient\"  >"+ "            <configuration>"+ "                <property name=\"foo\">false</property>"+ "                <property name=\"type\">CSV</property>"+ "                <property name=\"with-schema\">false</property>"+ "            </configuration>"+ "        </onserver>"+ "        </export>"+ "</deployment>";
  final String withGoodCustomExport="<?xml version='1.0' encoding='UTF-8' standalone='no'?>" + "<deployment>" + "<cluster hostcount='3' kfactor='1' sitesperhost='2'/>"+ "       <export enabled='true' >"+ "       <onserver exportto='custom' exportconnectorclass=\"org.voltdb.utils.NoOpTestExportClient\"  >"+ "            <configuration>"+ "                <property name=\"foo\">false</property>"+ "                <property name=\"type\">CSV</property>"+ "                <property name=\"with-schema\">false</property>"+ "            </configuration>"+ "        </onserver>"+ "        </export>"+ "</deployment>";
  final String withBuiltinExport="<?xml version='1.0' encoding='UTF-8' standalone='no'?>" + "<deployment>" + "<cluster hostcount='3' kfactor='1' sitesperhost='2'/>"+ "       <export enabled='true' >"+ "       <onserver exportto='file'  >"+ "            <configuration>"+ "                <property name=\"foo\">false</property>"+ "                <property name=\"type\">CSV</property>"+ "                <property name=\"with-schema\">false</property>"+ "            </configuration>"+ "        </onserver>"+ "        </export>"+ "</deployment>";
  final String ddl="CREATE TABLE export_data ( id BIGINT default 0 , value BIGINT DEFAULT 0 );\n" + "EXPORT TABLE export_data;";
  final File tmpDdl=VoltProjectBuilder.writeStringToTempFile(ddl);
  final File tmpBad=VoltProjectBuilder.writeStringToTempFile(withBadCustomExport);
  DeploymentType bad_deployment=CatalogUtil.getDeployment(new FileInputStream(tmpBad));
  VoltCompiler compiler=new VoltCompiler();
  String x[]={tmpDdl.getAbsolutePath()};
  Catalog cat=compiler.compileCatalog(null,x);
  long crc=CatalogUtil.compileDeploymentAndGetCRC(cat,bad_deployment,true);
  assertTrue("Deployment file failed to parse",crc != -1);
  Database db=cat.getClusters().get("cluster").getDatabases().get("database");
  org.voltdb.catalog.Connector catconn=db.getConnectors().get("0");
  assertNotNull(catconn);
  assertFalse(bad_deployment.getExport().isEnabled());
  final File tmpGood=VoltProjectBuilder.writeStringToTempFile(withGoodCustomExport);
  DeploymentType good_deployment=CatalogUtil.getDeployment(new FileInputStream(tmpGood));
  Catalog cat2=compiler.compileCatalog(null,x);
  crc=CatalogUtil.compileDeploymentAndGetCRC(cat2,good_deployment,true);
  assertTrue("Deployment file failed to parse",crc != -1);
  db=cat2.getClusters().get("cluster").getDatabases().get("database");
  catconn=db.getConnectors().get("0");
  assertNotNull(catconn);
  assertTrue(good_deployment.getExport().isEnabled());
  assertEquals(good_deployment.getExport().getOnserver().getExportto(),ServerExportEnum.CUSTOM);
  assertEquals(good_deployment.getExport().getOnserver().getExportconnectorclass(),"org.voltdb.utils.NoOpTestExportClient");
  ConnectorProperty prop=catconn.getConfig().get(ExportDataProcessor.EXPORT_TO_TYPE);
  assertEquals(prop.getValue(),"org.voltdb.utils.NoOpTestExportClient");
  final File tmpBuiltin=VoltProjectBuilder.writeStringToTempFile(withBuiltinExport);
  DeploymentType builtin_deployment=CatalogUtil.getDeployment(new FileInputStream(tmpBuiltin));
  Catalog cat3=compiler.compileCatalog(null,x);
  crc=CatalogUtil.compileDeploymentAndGetCRC(cat3,builtin_deployment,true);
  assertTrue("Deployment file failed to parse",crc != -1);
  db=cat3.getClusters().get("cluster").getDatabases().get("database");
  catconn=db.getConnectors().get("0");
  assertNotNull(catconn);
  assertTrue(builtin_deployment.getExport().isEnabled());
  assertEquals(builtin_deployment.getExport().getOnserver().getExportto(),ServerExportEnum.FILE);
  prop=catconn.getConfig().get(ExportDataProcessor.EXPORT_TO_TYPE);
  assertEquals(prop.getValue(),"org.voltdb.exportclient.ExportToFileClient");
}
