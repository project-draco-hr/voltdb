{
  if (!MiscUtils.isPro()) {
    return;
  }
  final String withBadCustomExport="<?xml version='1.0' encoding='UTF-8' standalone='no'?>" + "<deployment>" + "<cluster hostcount='3' kfactor='1' sitesperhost='2'/>"+ "    <export>"+ "        <configuration stream='default' enabled='true' type='custom' exportconnectorclass=\"com.foo.export.ExportClient\" >"+ "            <property name=\"foo\">false</property>"+ "            <property name=\"type\">CSV</property>"+ "            <property name=\"with-schema\">false</property>"+ "        </configuration>"+ "    </export>"+ "</deployment>";
  final String withGoodCustomExport="<?xml version='1.0' encoding='UTF-8' standalone='no'?>" + "<deployment>" + "<cluster hostcount='3' kfactor='1' sitesperhost='2'/>"+ "    <export>"+ "        <configuration stream='default' enabled='true' type='custom' exportconnectorclass=\"org.voltdb.exportclient.NoOpTestExportClient\" >"+ "            <property name=\"foo\">false</property>"+ "            <property name=\"type\">CSV</property>"+ "            <property name=\"with-schema\">false</property>"+ "        </configuration>"+ "    </export>"+ "</deployment>";
  final String withBuiltinFileExport="<?xml version='1.0' encoding='UTF-8' standalone='no'?>" + "<deployment>" + "<cluster hostcount='3' kfactor='1' sitesperhost='2'/>"+ "    <export>"+ "        <configuration stream='default' enabled='true' type='file'>"+ "            <property name=\"foo\">false</property>"+ "            <property name=\"type\">CSV</property>"+ "            <property name=\"with-schema\">false</property>"+ "            <property name=\"nonce\">pre-fix</property>"+ "            <property name=\"outdir\">exportdata</property>"+ "        </configuration>"+ "    </export>"+ "</deployment>";
  final String withBuiltinKafkaExport="<?xml version='1.0' encoding='UTF-8' standalone='no'?>" + "<deployment>" + "<cluster hostcount='3' kfactor='1' sitesperhost='2'/>"+ "    <export enabled='true' target='kafka'>"+ "        <configuration>"+ "            <property name=\"metadata.broker.list\">uno,due,tre</property>"+ "            <property name=\"type\">CSV</property>"+ "            <property name=\"with-schema\">false</property>"+ "        </configuration>"+ "    </export>"+ "</deployment>";
  final String ddl="CREATE TABLE export_data ( id BIGINT default 0 , value BIGINT DEFAULT 0 );\n" + "EXPORT TABLE export_data;";
  final File tmpDdl=VoltProjectBuilder.writeStringToTempFile(ddl);
  final File tmpBad=VoltProjectBuilder.writeStringToTempFile(withBadCustomExport);
  DeploymentType bad_deployment=CatalogUtil.getDeployment(new FileInputStream(tmpBad));
  VoltCompiler compiler=new VoltCompiler();
  String x[]={tmpDdl.getAbsolutePath()};
  Catalog cat=compiler.compileCatalogFromDDL(x);
  String msg=CatalogUtil.compileDeployment(cat,bad_deployment,false);
  assertTrue("compilation should have failed",msg.contains("Custom Export failed to configure"));
  final File tmpGood=VoltProjectBuilder.writeStringToTempFile(withGoodCustomExport);
  DeploymentType good_deployment=CatalogUtil.getDeployment(new FileInputStream(tmpGood));
  Catalog cat2=compiler.compileCatalogFromDDL(x);
  msg=CatalogUtil.compileDeployment(cat2,good_deployment,false);
  assertTrue("Deployment file failed to parse: " + msg,msg == null);
  Database db=cat2.getClusters().get("cluster").getDatabases().get("database");
  org.voltdb.catalog.Connector catconn=db.getConnectors().get(Constants.DEFAULT_EXPORT_CONNECTOR_NAME);
  assertNotNull(catconn);
  assertTrue(good_deployment.getExport().getConfiguration().get(0).isEnabled());
  assertEquals(good_deployment.getExport().getConfiguration().get(0).getType(),ServerExportEnum.CUSTOM);
  assertEquals(good_deployment.getExport().getConfiguration().get(0).getExportconnectorclass(),"org.voltdb.exportclient.NoOpTestExportClient");
  ConnectorProperty prop=catconn.getConfig().get(ExportDataProcessor.EXPORT_TO_TYPE);
  assertEquals(prop.getValue(),"org.voltdb.exportclient.NoOpTestExportClient");
  final File tmpBuiltin=VoltProjectBuilder.writeStringToTempFile(withBuiltinFileExport);
  DeploymentType builtin_deployment=CatalogUtil.getDeployment(new FileInputStream(tmpBuiltin));
  Catalog cat3=compiler.compileCatalogFromDDL(x);
  msg=CatalogUtil.compileDeployment(cat3,builtin_deployment,false);
  assertTrue("Deployment file failed to parse: " + msg,msg == null);
  db=cat3.getClusters().get("cluster").getDatabases().get("database");
  catconn=db.getConnectors().get(Constants.DEFAULT_EXPORT_CONNECTOR_NAME);
  assertNotNull(catconn);
  assertTrue(builtin_deployment.getExport().getConfiguration().get(0).isEnabled());
  assertEquals(builtin_deployment.getExport().getConfiguration().get(0).getType(),ServerExportEnum.FILE);
  prop=catconn.getConfig().get(ExportDataProcessor.EXPORT_TO_TYPE);
  assertEquals(prop.getValue(),"org.voltdb.exportclient.ExportToFileClient");
  final File tmpKafkaBuiltin=VoltProjectBuilder.writeStringToTempFile(withBuiltinKafkaExport);
  DeploymentType builtin_kafkadeployment=CatalogUtil.getDeployment(new FileInputStream(tmpKafkaBuiltin));
  Catalog cat4=compiler.compileCatalogFromDDL(x);
  msg=CatalogUtil.compileDeployment(cat4,builtin_kafkadeployment,false);
  assertTrue("Deployment file failed to parse: " + msg,msg == null);
  db=cat4.getClusters().get("cluster").getDatabases().get("database");
  catconn=db.getConnectors().get(Constants.DEFAULT_EXPORT_CONNECTOR_NAME);
  assertNotNull(catconn);
  assertTrue(builtin_kafkadeployment.getExport().getConfiguration().get(0).isEnabled());
  assertEquals(builtin_kafkadeployment.getExport().getConfiguration().get(0).getType(),ServerExportEnum.KAFKA);
  prop=catconn.getConfig().get(ExportDataProcessor.EXPORT_TO_TYPE);
  assertEquals(prop.getValue(),"org.voltdb.exportclient.kafka.KafkaExportClient");
}
