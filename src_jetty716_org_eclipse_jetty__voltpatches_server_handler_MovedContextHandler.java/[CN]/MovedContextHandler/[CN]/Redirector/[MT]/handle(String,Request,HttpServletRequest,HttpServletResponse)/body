{
  if (_newContextURL == null)   return;
  String url=_newContextURL;
  if (!_discardPathInfo && request.getPathInfo() != null)   url=URIUtil.addPaths(url,request.getPathInfo());
  if (!_discardQuery && request.getQueryString() != null)   url+="?" + request.getQueryString();
  response.sendRedirect(response.encodeRedirectURL(url));
  String path=_newContextURL;
  if (!_discardPathInfo && request.getPathInfo() != null)   path=URIUtil.addPaths(path,request.getPathInfo());
  StringBuilder location=URIUtil.hasScheme(path) ? new StringBuilder() : baseRequest.getRootURL();
  location.append(path);
  if (!_discardQuery && request.getQueryString() != null) {
    location.append('?');
    location.append(request.getQueryString());
  }
  response.setHeader(HttpHeaders.LOCATION,location.toString());
  if (_expires != null)   response.setHeader(HttpHeaders.EXPIRES,_expires);
  response.setStatus(_permanent ? HttpServletResponse.SC_MOVED_PERMANENTLY : HttpServletResponse.SC_FOUND);
  response.setContentLength(0);
  baseRequest.setHandled(true);
}
