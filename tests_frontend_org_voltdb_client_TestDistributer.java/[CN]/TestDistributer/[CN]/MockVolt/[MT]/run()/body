{
  try {
    while (shutdown.get() == false) {
      SocketChannel client=socket.accept();
      if (client != null) {
        client.configureBlocking(true);
        final ByteBuffer lengthBuffer=ByteBuffer.allocate(5);
        client.read(lengthBuffer);
        final ByteBuffer usernameLengthBuffer=ByteBuffer.allocate(2);
        client.read(usernameLengthBuffer);
        usernameLengthBuffer.flip();
        final int usernameLength=usernameLengthBuffer.getShort();
        final ByteBuffer usernameBuffer=ByteBuffer.allocate(usernameLength);
        client.read(usernameBuffer);
        usernameBuffer.flip();
        final ByteBuffer passwordBuffer=ByteBuffer.allocate(20);
        client.read(passwordBuffer);
        passwordBuffer.flip();
        final byte usernameBytes[]=new byte[usernameLength];
        final byte passwordBytes[]=new byte[20];
        usernameBuffer.get(usernameBytes);
        passwordBuffer.get(passwordBytes);
        @SuppressWarnings("unused") final String username=new String(usernameBytes);
        final ByteBuffer responseBuffer=ByteBuffer.allocate(6);
        responseBuffer.putInt(2);
        responseBuffer.put((byte)0);
        responseBuffer.put((byte)0);
        responseBuffer.flip();
        handler=new MockInputHandler();
        client.write(responseBuffer);
        client.configureBlocking(false);
        network.registerChannel(client,handler);
      }
    }
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
  try {
    network.shutdown();
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
  try {
    socket.close();
  }
 catch (  IOException ignored) {
  }
}
