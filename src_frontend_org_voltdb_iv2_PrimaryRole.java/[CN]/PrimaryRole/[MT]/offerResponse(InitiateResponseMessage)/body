{
  InFlightTxnState state=pendingResponses.get(message.getTxnId());
  if (state == null) {
    throw new RuntimeException("Response for transaction " + message.getTxnId() + " released before all replicas responded");
  }
  if (state.addResponse(message)) {
    pendingResponses.remove(message.getTxnId());
    if (message.getTxnId() != lastRespondedTxnId + 1) {
      throw new RuntimeException("Transaction missing, expecting transaction " + (lastRespondedTxnId + 1) + ", but got "+ message.getTxnId());
    }
    lastRespondedTxnId=message.getTxnId();
    return Pair.of(message.getClientInterfaceHSId(),message);
  }
  return null;
}
