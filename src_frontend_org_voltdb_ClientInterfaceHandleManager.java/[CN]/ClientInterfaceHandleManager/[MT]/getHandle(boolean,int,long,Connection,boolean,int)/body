{
  if (!isSinglePartition) {
    partitionId=MP_PART_ID;
  }
  HandleGenerator generator;
  generator=m_handleGenerators.get(partitionId);
  if (generator == null) {
    generator=new HandleGenerator(partitionId);
    m_handleGenerators.put(partitionId,generator);
  }
  long ciHandle=generator.getNextHandle();
  Iv2InFlight inFlight=new Iv2InFlight(ciHandle,clientHandle,clientConnection,adminConnection,messageSize);
  Deque<Iv2InFlight> perPartDeque=m_partitionTxns.get(partitionId);
  if (perPartDeque == null) {
    perPartDeque=new ArrayDeque<Iv2InFlight>();
    m_partitionTxns.put(partitionId,perPartDeque);
  }
  perPartDeque.addLast(inFlight);
  return ciHandle;
}
