{
  _createSessionIdTable="create table " + _sessionIdTable + " (id varchar(120), primary key(id))";
  _selectExpiredSessions="select * from " + _sessionTable + " where expiryTime >= ? and expiryTime <= ?";
  _deleteOldExpiredSessions="delete from " + _sessionTable + " where expiryTime >0 and expiryTime <= ?";
  _insertId="insert into " + _sessionIdTable + " (id)  values (?)";
  _deleteId="delete from " + _sessionIdTable + " where id = ?";
  _queryId="select * from " + _sessionIdTable + " where id = ?";
  Connection connection=null;
  try {
    connection=getConnection();
    connection.setAutoCommit(true);
    DatabaseMetaData metaData=connection.getMetaData();
    _dbAdaptor=new DatabaseAdaptor(metaData);
    String tableName=_dbAdaptor.convertIdentifier(_sessionIdTable);
    ResultSet result=metaData.getTables(null,null,tableName,null);
    if (!result.next()) {
      connection.createStatement().executeUpdate(_createSessionIdTable);
    }
    tableName=_dbAdaptor.convertIdentifier(_sessionTable);
    result=metaData.getTables(null,null,tableName,null);
    if (!result.next()) {
      String blobType=_dbAdaptor.getBlobType();
      _createSessionTable="create table " + _sessionTable + " (rowId varchar(120), sessionId varchar(120), "+ " contextPath varchar(60), virtualHost varchar(60), lastNode varchar(60), accessTime bigint, "+ " lastAccessTime bigint, createTime bigint, cookieTime bigint, "+ " lastSavedTime bigint, expiryTime bigint, map "+ blobType+ ", primary key(rowId))";
      connection.createStatement().executeUpdate(_createSessionTable);
    }
    String index1="idx_" + _sessionTable + "_expiry";
    String index2="idx_" + _sessionTable + "_session";
    result=metaData.getIndexInfo(null,null,tableName,false,false);
    boolean index1Exists=false;
    boolean index2Exists=false;
    while (result.next()) {
      String idxName=result.getString("INDEX_NAME");
      if (index1.equalsIgnoreCase(idxName))       index1Exists=true;
 else       if (index2.equalsIgnoreCase(idxName))       index2Exists=true;
    }
    if (!(index1Exists && index2Exists)) {
      Statement statement=connection.createStatement();
      if (!index1Exists)       statement.executeUpdate("create index " + index1 + " on "+ _sessionTable+ " (expiryTime)");
      if (!index2Exists)       statement.executeUpdate("create index " + index2 + " on "+ _sessionTable+ " (sessionId, contextPath)");
    }
  }
  finally {
    if (connection != null)     connection.close();
  }
}
