{
  int iFrom=0;
  int iTo=0;
  List<VoltTable> results=new ArrayList<VoltTable>();
  VoltTable[] subResults;
  for (; iTo < batch.size(); iTo++) {
    final QueuedSQL qs=batch.get(iTo);
    if (qs.stmt.plan != null) {
      if (iTo > iFrom) {
        subResults=executor.onExecutePrePlanned(batch.subList(iFrom,iTo),iTo == batch.size() - 1);
        results.addAll(Arrays.asList(subResults));
        iFrom=iTo;
      }
      subResults=executor.onExecuteUnplanned(batch.subList(iTo,iTo + 1),iTo == batch.size() - 1);
      iFrom++;
      results.addAll(Arrays.asList(subResults));
    }
  }
  if (iTo > iFrom) {
    subResults=executor.onExecutePrePlanned(batch.subList(iFrom,iTo),true);
    results.addAll(Arrays.asList(subResults));
  }
  return results.toArray(new VoltTable[results.size()]);
}
