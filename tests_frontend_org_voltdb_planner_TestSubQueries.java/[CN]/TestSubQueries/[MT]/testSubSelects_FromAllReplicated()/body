{
  AbstractPlanNode pn;
  List<AbstractPlanNode> planNodes;
  AbstractPlanNode nlpn;
  planNodes=compileToFragments("select T1.A, P1.C FROM (SELECT A FROM R1) T1, P1 " + "WHERE T1.A = P1.C AND P1.A = 3 ");
  assertTrue(planNodes.size() == 1);
  pn=planNodes.get(0);
  assertTrue(pn instanceof SendPlanNode);
  pn=pn.getChild(0);
  assertTrue(pn instanceof ProjectionPlanNode);
  nlpn=pn.getChild(0);
  assertTrue(nlpn instanceof NestLoopPlanNode);
  pn=nlpn.getChild(0);
  checkSeqScanSubSelects(pn,"T1","A");
  pn=pn.getChild(0);
  checkSeqScanSubSelects(pn,"R1","A");
  pn=nlpn.getChild(1);
  checkIndexedSubSelects(pn,"P1",HSQLInterface.AUTO_GEN_CONSTRAINT_WRAPPER_PREFIX + "P1_PK_TREE","A","C");
  planNodes=compileToFragments("select T1.A FROM (SELECT A FROM R1) T1, P1 " + "WHERE T1.A = P1.A AND P1.A = 3 ");
  assertTrue(planNodes.size() == 1);
  pn=planNodes.get(0);
  assertTrue(pn instanceof SendPlanNode);
  pn=pn.getChild(0);
  assertTrue(pn instanceof ProjectionPlanNode);
  nlpn=pn.getChild(0);
  assertTrue(nlpn instanceof NestLoopPlanNode);
  pn=nlpn.getChild(0);
  checkSeqScanSubSelects(pn,"T1","A");
  pn=pn.getChild(0);
  checkSeqScanSubSelects(pn,"R1","A");
  pn=nlpn.getChild(1);
  checkIndexedSubSelects(pn,"P1",HSQLInterface.AUTO_GEN_CONSTRAINT_WRAPPER_PREFIX + "P1_PK_TREE","A");
  planNodes=compileToFragments("select T1.A FROM (SELECT A FROM R1) T1, P1 " + "WHERE T1.A = P1.A AND T1.A = 3 ");
  assertTrue(planNodes.size() == 1);
  pn=planNodes.get(0);
  assertTrue(pn instanceof SendPlanNode);
  pn=pn.getChild(0);
  assertTrue(pn instanceof ProjectionPlanNode);
  nlpn=pn.getChild(0);
  assertTrue(nlpn instanceof NestLoopPlanNode);
  pn=nlpn.getChild(0);
  checkSeqScanSubSelects(pn,"T1","A");
  pn=pn.getChild(0);
  checkSeqScanSubSelects(pn,"R1","A");
  pn=nlpn.getChild(1);
  checkIndexedSubSelects(pn,"P1",HSQLInterface.AUTO_GEN_CONSTRAINT_WRAPPER_PREFIX + "P1_PK_TREE","A");
  planNodes=compileToFragments("select T1.A, P1.C FROM (SELECT A FROM R1) T1, P1 " + "WHERE T1.A = P1.C ");
  assertTrue(planNodes.size() == 2);
  pn=planNodes.get(0).getChild(0);
  assertTrue(pn instanceof ProjectionPlanNode);
  pn=pn.getChild(0);
  assertTrue(pn instanceof ReceivePlanNode);
  pn=planNodes.get(1);
  assertTrue(pn instanceof SendPlanNode);
  System.out.println(pn.toExplainPlanString());
  nlpn=pn.getChild(0);
  assertTrue(nlpn instanceof NestLoopPlanNode);
  pn=nlpn.getChild(0);
  checkSeqScanSubSelects(pn,"T1","A");
  pn=pn.getChild(0);
  checkSeqScanSubSelects(pn,"R1","A");
  pn=nlpn.getChild(1);
  assertTrue(pn instanceof SeqScanPlanNode);
  planNodes=compileToFragments("select T1.A, P1.A FROM (SELECT A FROM R1) T1, P1, P2 " + "WHERE P2.A = P1.A and T1.A = P1.C ");
  assertTrue(planNodes.size() == 2);
  pn=planNodes.get(0).getChild(0);
  assertTrue(pn instanceof ProjectionPlanNode);
  pn=pn.getChild(0);
  assertTrue(pn instanceof ReceivePlanNode);
  pn=planNodes.get(1);
  assertTrue(pn instanceof SendPlanNode);
  nlpn=pn.getChild(0);
  assertTrue(nlpn instanceof NestLoopPlanNode);
  pn=nlpn.getChild(1);
  checkSeqScanSubSelects(pn,"T1","A");
  pn=pn.getChild(0);
  checkSeqScanSubSelects(pn,"R1","A");
  nlpn=nlpn.getChild(0);
  assertTrue(nlpn instanceof NestLoopIndexPlanNode);
  pn=nlpn.getChild(0);
  checkSeqScanSubSelects(pn,"P1","A","C");
  assertEquals(nlpn.getInlinePlanNodes().size(),1);
  pn=nlpn.getInlinePlanNode(PlanNodeType.INDEXSCAN);
  checkIndexedSubSelects(pn,"P2",HSQLInterface.AUTO_GEN_CONSTRAINT_WRAPPER_PREFIX + "P2_PK_TREE","A");
}
