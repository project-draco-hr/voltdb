{
{
    List<AbstractPlanNode> lpn=compileToFragments("select A, C FROM (SELECT A, C FROM P1) TEMP ");
    assertTrue(lpn.size() == 2);
    AbstractPlanNode n=lpn.get(1);
    n=n.getChild(0);
    assertTrue(n instanceof SeqScanPlanNode);
    assertEquals("TEMP",((SeqScanPlanNode)n).getTargetTableName());
    n=n.getChild(0);
    assertTrue(n instanceof ProjectionPlanNode);
    assertTrue(n.getChild(0) instanceof IndexScanPlanNode);
  }
{
    List<AbstractPlanNode> lpn=compileToFragments("select A, C FROM (SELECT A FROM R1) TEMP1, (SELECT C FROM P2) TEMP2 WHERE TEMP1.A = TEMP2.C ");
    assertTrue(lpn.size() == 2);
    AbstractPlanNode n=lpn.get(0);
    assertTrue(n instanceof SendPlanNode);
    n=lpn.get(1);
    assertTrue(n instanceof SendPlanNode);
    n=n.getChild(0);
    assertTrue(n instanceof NestLoopPlanNode);
    AbstractPlanNode c=n.getChild(0);
    assertTrue(c instanceof SeqScanPlanNode);
    assertEquals("TEMP1",((SeqScanPlanNode)c).getTargetTableAlias());
    c=n.getChild(1);
    assertTrue(c instanceof SeqScanPlanNode);
    assertEquals("TEMP2",((SeqScanPlanNode)c).getTargetTableAlias());
  }
{
    failToCompile("select A, C FROM (SELECT A FROM P1) TEMP1, (SELECT C FROM P2) TEMP2 WHERE TEMP1.A = TEMP2.C ","Join of multiple partitioned tables has insufficient join criteria.");
  }
{
    List<AbstractPlanNode> lpn=compileToFragments("select D1, P2.D FROM (SELECT A, D D1 FROM P1 WHERE A=1) TEMP1, P2 WHERE TEMP1.A = P2.A AND P2.A = 1");
    assertTrue(lpn.size() == 1);
    AbstractPlanNode n=lpn.get(0).getChild(0).getChild(0);
    assertTrue(n instanceof NestLoopPlanNode);
    AbstractPlanNode c=n.getChild(0);
    assertTrue(c instanceof SeqScanPlanNode);
    assertEquals("TEMP1",((SeqScanPlanNode)c).getTargetTableAlias());
  }
{
    List<AbstractPlanNode> lpn=compileToFragments("select D1, D2 FROM (SELECT A, D D1 FROM P1 ) TEMP1, (SELECT A, D D2 FROM P2 ) TEMP2 WHERE TEMP1.A = TEMP2.A");
    assertTrue(lpn.size() == 2);
    AbstractPlanNode n=lpn.get(1);
    assertTrue(n instanceof SendPlanNode);
    n=n.getChild(0);
    assertTrue(n instanceof NestLoopPlanNode);
  }
{
    failToCompile("select D1, D2 FROM (SELECT A, D D1 FROM P1 WHERE A=2) TEMP1, (SELECT A, D D2 FROM P2 WHERE A=2) TEMP2","Join of multiple partitioned tables has insufficient join criteria.");
  }
{
    failToCompile("select D1, D2 FROM (SELECT A, D D1 FROM P1) TEMP1, (SELECT A, D D2 FROM P2) TEMP2 WHERE TEMP1.A = 1 AND TEMP2.A = 2","Join of multiple partitioned tables has insufficient join criteria.");
  }
}
