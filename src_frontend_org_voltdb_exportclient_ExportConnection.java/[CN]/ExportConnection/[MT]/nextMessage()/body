{
  FastDeserializer fds;
  final ByteBuffer lengthBuffer=ByteBuffer.allocate(4);
  int bytes_read=0;
  do {
    bytes_read=m_socket.read(lengthBuffer);
  }
 while (lengthBuffer.hasRemaining() && bytes_read > 0);
  if (bytes_read < 0) {
    m_state=CLOSING;
    return null;
  }
  if (bytes_read == 0) {
    if (lengthBuffer.position() != 0 && m_socket.isConnected()) {
      do {
        bytes_read=m_socket.read(lengthBuffer);
      }
 while (lengthBuffer.hasRemaining() && bytes_read >= 0);
      if (bytes_read < 0) {
        m_state=CLOSING;
        return null;
      }
    }
 else {
      return null;
    }
  }
  lengthBuffer.flip();
  int length=lengthBuffer.getInt();
  ByteBuffer messageBuf=ByteBuffer.allocate(length);
  do {
    bytes_read=m_socket.read(messageBuf);
  }
 while (messageBuf.remaining() > 0 && bytes_read >= 0);
  if (bytes_read < 0) {
    m_state=CLOSING;
    return null;
  }
  messageBuf.flip();
  fds=new FastDeserializer(messageBuf);
  ExportProtoMessage m=ExportProtoMessage.readExternal(fds);
  return m;
}
