{
  String args[]=new String[]{"--name",TESTNONCE,"--dirs",TMPDIR,"--tables","REPLICATED_TESTER","--type",csv ? "CSV" : "TSV","--outdir",TMPDIR};
  SnapshotConverter.main(args);
  FileInputStream fis=new FileInputStream(TMPDIR + File.separator + "REPLICATED_TESTER"+ (csv ? ".csv" : ".tsv"));
  try {
    int filesize=(int)fis.getChannel().size();
    ByteBuffer expectedBytes=ByteBuffer.wrap(expectedText.toString().getBytes("UTF-8"));
    ByteBuffer readBytes=ByteBuffer.allocate(filesize);
    while (readBytes.hasRemaining()) {
      int read=fis.getChannel().read(readBytes);
      if (read == -1) {
        throw new EOFException();
      }
    }
    String string=new String(readBytes.array(),"UTF-8");
    readBytes.flip();
    assertTrue(expectedBytes.equals(readBytes));
  }
  finally {
    fis.close();
  }
}
