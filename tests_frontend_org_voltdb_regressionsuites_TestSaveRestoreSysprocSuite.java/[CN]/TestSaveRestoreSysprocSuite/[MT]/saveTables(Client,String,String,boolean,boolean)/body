{
  VoltTable[] results=null;
  try {
    if (csv) {
      JSONObject jsObj=new JSONObject();
      try {
        jsObj.put("uripath",String.format("file://%s",dir));
        jsObj.put("nonce",nonce);
        jsObj.put("block",block);
        jsObj.put("format","csv");
      }
 catch (      JSONException e) {
        fail("JSON exception" + e.getMessage());
      }
      results=client.callProcedure("@SnapshotSave",jsObj.toString()).getResults();
    }
 else {
      results=client.callProcedure("@SnapshotSave",dir,nonce,(byte)(block ? 1 : 0)).getResults();
    }
  }
 catch (  Exception ex) {
    ex.printStackTrace();
    fail("SnapshotSave exception: " + ex.getMessage());
  }
  return results;
}
