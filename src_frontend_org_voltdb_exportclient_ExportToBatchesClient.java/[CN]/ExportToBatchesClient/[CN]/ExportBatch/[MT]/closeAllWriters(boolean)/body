{
  if (m_hasClosed)   return;
  for (  Entry<String,CSVWriter> entry : m_writers.entrySet()) {
    CSVWriter writer=entry.getValue();
    if (writer == null)     continue;
    try {
      writer.flush();
      writer.close();
    }
 catch (    IOException e) {
      e.printStackTrace();
    }
  }
  m_writers.clear();
  m_hasClosed=true;
  m_logger.trace("Renaming batch.");
  String oldPath=getDirPath(ACTIVE_PREFIX);
  String newPath=clean ? getDirPath("") : getDirPath(DIRTY_PREFIX);
  File oldDir=new File(oldPath);
  assert(oldDir.exists());
  assert(oldDir.isDirectory());
  assert(oldDir.canWrite());
  if (oldDir.listFiles().length > 0) {
    File newDir=new File(newPath);
    oldDir.renameTo(newDir);
    notifyBatchIsDone(newDir);
  }
 else {
    oldDir.delete();
  }
}
