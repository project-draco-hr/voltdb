{
  AsyncCompilerWork work=null;
  try {
    work=m_work.take();
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
  while (work.shouldShutdown == false) {
    if (m_shouldUpdateCatalog.compareAndSet(true,false)) {
      m_context=VoltDB.instance().getCatalogContext();
      if (m_ptool != null)       m_ptool.shutdown();
      m_ptool=null;
    }
    AsyncCompilerResult result=null;
    if (work instanceof AdHocPlannerWork)     result=compileAdHocPlan((AdHocPlannerWork)work);
    if (work instanceof CatalogChangeWork)     result=prepareApplicationCatalogDiff((CatalogChangeWork)work);
    assert(result != null);
synchronized (m_finished) {
      m_finished.add(result);
    }
    try {
      work=m_work.take();
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
  }
  if (m_ptool != null) {
    m_ptool.shutdown();
    m_ptool=null;
  }
}
