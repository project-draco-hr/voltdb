{
  AdHocPlannedStmt plannedStmt=new AdHocPlannedStmt();
  plannedStmt.clientHandle=work.clientHandle;
  plannedStmt.connectionId=work.connectionId;
  plannedStmt.hostname=work.hostname;
  plannedStmt.adminConnection=work.adminConnection;
  plannedStmt.clientData=work.clientData;
  plannedStmt.catalogVersion=m_context.catalogVersion;
  try {
    ensureLoadedPlanner();
    PlannerTool.Result result=m_ptool.planSql(work.sql);
    plannedStmt.aggregatorFragment=result.onePlan;
    plannedStmt.collectorFragment=result.allPlan;
    plannedStmt.isReplicatedTableDML=result.replicatedDML;
    plannedStmt.sql=work.sql;
    plannedStmt.errorMsg=result.errors;
  }
 catch (  Exception e) {
    plannedStmt.errorMsg="Unexpected Ad Hoc Planning Error: " + e.getMessage();
  }
  return plannedStmt;
}
