{
  CatalogChangeResult retval=new CatalogChangeResult();
  retval.clientData=work.clientData;
  retval.clientHandle=work.clientHandle;
  retval.connectionId=work.connectionId;
  retval.hostname=work.hostname;
  retval.catalogURL=work.catalogURL;
  retval.deploymentURL=work.deploymentURL;
  try {
    String newCatalogCommands=CatalogUtil.loadCatalogFromJar(work.catalogURL,null);
    if (newCatalogCommands == null) {
      retval.errorMsg="Unable to read from catalog at: " + work.catalogURL;
      return retval;
    }
    Catalog newCatalog=new Catalog();
    newCatalog.execute(newCatalogCommands);
    if (work.deploymentURL != null) {
      if (!CatalogUtil.compileDeployment(newCatalog,work.deploymentURL)) {
        retval.errorMsg="Unable to read from deployment file at: " + work.deploymentURL;
        return retval;
      }
    }
    CatalogContext context=VoltDB.instance().getCatalogContext();
    retval.expectedCatalogVersion=context.catalog.getCatalogVersion();
    CatalogDiffEngine diff=new CatalogDiffEngine(context.catalog,newCatalog);
    if (!diff.supported()) {
      throw new Exception("The requested catalog change is not a supported change at this time. " + diff.errors());
    }
    retval.encodedDiffCommands=Encoder.compressAndBase64Encode(diff.commands());
    if (retval.encodedDiffCommands.length() > (2 * 1000 * 1000)) {
      throw new Exception("The requested catalog change is too large for this version of VoltDB. " + "Try a series of smaller updates.");
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    retval.encodedDiffCommands=null;
    retval.errorMsg=e.getMessage();
  }
  return retval;
}
