{
  m_verbotenThreads.add(Thread.currentThread().getId());
  try {
    while (m_shouldStop == false) {
      try {
        try {
          Runnable task=null;
          while ((task=m_tasks.poll()) != null) {
            task.run();
          }
          dispatchReadStream();
          drainWriteStream();
        }
 catch (        IOException e) {
          m_shouldStop=true;
          final String trimmed=e.getMessage().trim();
          if ((e instanceof IOException && (trimmed.equalsIgnoreCase("Connection reset by peer") || trimmed.equalsIgnoreCase("broken pipe"))) || e instanceof AsynchronousCloseException || e instanceof ClosedChannelException|| e instanceof ClosedByInterruptException) {
            m_logger.debug("VoltPort died, probably of natural causes",e);
          }
 else {
            e.printStackTrace();
            networkLog.error("VoltPort died due to an unexpected exception",e);
          }
        }
        m_selector.select();
      }
 catch (      Throwable ex) {
        ex.printStackTrace();
        m_logger.error(null,ex);
      }
    }
  }
 catch (  Throwable t) {
    t.printStackTrace();
  }
 finally {
    m_verbotenThreads.add(Thread.currentThread().getId());
    try {
      p_shutdown();
    }
 catch (    Throwable t) {
      t.printStackTrace();
    }
  }
}
