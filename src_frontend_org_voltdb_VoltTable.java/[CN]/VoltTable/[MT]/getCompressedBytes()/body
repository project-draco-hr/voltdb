{
  final int startPosition=m_buffer.position();
  try {
    m_buffer.position(0);
    if (m_buffer.isDirect()) {
      return CompressionService.compressBuffer(m_buffer);
    }
 else {
      assert(m_buffer.hasArray());
      return CompressionService.compressBytes(m_buffer.array(),m_buffer.position(),m_buffer.limit());
    }
  }
  finally {
    m_buffer.position(startPosition);
  }
}
