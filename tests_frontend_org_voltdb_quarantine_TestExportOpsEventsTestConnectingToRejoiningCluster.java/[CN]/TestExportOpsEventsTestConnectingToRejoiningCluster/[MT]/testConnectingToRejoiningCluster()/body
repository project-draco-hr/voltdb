{
  System.out.println("testConnectingToRejoiningCluster");
  NullExportClient expClient=new NullExportClient();
  expClient.addServerInfo(new InetSocketAddress("localhost",21212));
  VoltDBFickleCluster.start();
  expClient.addServerInfo(new InetSocketAddress("localhost",VoltDBFickleCluster.getPort(0)));
  assertTrue(expClient.connect());
  org.voltdb.client.Client client=org.voltdb.client.ClientFactory.createClient();
  client.createConnection("localhost",VoltDBFickleCluster.getPort(0));
  client.callProcedure("Insert",0);
  client.callProcedure("Insert",1);
  client.callProcedure("@AdHoc","insert into blah values (2);");
  client.close();
  final CountDownLatch latch=new CountDownLatch(1);
  new Thread(){
    @Override public void run(){
      try {
        VoltDBFickleCluster.killNode();
        Thread.sleep(500);
        VoltDBFickleCluster.rejoinNode();
      }
 catch (      Exception e) {
        e.printStackTrace();
        fail();
      }
      latch.countDown();
    }
  }
.start();
  long now=System.currentTimeMillis();
  boolean success=false;
  while ((System.currentTimeMillis() - now) < 10000) {
    try {
      expClient.work();
    }
 catch (    ExportClientException e) {
      success=true;
      break;
    }
  }
  assertTrue(success);
  expClient.disconnect();
  latch.await();
  assertTrue(expClient.connect());
  expClient.disconnect();
  VoltDBFickleCluster.stop();
}
