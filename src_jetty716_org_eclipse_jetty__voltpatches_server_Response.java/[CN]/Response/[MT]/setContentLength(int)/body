{
  if (isCommitted() || _connection.isIncluding())   return;
  _connection._generator.setContentLength(len);
  if (len >= 0) {
    _connection.getResponseFields().putLongField(HttpHeaders.CONTENT_LENGTH,len);
    if (_connection._generator.isContentWritten()) {
      if (_outputState == WRITER)       _writer.close();
 else       if (_outputState == STREAM) {
        try {
          getOutputStream().close();
        }
 catch (        IOException e) {
          throw new RuntimeException(e);
        }
      }
    }
  }
}
