{
  VoltProjectBuilder builder=getBuilderForTest();
  LocalCluster cluster=new LocalCluster("rejoin.jar",1,2,1,BackendTarget.NATIVE_EE_JNI);
  boolean success=cluster.compile(builder,false);
  assertTrue(success);
  copyFile(builder.getPathToDeployment(),Configuration.getPathToCatalogForTest("rejoin.xml"));
  cluster.setHasLocalServer(false);
  cluster.startUp();
  cluster.shutDownSingleHost(0);
  Thread.sleep(100);
  VoltDB.Configuration config=new VoltDB.Configuration();
  config.m_pathToCatalog=Configuration.getPathToCatalogForTest("rejoin.jar");
  config.m_pathToDeployment=Configuration.getPathToCatalogForTest("rejoin.xml");
  config.m_rejoinToHostAndPort="localhost:21213";
  ServerThread localServer=new ServerThread(config);
  localServer.start();
  localServer.waitForInitialization();
  Thread.sleep(100);
  localServer.shutdown();
  cluster.shutDown();
}
