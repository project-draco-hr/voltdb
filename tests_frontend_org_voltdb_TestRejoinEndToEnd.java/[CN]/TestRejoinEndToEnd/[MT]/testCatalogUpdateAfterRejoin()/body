{
  System.out.println("testCatalogUpdateAfterRejoin");
  VoltProjectBuilder builder=getBuilderForTest();
  LocalCluster cluster=new LocalCluster("rejoin.jar",2,2,1,BackendTarget.NATIVE_EE_JNI);
  boolean success=cluster.compile(builder);
  assertTrue(success);
  MiscUtils.copyFile(builder.getPathToDeployment(),Configuration.getPathToCatalogForTest("rejoin.xml"));
  try {
    cluster.startUp();
    for (int ii=0; ii < 3; ii++) {
      cluster.shutDownSingleHost(1);
      Thread.sleep(1000);
      cluster.recoverOne(1,0,"localhost");
      File newCatalog=new File(Configuration.getPathToCatalogForTest("rejoin.jar"));
      File deployment=new File(Configuration.getPathToCatalogForTest("rejoin.xml"));
      Client client=ClientFactory.createClient();
      client.createConnection("localhost");
      VoltTable[] results=client.updateApplicationCatalog(newCatalog,deployment).getResults();
      assertTrue(results.length == 1);
      client.close();
    }
  }
  finally {
    cluster.shutDown();
  }
}
