{
  URLResource r=null;
  String url=null;
  path=org.eclipse.jetty_voltpatches.util.URIUtil.canonicalPath(path);
  if ("/".equals(path))   return this;
 else   if (!isDirectory()) {
    r=(FileResource)super.addPath(path);
    url=r._urlString;
  }
 else {
    if (path == null)     throw new MalformedURLException();
    String rel=path;
    if (path.startsWith("/"))     rel=path.substring(1);
    url=URIUtil.addPaths(_urlString,URIUtil.encodePath(rel));
    r=(URLResource)Resource.newResource(url);
  }
  String encoded=URIUtil.encodePath(path);
  int expected=r.toString().length() - encoded.length();
  int index=r._urlString.lastIndexOf(encoded,expected);
  if (expected != index && ((expected - 1) != index || path.endsWith("/") || !r.isDirectory())) {
    if (!(r instanceof BadResource)) {
      ((FileResource)r)._alias=new URL(url);
      ((FileResource)r)._aliasChecked=true;
    }
  }
  return r;
}
