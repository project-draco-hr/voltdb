{
  SSLEngine engine=null;
  try {
    engine=_context.createSSLEngine();
    engine.setUseClientMode(false);
    if (_wantClientAuth)     engine.setWantClientAuth(_wantClientAuth);
    if (_needClientAuth)     engine.setNeedClientAuth(_needClientAuth);
    if ((_excludeCipherSuites != null && _excludeCipherSuites.length > 0) || (_includeCipherSuites != null && _includeCipherSuites.length > 0)) {
      List<String> includedCSList;
      if (_includeCipherSuites != null) {
        includedCSList=Arrays.asList(_includeCipherSuites);
      }
 else {
        includedCSList=new ArrayList<String>();
      }
      List<String> excludedCSList;
      if (_excludeCipherSuites != null) {
        excludedCSList=Arrays.asList(_excludeCipherSuites);
      }
 else {
        excludedCSList=new ArrayList<String>();
      }
      String[] enabledCipherSuites=engine.getEnabledCipherSuites();
      List<String> enabledCSList=new ArrayList<String>(Arrays.asList(enabledCipherSuites));
      String[] supportedCipherSuites=engine.getSupportedCipherSuites();
      List<String> supportedCSList=Arrays.asList(supportedCipherSuites);
      for (      String cipherName : includedCSList) {
        if ((!enabledCSList.contains(cipherName)) && supportedCSList.contains(cipherName)) {
          enabledCSList.add(cipherName);
        }
      }
      for (      String cipherName : excludedCSList) {
        if (enabledCSList.contains(cipherName)) {
          enabledCSList.remove(cipherName);
        }
      }
      enabledCipherSuites=enabledCSList.toArray(new String[0]);
      engine.setEnabledCipherSuites(enabledCipherSuites);
    }
  }
 catch (  Exception e) {
    Log.warn("Error creating sslEngine -- closing this connector",e);
    close();
    throw new IllegalStateException(e);
  }
  return engine;
}
