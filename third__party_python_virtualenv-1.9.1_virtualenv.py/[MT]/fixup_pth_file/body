def fixup_pth_file(filename):
    lines = []
    prev_lines = []
    f = open(filename)
    prev_lines = f.readlines()
    f.close()
    for line in prev_lines:
        line = line.strip()
        if ((not line) or line.startswith('#') or line.startswith('import ') or (os.path.abspath(line) != line)):
            lines.append(line)
        else:
            new_value = make_relative_path(filename, line)
            if (line != new_value):
                logger.debug(('Rewriting path %s as %s (in %s)' % (line, new_value, filename)))
            lines.append(new_value)
    if (lines == prev_lines):
        logger.info(('No changes to .pth file %s' % filename))
        return
    logger.notify(('Making paths in .pth file %s relative' % filename))
    f = open(filename, 'w')
    f.write(('\n'.join(lines) + '\n'))
    f.close()
