def copyfile(src, dest, symlink=True):
    if (not os.path.exists(src)):
        logger.warn('Cannot find file %s (bad symlink)', src)
        return
    if os.path.exists(dest):
        logger.debug('File %s already exists', dest)
        return
    if (not os.path.exists(os.path.dirname(dest))):
        logger.info(('Creating parent directories for %s' % os.path.dirname(dest)))
        os.makedirs(os.path.dirname(dest))
    if (not os.path.islink(src)):
        srcpath = os.path.abspath(src)
    else:
        srcpath = os.readlink(src)
    if (symlink and hasattr(os, 'symlink') and (not is_win)):
        logger.info('Symlinking %s', dest)
        try:
            os.symlink(srcpath, dest)
        except (OSError, NotImplementedError):
            logger.info('Symlinking failed, copying to %s', dest)
            copyfileordir(src, dest)
    else:
        logger.info('Copying to %s', dest)
        copyfileordir(src, dest)
