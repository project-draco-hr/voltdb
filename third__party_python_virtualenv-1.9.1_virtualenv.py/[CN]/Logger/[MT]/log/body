def log(self, level, msg, *args, **kw):
    if args:
        if kw:
            raise TypeError('You may give positional or keyword arguments, not both')
    args = (args or kw)
    rendered = None
    for (consumer_level, consumer) in self.consumers:
        if self.level_matches(level, consumer_level):
            if (self.in_progress_hanging and (consumer in (sys.stdout, sys.stderr))):
                self.in_progress_hanging = False
                sys.stdout.write('\n')
                sys.stdout.flush()
            if (rendered is None):
                if args:
                    rendered = (msg % args)
                else:
                    rendered = msg
                rendered = ((' ' * self.indent) + rendered)
            if hasattr(consumer, 'write'):
                consumer.write((rendered + '\n'))
            else:
                consumer(rendered)
