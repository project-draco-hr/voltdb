{
  TPCCProjectBuilder project=new TPCCProjectBuilder();
  project.addDefaultSchema();
  project.addDefaultPartitioning();
  project.addDefaultProcedures();
  String testDir=BuildDirectoryUtils.getBuildDirectoryPath();
  String jarName="compile-deployment.jar";
  String catalogJar=testDir + File.separator + jarName;
  assertTrue("Project failed to compile",project.compile(catalogJar));
  byte[] bytes=MiscUtils.fileToBytes(new File(catalogJar));
  InMemoryJarfile memCatalog=CatalogUtil.loadCatalogJar(bytes,null);
  dorkCatalog(memCatalog,true,true);
  try {
    CatalogUtil.loadCatalogJar(memCatalog.getFullJarBytes(),null);
    fail("Expected load to generate an exception");
  }
 catch (  IOException e) {
    String message=e.getMessage();
    assertTrue(message.contains(UPGRADE_ERROR_MESSAGE_SUBSTRING));
  }
}
