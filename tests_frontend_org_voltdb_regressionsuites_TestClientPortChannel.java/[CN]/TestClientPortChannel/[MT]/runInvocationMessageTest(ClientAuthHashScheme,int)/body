{
  PortConnector channel=new PortConnector("localhost",port);
  channel.connect();
  System.out.println("Testing good Ping invocation before login");
  byte pingr[]={0,0,0,0,5,'@','P','i','n','g',0,0,0,0,0,0,0,0,0,0};
  boolean failed=false;
  try {
    verifyInvocation(pingr,channel,(byte)1);
  }
 catch (  Exception ioe) {
    System.out.println("Good that we could not execute a proc.");
    failed=true;
  }
  assertTrue(failed);
  channel.connect();
  if (scheme == ClientAuthHashScheme.HASH_SHA1)   login(channel);
 else   loginSha2(channel);
  System.out.println("Testing good Ping invocation");
  verifyInvocation(pingr,channel,(byte)1);
  System.out.println("Testing Ping invocation with bad procname length");
  byte bad_length[]={0,0,0,0,6,'@','P','i','n','g',0,0,0,0,0,0,0,0,0,0};
  verifyInvocation(bad_length,channel,(byte)-3);
  System.out.println("Testing Ping invocation with -1 procname length.");
  byte neg1_length[]={0,0,0,0,0,'@','P','i','n','g',0,0,0,0,0,0,0,0,0,0};
  byte iarr[]=ByteBuffer.allocate(4).putInt(-1).array();
  for (int i=0; i < 4; i++) {
    neg1_length[i + 1]=iarr[i];
  }
  verifyInvocation(neg1_length,channel,(byte)-3);
  System.out.println("Testing Ping invocation with -200 procname length.");
  byte neg2_length[]={0,0,0,0,0,'@','P','i','n','g',0,0,0,0,0,0,0,0,0,0};
  iarr=ByteBuffer.allocate(4).putInt(-200).array();
  for (int i=0; i < 4; i++) {
    neg2_length[i + 1]=iarr[i];
  }
  verifyInvocation(neg2_length,channel,(byte)-3);
  System.out.println("Testing Ping invocation with looooong procname length.");
  byte too_long_length[]={0,0,0,0,0,'@','P','i','n','g',0,0,0,0,0,0,0,0,0,0};
  iarr=ByteBuffer.allocate(4).putInt(Integer.MAX_VALUE).array();
  for (int i=0; i < 4; i++) {
    too_long_length[i + 1]=iarr[i];
  }
  verifyInvocation(too_long_length,channel,(byte)-3);
  System.out.println("Testing good Ping invocation with bad protocol version.");
  byte bad_proto[]={1,0,0,0,5,'@','P','i','n','g',0,0,0,0,0,0,0,0,0,0};
  verifyInvocation(bad_proto,channel,(byte)1);
  System.out.println("Testing good Ping invocation with incomplete client data");
  byte bad_cl_data[]={0,0,0,0,5,'@','P','i','n','g',0,0};
  verifyInvocation(bad_cl_data,channel,(byte)-3);
  System.out.println("Testing good Ping invocation Again");
  verifyInvocation(pingr,channel,(byte)1);
  channel.close();
}
