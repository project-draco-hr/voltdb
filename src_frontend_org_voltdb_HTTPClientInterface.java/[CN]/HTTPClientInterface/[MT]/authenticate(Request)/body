{
  AuthenticationResult authResult=null;
  String username=request.getParameter(PARAM_USERNAME);
  String password=request.getParameter(PARAM_PASSWORD);
  String hashedPassword=request.getParameter(PARAM_HASHEDPASSWORD);
  String admin=request.getParameter(PARAM_ADMIN);
  try {
    authResult=getAuthenticationResult(request,username,password,hashedPassword,admin);
    if (!authResult.isAuthenticated()) {
      m_rate_limited_log.log("JSON interface exception: " + authResult.m_message,EstTime.currentTimeMillis());
    }
    return authResult;
  }
  finally {
    if (authResult != null && authResult.m_client != null) {
      assert(m_connections != null);
      if (authResult.m_adminMode) {
        try {
          authResult.m_client.close();
        }
 catch (        InterruptedException e) {
          m_log.warn("JSON interface was interrupted while closing an internal admin client connection.");
        }
      }
 else {
        m_connections.releaseClient(authResult.m_client);
      }
    }
  }
}
