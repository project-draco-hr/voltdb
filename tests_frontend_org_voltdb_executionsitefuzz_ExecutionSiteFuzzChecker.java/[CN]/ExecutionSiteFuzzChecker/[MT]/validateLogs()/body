{
  boolean valid=true;
  boolean done=false;
  while (!done && valid) {
    boolean pruned=false;
    while (!m_liveSites.isEmpty() && !pruned) {
      pruned=true;
      Iterator<SiteLog> site_iter=m_liveSites.iterator();
      while (site_iter.hasNext()) {
        SiteLog site=site_iter.next();
        if (site.currentTxn().failed()) {
          System.out.println("Pruning site: " + site.getSiteId());
          site_iter.remove();
          m_failedSites.add(site);
          pruned=false;
        }
      }
    }
    if (!m_liveSites.isEmpty()) {
      Set<SiteLog> next_set=getLowestTxnIdSet();
      valid=validateSet(next_set);
      for (      SiteLog site : next_set) {
        site.advanceLog();
        if (site.isDone()) {
          m_liveSites.remove(site);
          m_doneSites.add(site);
        }
      }
    }
 else {
      done=true;
    }
  }
  return valid;
}
