{
  m_syncTask.cancel(false);
synchronized (m_outstandingWriteTasks) {
    while (m_outstandingWriteTasks.get() > 0) {
      m_outstandingWriteTasks.wait();
    }
  }
  m_channel.force(false);
  m_channel.position(8);
  ByteBuffer completed=ByteBuffer.allocate(1);
  if (m_writeFailed) {
    completed.put((byte)0).flip();
  }
 else {
    completed.put((byte)1).flip();
  }
  m_channel.write(completed);
  m_channel.force(false);
  m_channel.close();
  if (m_onCloseHandler != null) {
    m_onCloseHandler.run();
  }
}
