{
  EndPoint endp=_connection.getEndPoint();
  if (_timeoutMs > 0) {
    if (endp.isBlocking()) {
synchronized (this) {
        _expireAt=System.currentTimeMillis() + _timeoutMs;
        long wait=_timeoutMs;
        while (_expireAt > 0 && wait > 0 && _connection.getServer().isRunning()) {
          try {
            this.wait(wait);
          }
 catch (          InterruptedException e) {
            Log.ignore(e);
          }
          wait=_expireAt - System.currentTimeMillis();
        }
        if (_expireAt > 0 && wait <= 0 && _connection.getServer().isRunning()) {
          expired();
        }
      }
    }
 else {
      _connection.scheduleTimeout(_event,_timeoutMs);
    }
  }
}
