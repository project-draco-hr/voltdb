{
  TupleValueExpression firstPartitionKeyScanned=null;
  Set<TupleValueExpression> eqPartitionKeySet=new HashSet<TupleValueExpression>();
  int result=0;
  Object partitioningObject=null;
  Object partitioningExpr=null;
  for (int i=accessPath.length - 1; i >= 0; --i) {
    Table table=joinOrder[i];
    String partitionedTable=null;
    String columnNeedingCoverage=null;
    boolean columnCovered=true;
    if (!table.getIsreplicated()) {
      if (table.getMaterializer() != null) {
        accessPath[i].requiresSendReceive=true;
        result++;
        continue;
      }
      Column partitionCol=table.getPartitioncolumn();
      if (partitionCol == null) {
        accessPath[i].requiresSendReceive=true;
        result++;
        continue;
      }
      partitionedTable=table.getTypeName();
      columnNeedingCoverage=partitionCol.getTypeName();
      columnCovered=false;
    }
    List<AbstractExpression> expressions=new ArrayList<AbstractExpression>();
    expressions.addAll(accessPath[i].joinExprs);
    expressions.addAll(accessPath[i].otherExprs);
    for (    AbstractExpression expr : expressions) {
      if (expr.getExpressionType() != ExpressionType.COMPARE_EQUAL) {
        continue;
      }
      TupleValueExpression tveExpr=null;
      AbstractExpression leftExpr=expr.getLeft();
      AbstractExpression constExpr=null;
      boolean needsRelevanceCheck=false;
      if (leftExpr instanceof TupleValueExpression) {
        tveExpr=(TupleValueExpression)leftExpr;
        if (partitionedTable != null && tveExpr.getTableName().equals(partitionedTable) && tveExpr.getColumnName().equals(columnNeedingCoverage)) {
          if (firstPartitionKeyScanned == null) {
            firstPartitionKeyScanned=tveExpr;
          }
 else {
            needsRelevanceCheck=true;
          }
        }
        constExpr=expr.getRight();
        if (constExpr instanceof TupleValueExpression) {
          TupleValueExpression tve2=(TupleValueExpression)constExpr;
          if (partitionedTable != null && tve2.getTableName().equals(partitionedTable) && tve2.getColumnName().equals(columnNeedingCoverage)) {
            tve2=tveExpr;
            tveExpr=(TupleValueExpression)constExpr;
            if (firstPartitionKeyScanned == null) {
              firstPartitionKeyScanned=tveExpr;
            }
 else {
              needsRelevanceCheck=true;
            }
          }
          if (firstPartitionKeyScanned == tveExpr) {
            eqPartitionKeySet.add(tveExpr);
            eqPartitionKeySet.add(tve2);
          }
 else           if (eqPartitionKeySet.contains(tve2)) {
            eqPartitionKeySet.add(tveExpr);
            if (needsRelevanceCheck) {
              columnCovered=true;
              continue;
            }
          }
 else           if (eqPartitionKeySet.contains(tveExpr)) {
            eqPartitionKeySet.add(tve2);
          }
          continue;
        }
      }
 else {
        AbstractExpression rightExpr=expr.getRight();
        if (!(rightExpr instanceof TupleValueExpression)) {
          continue;
        }
        constExpr=leftExpr;
        tveExpr=(TupleValueExpression)rightExpr;
        if (partitionedTable != null && tveExpr.getTableName().equals(partitionedTable) && tveExpr.getColumnName().equals(columnNeedingCoverage)) {
          if (firstPartitionKeyScanned == null) {
            firstPartitionKeyScanned=tveExpr;
            eqPartitionKeySet.add(tveExpr);
          }
 else {
            needsRelevanceCheck=true;
          }
        }
      }
      if (constExpr.hasAnySubexpressionOfClass(TupleValueExpression.class)) {
        continue;
      }
      if (tveExpr == firstPartitionKeyScanned) {
        eqPartitionKeySet.add(tveExpr);
      }
      if (eqPartitionKeySet.contains(tveExpr)) {
        m_partitioning.addPartitioningExpression(constExpr);
        if (partitioningObject == null) {
          partitioningExpr=constExpr;
          partitioningObject=extractPartitioningValue(tveExpr,constExpr);
        }
        columnCovered=true;
        continue;
      }
      if (needsRelevanceCheck) {
        if (partitioningExpr != null) {
          if (partitioningExpr == constExpr) {
            eqPartitionKeySet.add(tveExpr);
            columnCovered=true;
            continue;
          }
          m_partitioning.addPartitioningExpression(constExpr);
          Object altBinding=extractPartitioningValue(tveExpr,constExpr);
          if (altBinding.equals(partitioningObject)) {
            eqPartitionKeySet.add(tveExpr);
            columnCovered=true;
            continue;
          }
        }
      }
    }
    if (!columnCovered) {
      accessPath[i].requiresSendReceive=true;
      result++;
    }
  }
  m_partitioning.setEffectiveValue(partitioningObject);
  return result;
}
