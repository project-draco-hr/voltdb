{
  if (!m_done.compareAndSet(false,true))   return;
  for (  ReadFromSocket reader : m_readers.values()) {
    reader.close();
  }
  m_es.shutdown();
  try {
    m_es.awaitTermination(365,TimeUnit.DAYS);
  }
 catch (  InterruptedException ex) {
    throw loggedException(ex,"failed to terminate executor for %s",getName());
  }
 finally {
    m_completionGuard.release();
  }
}
