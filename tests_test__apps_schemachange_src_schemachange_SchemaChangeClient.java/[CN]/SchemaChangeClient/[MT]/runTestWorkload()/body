{
  ClientConfig clientConfig=new ClientConfig("","",new StatusListener());
  client=ClientFactory.createClient(clientConfig);
  connect(config.servers);
  topo=getCluterTopology();
  VoltTable t=null;
  TableHelper.ViewRep v=null;
  while (t == null) {
    Pair<VoltTable,TableHelper.ViewRep> schema=catalogChange(null,true,null);
    t=schema.getFirst();
    v=schema.getSecond();
  }
  startTime=System.currentTimeMillis();
  while (config.duration == 0 || (System.currentTimeMillis() - startTime < (config.duration * 1000))) {
    loadTable(t);
    for (int j=0; j < 3; j++) {
      String tableName=TableHelper.getTableName(t);
      VoltTable preT=null;
      long max=maxId(t);
      long sampleOffset=-1;
      if (max > 0) {
        sampleOffset=Math.min((long)(max * .75),max - 100);
        assert(max >= 0);
        preT=sample(sampleOffset,t);
        assert(preT.getRowCount() > 0);
        log.info(_F("Sampled table %s from offset %d limit 100 and found %d rows.",tableName,sampleOffset,preT.getRowCount()));
      }
      VoltTable newT=null;
      TableHelper.ViewRep newV=null;
      boolean isNewTable=(j == 0) && (rand.nextInt(5) == 0);
      while (newT == null) {
        Pair<VoltTable,TableHelper.ViewRep> schema=catalogChange(t,isNewTable,v);
        newT=schema.getFirst();
        newV=schema.getSecond();
      }
      t=newT;
      v=newV;
      if (!isNewTable && (preT != null)) {
        VoltTable guessT=t.clone(4096 * 1024);
        TableHelper.migrateTable(preT,guessT);
        assert(sampleOffset >= 0);
        VoltTable result=callROProcedureWithRetry("VerifySchemaChanged" + tableName,sampleOffset,guessT).getResults()[0];
        boolean success=result.fetchRow(0).getLong(0) == 1;
        String err=result.fetchRow(0).getString(1);
        if (!success) {
          log.error(_F(err));
          assert(false);
        }
      }
    }
  }
  client.close();
}
