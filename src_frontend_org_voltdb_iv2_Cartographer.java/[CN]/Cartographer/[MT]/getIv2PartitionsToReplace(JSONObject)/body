{
  ClusterConfig clusterConfig=new ClusterConfig(topology);
  hostLog.info("Computing partitions to replace.  Total partitions: " + m_numberOfPartitions);
  List<Integer> repsPerPart=new ArrayList<Integer>(m_numberOfPartitions);
  for (int i=0; i < m_numberOfPartitions; i++) {
    repsPerPart.add(i,getReplicaCountForPartition(i));
  }
  List<Integer> partitions=new ArrayList<Integer>();
  int freeSites=clusterConfig.getSitesPerHost();
  for (int i=0; i < m_numberOfPartitions; i++) {
    if (repsPerPart.get(i) < clusterConfig.getReplicationFactor() + 1) {
      partitions.add(i);
      repsPerPart.set(i,clusterConfig.getReplicationFactor() + 1);
      freeSites--;
      if (freeSites == 0) {
        break;
      }
    }
  }
  if (freeSites > 0) {
    for (int i=0; i < m_numberOfPartitions; i++) {
      if (repsPerPart.get(i) < clusterConfig.getReplicationFactor() + 1) {
        hostLog.error("Partition " + i + " should have been replicated but wasn't");
      }
    }
  }
  hostLog.info("IV2 Sites will replicate the following partitions: " + partitions);
  return partitions;
}
