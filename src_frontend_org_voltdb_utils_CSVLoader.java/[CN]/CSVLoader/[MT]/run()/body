{
  int waits=0;
  int shortWaits=0;
  try {
    final CSVReader reader=new CSVReader(new FileReader(config.inputfile));
    ProcedureCallback cb=null;
    final Client client=ClientFactory.createClient();
    client.createConnection("localhost");
    boolean lastOK=true;
    String line[]=null;
    while ((config.limitrows-- > 0) && (line=reader.readNext()) != null) {
      outCount.incrementAndGet();
      boolean queued=false;
      while (queued == false) {
        String[] correctedLine=line;
        cb=new MyCallback(outCount.get(),config);
        String lineCheckResult;
        if ((lineCheckResult=checkLineFormat(correctedLine,client)) != null) {
          System.err.println("Stop at line " + (outCount.get()));
synchronized (errorLines) {
            if (!errorLines.containsKey(outCount.get())) {
              errorLines.put(outCount.get(),lineCheckResult);
            }
            if (errorLines.size() >= config.abortfailurecount) {
              System.err.println("The number of Failure row data exceeds " + config.abortfailurecount);
              System.exit(1);
            }
          }
          break;
        }
        queued=client.callProcedure(cb,insertProcedure,(Object[])correctedLine);
        if (queued == false) {
          ++waits;
          if (lastOK == false) {
            ++shortWaits;
          }
          Thread.sleep(waitSeconds);
        }
        lastOK=queued;
      }
    }
    reader.close();
    client.drain();
    client.close();
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  System.out.println("Inserted " + outCount.get() + " and acknowledged "+ inCount.get()+ " rows (final)");
  if (waits > 0) {
    System.out.println("Waited " + waits + " times");
    if (shortWaits > 0) {
      System.out.println("Waited too briefly? " + shortWaits + " times");
    }
  }
}
