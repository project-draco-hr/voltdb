{
  ConcurrentLinkedQueue<BBContainer> pooledBuffers=m_pooledBuffers.get(capacity);
  if (pooledBuffers == null) {
    pooledBuffers=new ConcurrentLinkedQueue<BBContainer>();
    if (m_pooledBuffers.putIfAbsent(capacity,pooledBuffers) == null) {
      pooledBuffers=m_pooledBuffers.get(capacity);
    }
  }
  BBContainer cont=pooledBuffers.poll();
  if (cont == null) {
    cont=allocateDirect(capacity);
  }
  final BBContainer origin=cont;
  cont=new BBContainer(origin.b()){
    @Override public void discard(){
      final ByteBuffer b=checkDoubleFree();
      m_pooledBuffers.get(b.capacity()).offer(origin);
    }
  }
;
  cont.b().clear();
  return cont;
}
