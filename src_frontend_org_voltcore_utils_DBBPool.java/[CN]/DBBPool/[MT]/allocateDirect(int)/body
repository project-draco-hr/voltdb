{
  ByteBuffer retval=null;
  try {
    retval=ByteBuffer.allocateDirect(capacity);
  }
 catch (  OutOfMemoryError e) {
    if (e.getMessage().contains("Direct buffer memory")) {
      clear();
      retval=ByteBuffer.allocateDirect(capacity);
    }
 else {
      throw new Error(e);
    }
  }
  bytesAllocatedGlobally.getAndAdd(capacity);
  logAllocation(capacity);
  return new DeallocatingContainer(retval);
}
