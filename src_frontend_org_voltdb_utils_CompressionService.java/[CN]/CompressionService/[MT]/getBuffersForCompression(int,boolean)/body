{
  IOBuffers buffers=m_buffers.get();
  ByteBuffer input=buffers.input;
  ByteBuffer output=buffers.output;
  final int maxCompressedLength=Snappy.maxCompressedLength(length);
  boolean changedBuffer=false;
  if (!inputNotUsed && input.capacity() < length) {
    input=ByteBuffer.allocateDirect(Math.max(input.capacity() * 2,length));
    changedBuffer=true;
  }
  if (output.capacity() < maxCompressedLength) {
    output=ByteBuffer.allocateDirect(Math.max(output.capacity() * 2,maxCompressedLength));
    changedBuffer=true;
  }
  if (changedBuffer) {
    buffers=new IOBuffers(input,output);
    m_buffers.set(buffers);
  }
  output.clear();
  input.clear();
  return buffers;
}
