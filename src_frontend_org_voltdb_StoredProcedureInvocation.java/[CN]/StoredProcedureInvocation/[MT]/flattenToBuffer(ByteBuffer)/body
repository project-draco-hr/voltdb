{
  assert(!((params == null) && (unserializedParams == null)));
  assert((params != null) || (unserializedParams != null));
  buf.put(type.getValue());
  if (type == ProcedureInvocationType.REPLICATED) {
    buf.putLong(originalTxnId);
  }
  buf.putInt(procName.length());
  buf.put(procName.getBytes());
  buf.putLong(clientHandle);
  if (unserializedParams != null) {
    if (!unserializedParams.isReadOnly()) {
      buf.put(unserializedParams.array(),unserializedParams.position() + unserializedParams.arrayOffset(),unserializedParams.remaining());
    }
 else {
      buf.put(unserializedParams);
    }
  }
 else   if (params != null) {
    getParams().flattenToBuffer(buf);
  }
}
