{
  double minCost=Double.MAX_VALUE;
  List<CompiledPlan> optimizedPlans=MicroOptimizationRunner.applyAll(rawplan);
  for (  CompiledPlan plan : optimizedPlans) {
    plan.sql=m_sql;
    plan.rootPlanGraph.resolveColumnIndexes();
    m_stats=new PlanStatistics();
    AbstractPlanNode planGraph=plan.rootPlanGraph;
    boolean result=planGraph.computeEstimatesRecursively(m_stats,m_cluster,m_db,m_estimates,m_paramHints);
    assert(result);
    plan.cost=m_costModel.getPlanCost(m_stats);
    String filename=String.valueOf(m_planId++);
    if (plan.cost < minCost) {
      minCost=plan.cost;
      m_bestPlan=plan;
      m_bestFilename=filename;
    }
    outputPlan(plan,planGraph,filename);
  }
}
