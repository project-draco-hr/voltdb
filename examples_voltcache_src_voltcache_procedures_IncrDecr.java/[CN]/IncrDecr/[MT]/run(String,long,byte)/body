{
  final int now=baseInit(key);
  voltQueueSQL(check,key,now);
  VoltTable checkResult=voltExecuteSQL()[1];
  if (checkResult.getRowCount() == 0)   return VoltType.NULL_BIGINT;
  try {
    final byte[] oldRawData=checkResult.fetchRow(0).getVarbinary(1);
    final long old_value=Long.parseLong(new String(oldRawData,"UTF-8"));
    long value=old_value + (increment == 1 ? by : -by);
    if (value < 0l)     value=0l;
    final byte[] newRawData=Long.toString(value).getBytes("UTF-8");
    voltQueueSQL(update,newRawData,key);
    voltExecuteSQL(true);
    return old_value;
  }
 catch (  Exception x) {
    throw new VoltAbortException(x);
  }
}
