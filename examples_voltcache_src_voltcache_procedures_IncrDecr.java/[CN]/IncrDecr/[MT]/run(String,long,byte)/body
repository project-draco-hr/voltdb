{
  final int now=Shared.init(this,key);
  voltQueueSQL(check,key,now);
  VoltTable checkResult=voltExecuteSQL()[0];
  if (checkResult.getRowCount() == 0)   return VoltType.NULL_BIGINT;
  try {
    byte[] oldRawData=checkResult.fetchRow(0).getVarbinary(1);
    long value=Long.parseLong(new String(oldRawData,"UTF-8")) + (increment == 1 ? by : -by);
    if (value < 0l)     value=0l;
    byte[] newRawData=Long.toString(value).getBytes("UTF-8");
    voltQueueSQL(update,newRawData,key);
    voltExecuteSQL(true);
    return value;
  }
 catch (  Exception x) {
    throw new VoltAbortException(x);
  }
}
