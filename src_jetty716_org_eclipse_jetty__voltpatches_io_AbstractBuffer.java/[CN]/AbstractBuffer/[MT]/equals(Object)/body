{
  if (obj == this)   return true;
  if (obj == null || !(obj instanceof Buffer))   return false;
  Buffer b=(Buffer)obj;
  if (this instanceof Buffer.CaseInsensitve || b instanceof Buffer.CaseInsensitve)   return equalsIgnoreCase(b);
  if (b.length() != length())   return false;
  if (_hash != 0 && obj instanceof AbstractBuffer) {
    AbstractBuffer ab=(AbstractBuffer)obj;
    if (ab._hash != 0 && _hash != ab._hash)     return false;
  }
  int get=getIndex();
  int bi=b.putIndex();
  for (int i=putIndex(); i-- > get; ) {
    byte b1=peek(i);
    byte b2=b.peek(--bi);
    if (b1 != b2)     return false;
  }
  return true;
}
