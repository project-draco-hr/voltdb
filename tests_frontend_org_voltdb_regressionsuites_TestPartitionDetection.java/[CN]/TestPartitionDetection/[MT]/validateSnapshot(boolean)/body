{
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  PrintStream ps=new PrintStream(baos);
  PrintStream original=System.out;
  try {
    System.setOut(ps);
    String args[]=new String[]{"--dir",TMPDIR};
    SnapshotVerifier.main(args);
    ps.flush();
    String reportString=baos.toString("UTF-8");
    boolean success=false;
    String[] snapshots=reportString.split("\n\n");
    String ppdSnapshot=null;
    for (    String snapshot : snapshots) {
      if (snapshot.contains(TESTNONCE)) {
        ppdSnapshot=snapshot;
        break;
      }
    }
    if (expectSuccess) {
      success=ppdSnapshot != null && ppdSnapshot.startsWith("Snapshot valid");
    }
 else {
      success=ppdSnapshot == null || ppdSnapshot.startsWith("Snapshot corrupted\n");
    }
    if (!success) {
      fail(reportString);
    }
  }
 catch (  UnsupportedEncodingException e) {
  }
 finally {
    System.setOut(original);
  }
}
