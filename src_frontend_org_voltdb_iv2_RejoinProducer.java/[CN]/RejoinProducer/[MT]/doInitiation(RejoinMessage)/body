{
  m_rejoinCoordinatorHsId=message.m_sourceHSId;
  m_rejoinSiteProcessor=makeSnapshotProcessor();
  long sourceSite=m_mailbox.getMasterHsId(m_partitionId);
  Pair<List<byte[]>,Integer> endPoints=m_rejoinSiteProcessor.initialize();
  String data=makeSnapshotRequest(endPoints,sourceSite);
  String nonce="Rejoin_" + m_mailbox.getHSId() + "_"+ System.currentTimeMillis();
  SnapshotUtil.requestSnapshot(0l,"",nonce,true,SnapshotFormat.STREAM,data,m_handler);
  Thread firstSnapshotBlock=new Thread(){
    @Override public void run(){
      try {
        Thread.sleep(30000);
      }
 catch (      Exception e) {
      }
      Pair<Integer,ByteBuffer> rejoinWork;
      do {
        rejoinWork=m_rejoinSiteProcessor.poll();
        if (rejoinWork != null) {
          firstWork.set(rejoinWork);
        }
      }
 while (rejoinWork == null);
      m_taskQueue.offer(RejoinProducer.this);
    }
  }
;
  firstSnapshotBlock.start();
}
