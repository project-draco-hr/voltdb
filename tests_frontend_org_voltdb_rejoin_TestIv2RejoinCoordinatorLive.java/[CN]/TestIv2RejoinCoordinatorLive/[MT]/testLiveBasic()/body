{
  createCoordinator(true);
  m_coordinator.startJoin(null,null,null);
  RejoinMessage msg=new RejoinMessage(10000l,RejoinMessage.Type.INITIATION,"Rejoin_1",null);
  List<Long> hsids=new ArrayList<Long>();
  hsids.add(1l);
  verifySent(hsids,msg);
  reset(m_coordinator);
  verify(m_volt,never()).onExecutionSiteRejoinCompletion(anyLong());
  msg=new RejoinMessage(1l,1001l,1002l);
  m_coordinator.deliver(msg);
  verifySnapshotRequest(true);
  msg=new RejoinMessage(1l,RejoinMessage.Type.SNAPSHOT_FINISHED);
  m_coordinator.deliver(msg);
  reset(m_snapshotDaemon);
  RejoinMessage expected=new RejoinMessage(10000l,RejoinMessage.Type.INITIATION,"Rejoin_2",null);
  hsids.clear();
  hsids.add(2l);
  verifySent(hsids,expected);
  verify(m_volt,never()).onExecutionSiteRejoinCompletion(anyLong());
  RejoinMessage msg1=new RejoinMessage(1l,RejoinMessage.Type.REPLAY_FINISHED);
  m_coordinator.deliver(msg1);
  msg=new RejoinMessage(2l,2001l,2002l);
  m_coordinator.deliver(msg);
  verifySnapshotRequest(true);
  RejoinMessage msg2=new RejoinMessage(2l,RejoinMessage.Type.SNAPSHOT_FINISHED);
  m_coordinator.deliver(msg2);
  RejoinMessage msg3=new RejoinMessage(2l,RejoinMessage.Type.REPLAY_FINISHED);
  m_coordinator.deliver(msg3);
  verify(m_volt).onExecutionSiteRejoinCompletion(anyLong());
}
