{
  Index newExprIndex;
  if (table.isEmpty(session) || table.isIndexingMutable()) {
    PersistentStore store=session.sessionData.getRowStore(table);
    newExprIndex=table.createExprIndex(store,name,cols,indexExprs,unique,false,assumeUnique);
  }
 else {
    newExprIndex=table.createExprIndexStructure(name,cols,indexExprs,unique,false,assumeUnique);
    Table tn=table.moveDefinition(session,table.tableType,null,null,newExprIndex,-1,0,emptySet,emptySet);
    tn.moveData(session,table,-1,0);
    database.persistentStoreCollection.releaseStore(table);
    table=tn;
    setNewTableInSchema(table);
    updateConstraints(table,emptySet);
  }
  database.schemaManager.addSchemaObject(newExprIndex);
  database.schemaManager.recompileDependentObjects(table);
  return newExprIndex;
}
