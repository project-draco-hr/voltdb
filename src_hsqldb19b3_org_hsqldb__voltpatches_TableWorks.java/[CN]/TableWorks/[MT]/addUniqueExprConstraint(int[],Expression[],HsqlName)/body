{
  database.schemaManager.checkSchemaObjectNotExists(name);
  if (table.getUniqueConstraintForExprs(indexExprs) != null) {
    throw Error.error(ErrorCode.X_42522);
  }
  HsqlName indexname=database.nameManager.newAutoName("IDX",name.name,table.getSchemaName(),table.getName(),SchemaObject.INDEX);
  Index exprIndex=table.createExprIndexStructure(indexname,cols,indexExprs,true,true);
  Constraint constraint=new Constraint(name,table,exprIndex,Constraint.UNIQUE);
  Table tn=table.moveDefinition(session,table.tableType,null,constraint,exprIndex,-1,0,emptySet,emptySet);
  tn.moveData(session,table,-1,0);
  database.persistentStoreCollection.releaseStore(table);
  table=tn;
  database.schemaManager.addSchemaObject(constraint);
  setNewTableInSchema(table);
  updateConstraints(table,emptySet);
  database.schemaManager.recompileDependentObjects(table);
}
