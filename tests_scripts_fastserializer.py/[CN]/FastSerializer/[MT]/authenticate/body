def authenticate(self, username, password):
    self.writeByte(0)
    if username:
        encoded_value = username.encode('utf-8')
        self.writeInt16(len(encoded_value))
        self.wbuf.extend(encoded_value)
    else:
        self.writeInt16(0)
    m = hashlib.sha1()
    m.update(password)
    pwHash = m.digest()
    self.wbuf.extend(pwHash)
    self.prependLength()
    self.flush()
    self.rbuf = self.socket.recv(6)
    self.readInt32()
    self.readByte()
    if (self.readByte() != 0):
        raise SystemExit('Authentication failed.')
