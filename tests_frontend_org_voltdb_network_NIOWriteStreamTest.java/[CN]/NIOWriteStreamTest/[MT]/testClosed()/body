{
  MockChannel channel=new MockChannel(MockChannel.FULL);
  MockPort port=new MockPort();
  NIOWriteStream wstream=new NIOWriteStream(port);
  ByteBuffer tmp=ByteBuffer.allocate(5);
  tmp.put((byte)1);
  tmp.put((byte)2);
  tmp.put((byte)3);
  tmp.put((byte)4);
  tmp.flip();
  assertTrue(wstream.enqueue(tmp));
  assertTrue(port.checkWriteSet());
  int closed=wstream.drainTo(channel,wstream.swapAndSerializeQueuedWrites(pool));
  assertEquals(closed,0);
  channel.m_open=false;
  boolean threwException=false;
  try {
    assertEquals(-1,wstream.drainTo(channel,wstream.swapAndSerializeQueuedWrites(pool)));
  }
 catch (  IOException e) {
    threwException=true;
  }
  assertTrue(threwException);
  wstream.shutdown();
}
