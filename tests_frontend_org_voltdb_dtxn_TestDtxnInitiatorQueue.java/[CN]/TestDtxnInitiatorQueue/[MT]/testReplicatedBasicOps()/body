{
  MockInitiator initiator=new MockInitiator();
  ExecutorTxnIdSafetyState safetyState=new ExecutorTxnIdSafetyState(INITIATOR_SITE_ID,m_mockVolt.getCatalogContext().siteTracker);
  DtxnInitiatorQueue dut=new DtxnInitiatorQueue(INITIATOR_SITE_ID,safetyState);
  dut.setInitiator(initiator);
  m_testStream.reset();
  dut.addPendingTxn(createTxnState(0,0,true,true));
  dut.addPendingTxn(createTxnState(0,1,true,true));
  dut.offer(createInitiateResponse(0,0,true,true,createResultSet("dude")));
  assertTrue(m_testStream.gotResponse());
  assertEquals(0,initiator.m_reduceCount);
  assertEquals(0,initiator.m_reduceSize);
  m_testStream.reset();
  dut.offer(createInitiateResponse(0,1,true,true,createResultSet("dude")));
  assertFalse(m_testStream.gotResponse());
  assertEquals(1,initiator.m_reduceCount);
  assertEquals(MESSAGE_SIZE,initiator.m_reduceSize);
  m_testStream.reset();
  dut.addPendingTxn(createTxnState(2,0,false,true));
  dut.addPendingTxn(createTxnState(2,1,false,true));
  dut.offer(createInitiateResponse(2,0,false,true,createResultSet("dude")));
  assertFalse(m_testStream.gotResponse());
  assertEquals(1,initiator.m_reduceCount);
  assertEquals(MESSAGE_SIZE,initiator.m_reduceSize);
  dut.offer(createInitiateResponse(2,1,false,true,createResultSet("dude")));
  assertTrue(m_testStream.gotResponse());
  assertEquals(2,initiator.m_reduceCount);
  assertEquals(MESSAGE_SIZE * 2,initiator.m_reduceSize);
}
