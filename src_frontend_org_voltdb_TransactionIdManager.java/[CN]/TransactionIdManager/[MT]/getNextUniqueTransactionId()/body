{
  long currentTime=System.currentTimeMillis();
  if (currentTime == lastUsedTime) {
    counterValue++;
    if (counterValue > COUNTER_MAX_VALUE) {
      while (currentTime == lastUsedTime)       currentTime=System.currentTimeMillis();
      lastUsedTime=currentTime;
      counterValue=0;
    }
  }
 else {
    if (currentTime < lastUsedTime) {
      System.err.println("Initiator time moved backwards from: " + lastUsedTime + " to "+ currentTime);
      if ((lastUsedTime - currentTime) < 5) {
        int count=0;
        while ((currentTime <= lastUsedTime) && (count++ < 100000)) {
          Thread.yield();
          currentTime=System.currentTimeMillis();
        }
        if (count >= 100000) {
          VoltDB.crashVoltDB();
        }
      }
 else {
        VoltDB.crashVoltDB();
      }
    }
    lastUsedTime=currentTime;
    counterValue=0;
  }
  lastTxnId=makeIdFromComponents(currentTime,counterValue,initiatorId);
  return lastTxnId;
}
