{
  int offeredMsgs=0;
  assert(m_connected.get());
  for (  HashMap<Integer,ExportDataSink> partMap : m_sinks.values()) {
    for (    ExportDataSink sink : partMap.values()) {
      sink.work();
    }
  }
  for (  ExportConnection connection : m_exportConnections.values()) {
    offeredMsgs+=connection.work();
  }
  if (!checkConnections()) {
    disconnect();
    throw new ExportClientException(ExportClientException.Type.DISCONNECT_UNEXPECTED,"Disconnected from one or more export servers");
  }
  return offeredMsgs;
}
