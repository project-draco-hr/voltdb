{
  int offeredMsgs=0;
  if (!m_connected.get()) {
    if (!connect())     return 0;
  }
  for (  HashMap<Integer,ExportDataSink> partMap : m_sinks.values()) {
    for (    ExportDataSink sink : partMap.values()) {
      sink.work();
    }
  }
  for (  ExportConnection connection : m_exportConnections.values()) {
    offeredMsgs+=connection.work();
  }
  if (!checkConnections()) {
    disconnect();
    throw new IOException("Disconnected from one or more export servers");
  }
  return offeredMsgs;
}
