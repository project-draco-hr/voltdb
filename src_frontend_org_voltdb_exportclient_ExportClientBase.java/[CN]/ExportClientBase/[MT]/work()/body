{
  int offeredMsgs=0;
synchronized (m_atomicWorkLock) {
    assert(m_connected.get());
    for (    HashMap<String,HashMap<Integer,ExportDataSink>> gen_map : m_sinks.values()) {
      for (      HashMap<Integer,ExportDataSink> part_map : gen_map.values()) {
        for (        ExportDataSink sink : part_map.values()) {
          sink.work();
        }
      }
    }
    for (    ExportConnection connection : m_exportConnections.values()) {
      offeredMsgs+=connection.work();
    }
    if (!checkConnections()) {
      disconnect();
      throw new ExportClientException(ExportClientException.Type.DISCONNECT_UNEXPECTED,"Disconnected from one or more export servers");
    }
  }
  try {
    Thread.sleep(1);
  }
 catch (  InterruptedException e) {
  }
  return offeredMsgs;
}
