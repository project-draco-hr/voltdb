{
  if (m_connected.get()) {
    m_logger.error("Export client already connected.");
    throw new ExportClientException(ExportClientException.Type.USER_ERROR,"Export client already connected.");
  }
  if (m_servers.size() == 0) {
    m_logger.error("No servers provided for export client.");
    throw new ExportClientException(ExportClientException.Type.USER_ERROR,"No servers provided for export client.");
  }
  m_sinks.clear();
  m_exportConnections.clear();
  boolean foundOneActiveServer=false;
  for (  InetSocketAddress serverAddr : m_servers) {
    ExportConnection exportConnection=null;
    try {
      exportConnection=new ExportConnection(m_username,m_password,serverAddr,m_sinks);
      exportConnection.openExportConnection();
      if (!exportConnection.isConnected())       continue;
      m_servers.clear();
      for (      String hostname : exportConnection.hosts) {
        assert(hostname.contains(":"));
        String[] parts=hostname.split(":");
        int port=m_useAdminPorts ? Integer.valueOf(parts[2]) : Integer.valueOf(parts[1]);
        InetSocketAddress addr=new InetSocketAddress(parts[0],port);
        m_servers.add(addr);
      }
      foundOneActiveServer=true;
      break;
    }
 catch (    IOException e) {
      if (e.getMessage().contains("Authentication")) {
        throw new ExportClientException(ExportClientException.Type.AUTH_FAILURE,"Authentication failure",e);
      }
    }
 finally {
      if (exportConnection != null)       exportConnection.closeExportConnection();
    }
  }
  if (!foundOneActiveServer) {
    return false;
  }
  for (int tryCount=0; tryCount < 3; tryCount++) {
    for (    InetSocketAddress addr : m_servers) {
      if (m_exportConnections.containsKey(addr))       continue;
      ExportConnection connection=connectToServer(addr);
      if (connection != null) {
        m_exportConnections.put(addr,connection);
      }
    }
    if (m_servers.size() == m_exportConnections.size())     break;
    try {
      Thread.sleep(250);
    }
 catch (    InterruptedException e) {
    }
  }
  if (m_servers.size() != m_exportConnections.size()) {
    m_sinks.clear();
    for (    ExportConnection ec : m_exportConnections.values())     ec.closeExportConnection();
    m_exportConnections.clear();
    return false;
  }
  m_connected.set(true);
  return true;
}
