{
  HashSet<AdvertisedDataSource> foundSources=new HashSet<AdvertisedDataSource>();
  for (int attempt=0; attempt < 3; attempt++) {
    foundSources.clear();
    if (!tryToConnectToAllNodes(foundSources)) {
      return false;
    }
    if (m_servers.size() == m_exportConnections.size()) {
      break;
    }
 else {
      disconnect();
    }
    try {
      Thread.sleep(500);
    }
 catch (    Exception e) {
    }
  }
  if (m_servers.size() != m_exportConnections.size()) {
    disconnect();
    return false;
  }
  HashSet<AdvertisedDataSource> knownSources=new HashSet<AdvertisedDataSource>(m_knownDataSources);
  knownSources.removeAll(foundSources);
  for (  AdvertisedDataSource source : knownSources) {
    HashMap<String,HashMap<Integer,ExportDataSink>> gen_map=m_sinks.get(source.m_generation);
    HashMap<Integer,ExportDataSink> part_map=gen_map.get(source.signature);
    ExportDataSink sink=part_map.remove(source.partitionId);
    if (part_map.isEmpty()) {
      gen_map.remove(source.signature);
    }
    if (gen_map.isEmpty()) {
      m_sinks.remove(source.m_generation);
    }
    sink.sourceNoLongerAdvertised(source);
  }
  m_knownDataSources.clear();
  m_knownDataSources.addAll(foundSources);
  m_connected.set(true);
  return true;
}
