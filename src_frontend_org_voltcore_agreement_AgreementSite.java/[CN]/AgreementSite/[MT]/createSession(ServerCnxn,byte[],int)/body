{
  final Semaphore sem=new Semaphore(0);
  final Runnable r=new Runnable(){
    @Override public void run(){
      try {
        long sessionId=m_idManager.getNextUniqueTransactionId();
        Random r=new Random(sessionId ^ ZooKeeperServer.superSecret);
        r.nextBytes(passwd);
        ByteBuffer to=ByteBuffer.allocate(4);
        to.putInt(timeout);
        to.flip();
        cnxn.setSessionId(sessionId);
        Request si=new Request(cnxn,sessionId,0,OpCode.createSession,to,null);
        try {
          processMessage(new LocalObjectMessage(si));
        }
 catch (        Exception e) {
          VoltDB.crashLocalVoltDB("Unexpected exception processing AgreementSite message",false,e);
        }
      }
  finally {
        sem.release();
      }
    }
  }
;
  m_mailbox.deliverFront(new LocalObjectMessage(r));
  return sem;
}
