{
  HashSet<Long> survivorSet=new HashSet<Long>(m_hsIds);
  survivorSet.removeAll(m_pendingFailedSites);
  if (!haveNecessaryFaultInfo(survivorSet)) {
    VoltDB.crashLocalVoltDB("Error extracting fault data",true,null);
  }
  Iterator<Map.Entry<Pair<Long,Long>,Long>> iter=m_failureSiteUpdateLedger.entrySet().iterator();
  while (iter.hasNext()) {
    final Map.Entry<Pair<Long,Long>,Long> entry=iter.next();
    final Pair<Long,Long> key=entry.getKey();
    final Long safeTxnId=entry.getValue();
    if (!m_hsIds.contains(key.getFirst())) {
      iter.remove();
      continue;
    }
    try {
      Long initiatorId=key.getSecond();
      if (!initiatorSafeInitPoint.containsKey(initiatorId)) {
        initiatorSafeInitPoint.put(initiatorId,Long.MIN_VALUE);
      }
      initiatorSafeInitPoint.put(initiatorId,Math.max(initiatorSafeInitPoint.get(initiatorId),safeTxnId));
    }
  finally {
      iter.remove();
    }
  }
  assert(!initiatorSafeInitPoint.containsValue(Long.MIN_VALUE));
}
