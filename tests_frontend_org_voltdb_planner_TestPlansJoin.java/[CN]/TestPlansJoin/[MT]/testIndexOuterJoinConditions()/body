{
  AbstractPlanNode pn=compile("select * FROM R2 LEFT JOIN R3 ON R3.A = R2.A AND R3.C > 0 AND R2.A < 6",0,false,null);
  AbstractPlanNode n=pn.getChild(0).getChild(0);
  assertTrue(n instanceof NestLoopIndexPlanNode);
  assertTrue(((NestLoopIndexPlanNode)n).getPreJoinPredicate() != null);
  AbstractExpression p=((NestLoopIndexPlanNode)n).getPreJoinPredicate();
  assertTrue(p.getExpressionType().equals(ExpressionType.COMPARE_LESSTHAN));
  assertTrue(((NestLoopIndexPlanNode)n).getJoinPredicate() == null);
  assertTrue(((NestLoopIndexPlanNode)n).getWherePredicate() == null);
  IndexScanPlanNode indexScan=(IndexScanPlanNode)n.getInlinePlanNode(PlanNodeType.INDEXSCAN);
  assertTrue(indexScan.getLookupType().equals(IndexLookupType.EQ));
  assertTrue(indexScan.getEndExpression().getExpressionType() == ExpressionType.COMPARE_EQUAL);
  assertTrue(indexScan.getPredicate().getExpressionType() == ExpressionType.COMPARE_GREATERTHAN);
  AbstractPlanNode seqScan=(SeqScanPlanNode)n.getChild(0);
  assertTrue(seqScan instanceof SeqScanPlanNode);
  assertTrue(((SeqScanPlanNode)seqScan).getPredicate() == null);
  pn=compile("select * FROM R2 LEFT JOIN R3 ON R3.A = R2.A WHERE R3.A >= 6 AND R2.A > 3 AND R2.A < R3.C",0,false,null);
  n=pn.getChild(0).getChild(0);
  assertTrue(n instanceof NestLoopIndexPlanNode);
  assertTrue(((NestLoopIndexPlanNode)n).getPreJoinPredicate() == null);
  assertTrue(((NestLoopIndexPlanNode)n).getJoinPredicate() == null);
  assertTrue(((NestLoopIndexPlanNode)n).getWherePredicate() != null);
  AbstractExpression w=((NestLoopIndexPlanNode)n).getWherePredicate();
  assertTrue(w.getExpressionType() == ExpressionType.CONJUNCTION_AND);
  assertTrue(w.getRight().getExpressionType() == ExpressionType.COMPARE_GREATERTHANOREQUALTO);
  assertTrue(w.getLeft().getExpressionType() == ExpressionType.COMPARE_LESSTHAN);
  indexScan=(IndexScanPlanNode)n.getInlinePlanNode(PlanNodeType.INDEXSCAN);
  assertTrue(indexScan.getLookupType().equals(IndexLookupType.EQ));
  assertTrue(indexScan.getEndExpression().getExpressionType() == ExpressionType.COMPARE_EQUAL);
  seqScan=(SeqScanPlanNode)n.getChild(0);
  assertTrue(seqScan instanceof SeqScanPlanNode);
  assertTrue(((SeqScanPlanNode)seqScan).getPredicate().getExpressionType().equals(ExpressionType.COMPARE_GREATERTHAN));
}
