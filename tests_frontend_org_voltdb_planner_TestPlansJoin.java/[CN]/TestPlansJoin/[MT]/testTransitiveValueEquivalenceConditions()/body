{
  AbstractPlanNode pn=compile("select * FROM R1 LEFT JOIN R2 ON R1.A = R2.A AND R2.A = 1 ");
  AbstractPlanNode n=pn.getChild(0).getChild(0);
  assertTrue(n instanceof AbstractJoinPlanNode);
  AbstractJoinPlanNode jn=(AbstractJoinPlanNode)n;
  assertTrue(jn.getJoinPredicate() == null);
  AbstractExpression p=jn.getPreJoinPredicate();
  assertTrue(p != null);
  assertTrue(ExpressionType.COMPARE_EQUAL.equals(p.getExpressionType()));
  assertTrue(ExpressionType.VALUE_CONSTANT.equals(p.getLeft().getExpressionType()));
  assertTrue(ExpressionType.VALUE_TUPLE.equals(p.getRight().getExpressionType()));
  assertTrue(jn.getChild(1) instanceof SeqScanPlanNode);
  SeqScanPlanNode ssn=(SeqScanPlanNode)jn.getChild(1);
  assertTrue(ssn.getPredicate() != null);
  p=ssn.getPredicate();
  assertTrue(ExpressionType.COMPARE_EQUAL.equals(p.getExpressionType()));
  assertTrue(ExpressionType.VALUE_TUPLE.equals(p.getLeft().getExpressionType()));
  assertTrue(ExpressionType.VALUE_CONSTANT.equals(p.getRight().getExpressionType()));
  pn=compile("select * FROM R2 LEFT JOIN R1 ON R1.A = R2.A AND R2.A = 1 ");
  n=pn.getChild(0).getChild(0);
  assertTrue(n instanceof AbstractJoinPlanNode);
  jn=(AbstractJoinPlanNode)n;
  assertTrue(jn.getJoinPredicate() == null);
  p=jn.getPreJoinPredicate();
  assertTrue(p != null);
  assertTrue(ExpressionType.COMPARE_EQUAL.equals(p.getExpressionType()));
  assertTrue(ExpressionType.VALUE_TUPLE.equals(p.getLeft().getExpressionType()));
  assertTrue(ExpressionType.VALUE_CONSTANT.equals(p.getRight().getExpressionType()));
  assertTrue(jn.getChild(1) instanceof SeqScanPlanNode);
  ssn=(SeqScanPlanNode)jn.getChild(1);
  assertTrue(ssn.getPredicate() != null);
  p=ssn.getPredicate();
  assertTrue(ExpressionType.COMPARE_EQUAL.equals(p.getExpressionType()));
  assertTrue(ExpressionType.VALUE_TUPLE.equals(p.getLeft().getExpressionType()));
  assertTrue(ExpressionType.VALUE_CONSTANT.equals(p.getRight().getExpressionType()));
  pn=compile("select * FROM R1 LEFT JOIN R2 ON R1.A = R2.A AND R2.C = 1 ");
  n=pn.getChild(0).getChild(0);
  assertTrue(n instanceof AbstractJoinPlanNode);
  p=((AbstractJoinPlanNode)n).getJoinPredicate();
  assert(p != null && p.getExpressionType().equals(ExpressionType.COMPARE_EQUAL));
  AbstractExpression l=p.getLeft();
  AbstractExpression r=p.getRight();
  assert(l.getExpressionType().equals(ExpressionType.VALUE_TUPLE));
  assert(r.getExpressionType().equals(ExpressionType.VALUE_TUPLE));
  pn=compile("select * FROM R1 LEFT JOIN R2 ON R1.A = R2.A AND ABS(R2.C) = 1 ");
  n=pn.getChild(0).getChild(0);
  assertTrue(n instanceof AbstractJoinPlanNode);
  p=((AbstractJoinPlanNode)n).getJoinPredicate();
  assert(p != null && p.getExpressionType().equals(ExpressionType.COMPARE_EQUAL));
  l=p.getLeft();
  r=p.getRight();
  assert(l.getExpressionType().equals(ExpressionType.VALUE_TUPLE));
  assert(r.getExpressionType().equals(ExpressionType.VALUE_TUPLE));
  pn=compile("select * FROM R1 LEFT JOIN R3 ON R1.A = R3.A");
  n=pn.getChild(0).getChild(0);
  assertTrue(n instanceof NestLoopIndexPlanNode);
  pn=compile("select * FROM R1 LEFT JOIN R3 ON R1.A = R3.A and R1.A = 4");
  n=pn.getChild(0).getChild(0);
  assertTrue(n instanceof NestLoopPlanNode);
  p=((AbstractJoinPlanNode)n).getJoinPredicate();
  pn=compile("select * FROM R1 LEFT JOIN R3 ON R1.A = R3.A and R3.A = 4");
  n=pn.getChild(0).getChild(0);
  assertTrue(n instanceof NestLoopPlanNode);
  p=((AbstractJoinPlanNode)n).getJoinPredicate();
}
