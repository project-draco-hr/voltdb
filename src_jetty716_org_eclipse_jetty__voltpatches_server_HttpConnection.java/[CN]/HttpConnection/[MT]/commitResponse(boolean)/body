{
  if (!_generator.isCommitted()) {
    _generator.setResponse(_response.getStatus(),_response.getReason());
    try {
      if (_expect100Continue && _response.getStatus() != 100)       _generator.setPersistent(false);
      _generator.completeHeader(_responseFields,last);
    }
 catch (    IOException io) {
      throw io;
    }
catch (    RuntimeException e) {
      Log.warn("header full: " + e);
      _response.reset();
      _generator.reset(true);
      _generator.setResponse(HttpStatus.INTERNAL_SERVER_ERROR_500,null);
      _generator.completeHeader(_responseFields,Generator.LAST);
      _generator.complete();
      throw new HttpException(HttpStatus.INTERNAL_SERVER_ERROR_500);
    }
  }
  if (last)   _generator.complete();
}
