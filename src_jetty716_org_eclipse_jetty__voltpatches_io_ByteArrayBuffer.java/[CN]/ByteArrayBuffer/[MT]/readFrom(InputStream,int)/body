{
  if (max < 0 || max > space())   max=space();
  int p=putIndex();
  int len=0, total=0, available=max;
  while (total < max) {
    len=in.read(_bytes,p,available);
    if (len < 0)     break;
 else     if (len > 0) {
      p+=len;
      total+=len;
      available-=len;
      setPutIndex(p);
    }
    if (in.available() <= 0)     break;
  }
  if (len < 0 && total == 0)   return -1;
  return total;
}
