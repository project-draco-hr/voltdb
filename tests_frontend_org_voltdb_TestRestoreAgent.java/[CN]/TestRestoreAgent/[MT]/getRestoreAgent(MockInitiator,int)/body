{
  String snapshotPath=null;
  if (context.cluster.getDatabases().get("database").getSnapshotschedule().get("default") != null) {
    snapshotPath=context.cluster.getDatabases().get("database").getSnapshotschedule().get("default").getPath();
  }
  int lowestSite=context.siteTracker.getLowestLiveNonExecSiteId();
  int lowestHostId=context.siteTracker.getHostForSite(lowestSite);
  int[] allPartitions=new int[context.numberOfPartitions];
  int i=0;
  for (  Partition p : context.cluster.getPartitions()) {
    allPartitions[i++]=Integer.parseInt(p.getTypeName());
  }
  org.voltdb.catalog.CommandLog cl=context.cluster.getLogconfig().get("log");
  RestoreAgent restoreAgent=new RestoreAgent(getClient(0),snapshotMonitor,this,hostId,this.action,context.numberOfPartitions,cl.getEnabled(),cl.getLogpath(),cl.getInternalsnapshotpath(),snapshotPath,lowestHostId,allPartitions,context.siteTracker.getAllLiveHosts());
  restoreAgent.setCatalogContext(context);
  assert(initiator != null);
  restoreAgent.setInitiator(initiator);
  return restoreAgent;
}
