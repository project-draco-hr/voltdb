{
  String snapshotPath=null;
  if (context.cluster.getDatabases().get("database").getSnapshotschedule().get("default") != null) {
    snapshotPath=context.cluster.getDatabases().get("database").getSnapshotschedule().get("default").getPath();
  }
  int[] allPartitions=new int[context.numberOfPartitions];
  int i=0;
  for (  Partition p : context.cluster.getPartitions()) {
    allPartitions[i++]=Integer.parseInt(p.getTypeName());
  }
  org.voltdb.catalog.CommandLog cl=context.cluster.getLogconfig().get("log");
  Set<Integer> all_hosts=new HashSet<Integer>();
  for (int host=0; host < m_hostCount; host++) {
    all_hosts.add(host);
  }
  RestoreAgent restoreAgent=new RestoreAgent(getClient(0),snapshotMonitor,this,hostId,this.action,context.numberOfPartitions,cl.getEnabled(),cl.getLogpath(),cl.getInternalsnapshotpath(),snapshotPath,allPartitions,all_hosts);
  restoreAgent.setCatalogContext(context);
  restoreAgent.setSiteTracker(siteTrackers.get(hostId));
  assert(initiator != null);
  restoreAgent.setInitiator(initiator);
  return restoreAgent;
}
