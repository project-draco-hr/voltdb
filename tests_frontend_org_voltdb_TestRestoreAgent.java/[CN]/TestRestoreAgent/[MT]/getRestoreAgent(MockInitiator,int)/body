{
  String snapshotPath=null;
  if (context.cluster.getDatabases().get("database").getSnapshotschedule().get("default") != null) {
    snapshotPath=context.cluster.getDatabases().get("database").getSnapshotschedule().get("default").getPath();
  }
  SiteTracker st=siteTrackers.get(hostId);
  int[] allPartitions=st.getAllPartitions();
  org.voltdb.catalog.CommandLog cl=context.cluster.getLogconfig().get("log");
  Set<Integer> all_hosts=new HashSet<Integer>();
  for (int host=0; host < m_hostCount; host++) {
    all_hosts.add(host);
  }
  RestoreAgent restoreAgent=new RestoreAgent(getClient(0),snapshotMonitor,this,hostId,this.action,cl.getEnabled(),cl.getLogpath(),cl.getInternalsnapshotpath(),snapshotPath,allPartitions,all_hosts);
  restoreAgent.setCatalogContext(context);
  assert(initiator != null);
  restoreAgent.setInitiator(initiator);
  return restoreAgent;
}
