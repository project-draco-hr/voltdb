{
  if (!MiscUtils.isPro()) {
    return;
  }
  if (action.doesRecover()) {
    return;
  }
  m_hostCount=3;
  buildCatalog(m_hostCount,8,0,newVoltRoot(null),false,true);
  MockInitiator initiator=new MockInitiator(null);
  List<RestoreAgent> agents=new ArrayList<RestoreAgent>();
  for (int i=0; i < m_hostCount - 1; i++) {
    agents.add(getRestoreAgent(initiator,i));
  }
  for (  RestoreAgent agent : agents) {
    agent.restore();
  }
  int count=0;
  while (!m_done && count++ < 10) {
    try {
      Thread.sleep(200);
    }
 catch (    InterruptedException e) {
    }
  }
  if (m_done) {
    fail();
  }
  RestoreAgent agent=getRestoreAgent(initiator,m_hostCount - 1);
  agent.restore();
  count=0;
  while (!m_done && count++ < 10) {
    try {
      Thread.sleep(500);
    }
 catch (    InterruptedException e) {
    }
  }
  if (!m_done) {
    fail();
  }
  assertFalse(snapshotted);
  assertEquals(Long.MIN_VALUE,snapshotTxnId.longValue());
}
