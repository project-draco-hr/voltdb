{
  if (!MiscUtils.isPro()) {
    return;
  }
  m_hostCount=1;
  String voltroot=newVoltRoot(null);
  buildCatalog(m_hostCount,8,0,voltroot,false,true);
  ServerThread server=new ServerThread(catalogJarFile.getAbsolutePath(),deploymentPath,TEST_SERVER_BASE_PORT + 2,TEST_SERVER_BASE_PORT,TEST_ZK_BASE_PORT,BackendTarget.NATIVE_EE_JNI);
  server.start();
  server.waitForInitialization();
  snapshot("hello");
  server.shutdown();
  m_hostCount=3;
  buildCatalog(m_hostCount,8,1,voltroot,false,true);
  HashSet<String> procs=new HashSet<String>();
  procs.add("@SnapshotRestore");
  MockInitiator initiator=new MockInitiator(procs);
  List<RestoreAgent> agents=new ArrayList<RestoreAgent>();
  for (int i=0; i < m_hostCount; i++) {
    agents.add(getRestoreAgent(initiator,i));
  }
  for (  RestoreAgent agent : agents) {
    agent.restore();
  }
  while (!m_done) {
    try {
      Thread.sleep(200);
    }
 catch (    InterruptedException e) {
    }
  }
  if (action != StartAction.CREATE) {
    Long count=initiator.getProcCounts().get("@SnapshotRestore");
    assertEquals(new Long(1),count);
    assertEquals(Long.MIN_VALUE,snapshotTxnId.longValue());
  }
 else {
    createCheck(initiator);
  }
}
