{
  File canonical=directory.getCanonicalFile();
  if (ancestors.contains(canonical)) {
    return;
  }
  File[] files=directory.listFiles();
  if (files == null) {
    logger.warning("Cannot read directory " + directory);
    return;
  }
  ImmutableSet<File> newAncestors=ImmutableSet.<File>builder().addAll(ancestors).add(canonical).build();
  for (  File f : files) {
    String name=f.getName();
    if (f.isDirectory()) {
      scanDirectory(f,classloader,packagePrefix + name + "/",newAncestors);
    }
 else {
      String resourceName=packagePrefix + name;
      if (!resourceName.equals(JarFile.MANIFEST_NAME)) {
        resources.add(ResourceInfo.of(resourceName,classloader));
      }
    }
  }
}
