{
  final ByteBuffer buf=cont.b();
  final int remaining=cont.b().remaining();
  if (remaining < 32 || !buf.isDirect())   compress=false;
  final int maxCompressedSize=compress ? Snappy.maxCompressedLength(remaining) : remaining;
  if (m_buf.remaining() < maxCompressedSize + m_objectHeaderBytes)   return false;
  m_syncedSinceLastEdit=false;
  try {
    final int objSizePosition=m_buf.position();
    m_buf.position(m_buf.position() + m_objectHeaderBytes);
    int written=maxCompressedSize;
    if (compress) {
      final long destAddr=m_bufAddr + m_buf.position();
      written=(int)Snappy.rawCompress(((DirectBuffer)buf).address() + buf.position(),remaining,destAddr);
      m_buf.position(m_buf.position() + written);
    }
 else {
      m_buf.put(buf);
    }
    m_buf.putInt(objSizePosition,written);
    m_buf.putInt(objSizePosition + 4,compress ? FLAG_COMPRESSED : 0);
    buf.position(buf.limit());
    incrementNumEntries(remaining);
  }
  finally {
    cont.discard();
  }
  return true;
}
