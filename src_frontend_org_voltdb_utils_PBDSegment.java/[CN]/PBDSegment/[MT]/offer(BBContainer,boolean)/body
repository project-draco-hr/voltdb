{
  if (m_closed)   throw new IOException("closed");
  final ByteBuffer buf=cont.b();
  final int remaining=buf.remaining();
  if (remaining < 32 || !buf.isDirect())   compress=false;
  final int maxCompressedSize=compress ? Snappy.maxCompressedLength(remaining) : remaining;
  final ByteBuffer mbuf=m_buf.b();
  if (mbuf.remaining() < maxCompressedSize + m_objectHeaderBytes)   return false;
  m_syncedSinceLastEdit=false;
  try {
    final int objSizePosition=mbuf.position();
    mbuf.position(mbuf.position() + m_objectHeaderBytes);
    int written=maxCompressedSize;
    if (compress) {
      final long destAddr=m_buf.address() + mbuf.position();
      written=(int)Snappy.rawCompress(cont.address() + buf.position(),remaining,destAddr);
      mbuf.position(mbuf.position() + written);
    }
 else {
      mbuf.put(buf);
    }
    mbuf.putInt(objSizePosition,written);
    mbuf.putInt(objSizePosition + 4,compress ? FLAG_COMPRESSED : 0);
    buf.position(buf.limit());
    incrementNumEntries(remaining);
  }
  finally {
    cont.discard();
  }
  return true;
}
