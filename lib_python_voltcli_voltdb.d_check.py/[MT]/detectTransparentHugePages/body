def detectTransparentHugePages():
    thp_filenames = glob.glob('/sys/kernel/mm/*transparent_hugepage/enabled')
    thp_filenames += glob.glob('/sys/kernel/mm/*transparent_hugepage/defrag')
    enableTHP = ''
    for filename in thp_filenames:
        with file(filename) as f:
            if ('[always]' in f.read()):
                enableTHP += (filename + ', ')
    if (len(enableTHP) == 0):
        output['TransparentHugePage'] = ['PASS', 'Transparent huge pages not set to always']
    else:
        output['TransparentHugePage'] = ['FAIL', ('Following transparent huge pages set to always: ' + enableTHP[:(-2)])]
