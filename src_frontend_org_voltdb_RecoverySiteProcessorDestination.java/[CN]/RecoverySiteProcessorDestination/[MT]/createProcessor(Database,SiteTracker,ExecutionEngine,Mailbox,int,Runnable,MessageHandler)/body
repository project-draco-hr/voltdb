{
  ArrayList<Pair<String,Integer>> tables=new ArrayList<Pair<String,Integer>>();
  Iterator<Table> ti=db.getTables().iterator();
  while (ti.hasNext()) {
    Table t=ti.next();
    if (!CatalogUtil.isTableExportOnly(db,t) && t.getMaterializer() == null) {
      tables.add(Pair.of(t.getTypeName(),t.getRelativeIndex()));
    }
  }
  int partitionId=tracker.getPartitionForSite(siteId);
  ArrayList<Integer> sourceSites=new ArrayList<Integer>(tracker.getLiveSitesForPartition(partitionId));
  sourceSites.remove(new Integer(siteId));
  if (sourceSites.isEmpty()) {
    recoveryLog.fatal("Could not find a source site for siteId " + siteId + " partition id "+ partitionId);
    VoltDB.crashVoltDB();
  }
  HashMap<Pair<String,Integer>,Integer> tableToSourceSite=new HashMap<Pair<String,Integer>,Integer>();
  for (  Pair<String,Integer> table : tables) {
    tableToSourceSite.put(table,sourceSites.get(0));
  }
  return new RecoverySiteProcessorDestination(tableToSourceSite,engine,mailbox,siteId,partitionId,onCompletion,messageHandler);
}
