{
  final long txnId=getTransactionId();
  voltQueueSQL(getLastTxnId);
  voltQueueSQL(getReplicated);
  VoltTable[] results=voltExecuteSQL();
  if (results[0].advanceRow()) {
    long previousTxnId=results[0].getLong("txnid");
    long previousRid=results[0].getLong("rid");
    if (previousTxnId >= txnId || previousRid >= rid) {
      throw new VoltAbortException("doTxn executed out of order");
    }
    results[0].resetRowPosition();
  }
  if (results[1].advanceRow()) {
    long previousTxnId=results[1].getLong("id");
    if (previousTxnId >= txnId) {
      throw new VoltAbortException("doTxn and updateReplicated executed out of order");
    }
    results[1].resetRowPosition();
  }
  voltQueueSQL(insertTxnid,txnId,partition,rid,value);
  voltQueueSQL(deleteOldTxns,oldestRid);
  voltExecuteSQL(true);
  return results;
}
