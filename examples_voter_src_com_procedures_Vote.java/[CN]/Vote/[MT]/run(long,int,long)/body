{
  boolean validVoter=false;
  boolean validContestant=false;
  int returnValue=0;
  short areaCode=(short)(phoneNumber / 10000000l);
  voltQueueSQL(checkContestant,contestantNumber);
  voltQueueSQL(checkVoter,phoneNumber);
  VoltTable resultsCheck[]=voltExecuteSQL();
  if (resultsCheck[0].getRowCount() > 0) {
    validContestant=true;
    if (resultsCheck[1].getRowCount() == 0) {
      validVoter=true;
    }
 else     if (resultsCheck[1].fetchRow(0).getLong(0) < maxVotesPerPhoneNumber) {
      validVoter=true;
    }
  }
  if (validContestant && validVoter) {
    voltQueueSQL(getState,areaCode);
    String state="EU";
    VoltTable r1=voltExecuteSQL()[0];
    if (r1.getRowCount() > 0) {
      state=r1.fetchRow(0).getString(0);
    }
    voltQueueSQL(insertVote,phoneNumber,areaCode,state,contestantNumber);
    voltExecuteSQL();
    returnValue=0;
  }
 else   if (!validContestant) {
    returnValue=1;
  }
 else {
    returnValue=2;
  }
  VoltTable vtLoad=new VoltTable(new VoltTable.ColumnInfo("return_value",VoltType.INTEGER));
  Object row[]=new Object[1];
  row[0]=returnValue;
  vtLoad.addRow(row);
  final VoltTable[] vtReturn={vtLoad};
  return vtReturn;
}
