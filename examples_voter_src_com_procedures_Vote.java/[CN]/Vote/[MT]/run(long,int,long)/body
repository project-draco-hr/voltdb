{
  boolean validVoter=false;
  boolean validContestant=false;
  long returnValue=0;
  voltQueueSQL(checkContestantStmt,contestantNumber);
  voltQueueSQL(checkVoterStmt,phoneNumber);
  voltQueueSQL(checkStateStmt,(short)(phoneNumber / 10000000l));
  VoltTable validation[]=voltExecuteSQL();
  if (validation[0].getRowCount() > 0) {
    validContestant=true;
    if (validation[1].getRowCount() == 0)     validVoter=true;
 else     if (validation[1].fetchRow(0).getLong(0) < maxVotesPerPhoneNumber)     validVoter=true;
  }
  if (validContestant && validVoter) {
    final String state=(validation[2].getRowCount() > 0) ? validation[2].fetchRow(0).getString(0) : "XX";
    voltQueueSQL(insertVoteStmt,phoneNumber,state,contestantNumber);
    voltExecuteSQL(true);
    returnValue=0;
  }
 else   if (!validContestant)   returnValue=1;
 else   returnValue=2;
  VoltTable result=new VoltTable(new VoltTable.ColumnInfo("return_value",VoltType.INTEGER));
  result.addRow(new Object[]{returnValue});
  return new VoltTable[]{result};
}
