{
  ProcessBuilder pb=new ProcessBuilder(command);
  if (dir != null) {
    File wd=new File(dir);
    pb.directory(wd);
  }
  pb.redirectErrorStream(true);
  if (passwordScript != null) {
    pb.environment().put("SSH_ASKPASS",passwordScript);
  }
  Process p=null;
  try {
    p=pb.start();
  }
 catch (  IOException e) {
    StringBuilder sb=new StringBuilder();
    if (command != null) {
      for (      String c : command) {
        sb.append(c).append(" ");
      }
    }
    log.error("Failed to run command " + sb.toString() + ". Error is "+ e.getMessage());
    return null;
  }
  return p;
}
