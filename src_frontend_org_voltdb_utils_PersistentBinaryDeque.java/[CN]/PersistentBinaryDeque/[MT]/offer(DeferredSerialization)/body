{
  assertions();
  if (m_closed) {
    throw new IOException("Closed");
  }
  PBDSegment tail=m_segments.peekLast();
  int written=tail.offer(ds);
  if (written < 0) {
    tail=addSegment(tail);
    written=tail.offer(ds);
    if (written < 0) {
      throw new IOException("Failed to offer object in PBD");
    }
  }
  incrementNumObjects();
  assertions();
  return written;
}
