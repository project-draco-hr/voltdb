{
  MockInitiator initiator=new MockInitiator();
  ExecutorTxnIdSafetyState safetyState=new ExecutorTxnIdSafetyState(m_siteMap);
  DtxnInitiatorMailbox dim=new DtxnInitiatorMailbox(safetyState,m_mockMessenger);
  dim.setInitiator(initiator);
  dim.setHSId(INITIATOR_SITE_ID);
  m_testStream.reset();
  dim.addPendingTxn(createTxnState(0,new int[]{0,1},true,true));
  dim.deliver(createInitiateResponse(0,0,true,true,false,createResultSet("dude")));
  assertTrue(m_testStream.gotResponse());
  m_testStream.reset();
  boolean caught=false;
  try {
    dim.deliver(createInitiateResponse(0,1,true,true,false,createResultSet("sweet")));
  }
 catch (  RuntimeException e) {
    if (e.getMessage().contains("Mismatched")) {
      caught=true;
    }
  }
  assertTrue(caught);
  m_testStream.reset();
  dim.addPendingTxn(createTxnState(2,new int[]{0,1},false,true));
  dim.deliver(createInitiateResponse(2,0,false,true,false,createResultSet("dude")));
  assertFalse(m_testStream.gotResponse());
  caught=false;
  try {
    dim.deliver(createInitiateResponse(2,1,true,true,false,createResultSet("sweet")));
  }
 catch (  RuntimeException e) {
    if (e.getMessage().contains("Mismatched")) {
      caught=true;
    }
  }
  assertTrue(caught);
}
