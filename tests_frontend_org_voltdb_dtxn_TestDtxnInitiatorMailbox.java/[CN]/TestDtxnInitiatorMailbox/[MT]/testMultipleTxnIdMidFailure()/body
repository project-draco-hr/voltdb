{
  MockInitiator initiator=new MockInitiator();
  Map<Long,Integer> siteMap=new HashMap<Long,Integer>();
  Set<Long> sites=m_mockVolt.getCatalogContext().siteTracker.getAllLiveSites();
  for (  long site : sites) {
    siteMap.put(site,m_mockVolt.getCatalogContext().siteTracker.getPartitionForSite(site));
  }
  ExecutorTxnIdSafetyState safetyState=new ExecutorTxnIdSafetyState(siteMap);
  DtxnInitiatorMailbox dim=new DtxnInitiatorMailbox(safetyState,m_mockMessenger);
  dim.setInitiator(initiator);
  m_testStream.reset();
  dim.addPendingTxn(createTxnState(0,new int[]{0,1},false,true));
  dim.addPendingTxn(createTxnState(1,new int[]{0,1},false,true));
  dim.deliver(createInitiateResponse(0,1,true,true,false,createResultSet("dude")));
  dim.deliver(createInitiateResponse(1,1,true,true,false,createResultSet("sweet")));
  dim.removeSite(0);
  assertTrue(m_testStream.gotResponse());
  assertEquals(2,initiator.m_reduceCount);
  assertEquals(MESSAGE_SIZE * 2,initiator.m_reduceSize);
}
