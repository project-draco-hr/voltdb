{
  for (byte ii=0; ii < 32; ii++) {
    StreamBlock sb=getStreamBlockWithFill(ii);
    m_sbq.offer(sb);
    if (ii == 2) {
      m_sbq.poll().deleteContent();
      m_sbq.poll().deleteContent();
    }
  }
  long weirdSizeValue=((1024 * 1024 * 2 + 12) * 30);
  assertEquals(m_sbq.sizeInBytes(),weirdSizeValue);
  m_sbq.sync(true);
  m_sbq.close();
  m_sbq=null;
  System.gc();
  System.runFinalization();
  m_sbq=new StreamBlockQueue(TEST_DIR,TEST_NONCE);
  System.gc();
  System.runFinalization();
  StreamBlock sb=null;
  long uso=1024 * 1024 * 6;
  ArrayList<StreamBlock> blocks=new ArrayList<StreamBlock>();
  int ii=2;
  while (ii < 32 && (sb=m_sbq.pop()) != null) {
    blocks.add(sb);
    assertEquals(sb.uso(),uso);
    uso+=1024 * 1024 * 2;
    assertEquals(sb.totalUso(),1024 * 1024 * 2);
    ByteBuffer buf=sb.unreleasedBuffer();
    buf.order(ByteOrder.LITTLE_ENDIAN);
    assertEquals(buf.getInt(),1024 * 1024 * 2);
    while (buf.hasRemaining()) {
      assertEquals(buf.get(),ii);
    }
    ii++;
  }
  System.gc();
  System.runFinalization();
  boolean threw=false;
  try {
    m_sbq.pop();
  }
 catch (  NoSuchElementException e) {
    threw=true;
  }
  assertTrue(threw);
  for (  StreamBlock streamBlock : blocks) {
    streamBlock.deleteContent();
  }
  assertEquals(m_sbq.sizeInBytes(),0);
  assertTrue(m_sbq.isEmpty());
  System.gc();
  System.runFinalization();
}
