{
  deleteDirectory(new File("/tmp/snapshotdir1"));
  deleteDirectory(new File("/tmp/snapshotdir2"));
  try {
    assertTrue(new File("/tmp/snapshotdir1").mkdir());
    assertTrue(new File("/tmp/snapshotdir2").mkdir());
    Client client=getClient();
    String newCatalogURL=Configuration.getPathToCatalogForTest("catalogupdate-cluster-enable_snapshot.jar");
    String deploymentURL=Configuration.getPathToCatalogForTest("catalogupdate-cluster-enable_snapshot.xml");
    VoltTable[] results=client.callProcedure("@UpdateApplicationCatalog",newCatalogURL,deploymentURL).getResults();
    assertTrue(results.length == 1);
    Thread.sleep(5000);
    for (    File f : new File("/tmp/snapshotdir1").listFiles()) {
      assertTrue(f.getName().startsWith("foo1"));
    }
    newCatalogURL=Configuration.getPathToCatalogForTest("catalogupdate-cluster-change_snapshot.jar");
    deploymentURL=Configuration.getPathToCatalogForTest("catalogupdate-cluster-change_snapshot.xml");
    results=client.callProcedure("@UpdateApplicationCatalog",newCatalogURL,deploymentURL).getResults();
    assertTrue(results.length == 1);
    Thread.sleep(5000);
    for (    File f : new File("/tmp/snapshotdir2").listFiles()) {
      assertTrue(f.getName().startsWith("foo2"));
    }
    newCatalogURL=Configuration.getPathToCatalogForTest("catalogupdate-cluster-base.jar");
    deploymentURL=Configuration.getPathToCatalogForTest("catalogupdate-cluster-base.xml");
    results=client.callProcedure("@UpdateApplicationCatalog",newCatalogURL,deploymentURL).getResults();
    assertTrue(results.length == 1);
    deleteDirectory(new File("/tmp/snapshotdir1"));
    deleteDirectory(new File("/tmp/snapshotdir2"));
    assertTrue(new File("/tmp/snapshotdir1").mkdir());
    assertTrue(new File("/tmp/snapshotdir2").mkdir());
    Thread.sleep(5000);
    assertTrue(new File("/tmp/snapshotdir1").listFiles().length == 0);
    assertTrue(new File("/tmp/snapshotdir2").listFiles().length == 0);
  }
  finally {
    deleteDirectory(new File("/tmp/snapshotdir1"));
    deleteDirectory(new File("/tmp/snapshotdir2"));
  }
}
